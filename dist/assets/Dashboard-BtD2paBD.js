import{j as e,m as t}from"./utils-CdldNp8C.js";import{r as a}from"./react-vendor-qiAl16-a.js";import{u as r,t as s}from"./index-Bskpd325.js";import{i}from"./charts-vendor-DwS0P6Ka.js";import{a7 as n,r as o,J as l,K as d,C as c,a0 as u,a as m,b as g,c as x}from"./ui-vendor-ENUJtt81.js";function f(){const[f,p]=a.useState(null),[h,S]=a.useState(!0),[v,y]=a.useState([]),j=("undefined"!=typeof window?localStorage.getItem("tenantSlug"):null)||"captar",w=r(),T=a.useRef(null),b=a.useRef(null),E=a.useRef(null),A=a.useRef(null),[O,L]=a.useState([]),[I,z]=a.useState([]),[N,R]=a.useState(0);a.useEffect(()=>{(async()=>{try{if("captar"===String(j).toLowerCase()){try{localStorage.setItem("adminContext","1")}catch{}const e=await w.listTenants(),t=(e.rows||[]).filter(e=>"captar"!==String(e.Slug??e.slug).toLowerCase()),a=t.length>0?[{label:"TODOS OS TENANTS",value:""},...t.map(e=>({label:String(e.Nome??e.nome),value:String(e.Slug??e.slug)}))]:[];y(a)}else y([])}catch{}C()})()},[]);const C=async()=>{try{S(!0);const e=await w.getDashboardStats();p(e);try{const e=(await w.getTopUsuarios()||[]).map(e=>({name:String(e["Usuário"]??e.usuario??""),value:Number(e.Quantidade??e.qtd??0)}));L(e)}catch{}try{const e=(await w.getTopAtivistas()||[]).map(e=>({name:String(e.Categoria??e.categoria??""),value:Number(e.Quantidade??e.qtd??0)}));z(e)}catch{}try{const e=await w.listTenants();R((e.rows||[]).length)}catch{}}catch(e){s.error("Erro ao carregar dados do dashboard")}finally{S(!1)}};return a.useEffect(()=>{if(T.current){const e=i(T.current);e.setOption({tooltip:{trigger:"axis"},xAxis:{type:"category",data:O.map(e=>e.name),axisLabel:{rotate:30}},yAxis:{type:"value"},series:[{type:"bar",data:O.map(e=>e.value),itemStyle:{color:"#1677ff"}}]});const t=()=>e.resize();return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t),e.dispose()}}return()=>{}},[O]),a.useEffect(()=>{if(b.current){const e=i(b.current);e.setOption({tooltip:{trigger:"item"},legend:{top:"3%",left:"center"},series:[{type:"pie",radius:["40%","70%"],avoidLabelOverlap:!0,itemStyle:{borderRadius:6,borderColor:"#fff",borderWidth:2},data:I.map(e=>({name:e.name,value:e.value}))}]});const t=()=>e.resize();return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t),e.dispose()}}return()=>{}},[I]),a.useEffect(()=>{if(E.current&&f){const e=Object.entries(f.eleitores_por_zona||{}),t=i(E.current);t.setOption({tooltip:{trigger:"axis"},xAxis:{type:"category",data:e.map(e=>String(e[0])),axisLabel:{rotate:30}},yAxis:{type:"value"},series:[{type:"line",smooth:!0,data:e.map(e=>Number(e[1])),itemStyle:{color:"#52c41a"}}]});const a=()=>t.resize();return window.addEventListener("resize",a),()=>{window.removeEventListener("resize",a),t.dispose()}}return()=>{}},[f]),a.useEffect(()=>{if(A.current&&f){const e=Object.entries(f.ativistas_por_funcao||{}),t=i(A.current);t.setOption({tooltip:{trigger:"axis"},xAxis:{type:"category",data:e.map(e=>String(e[0])),axisLabel:{rotate:30}},yAxis:{type:"value"},series:[{type:"bar",data:e.map(e=>Number(e[1])),itemStyle:{color:"#faad14"}}]});const a=()=>t.resize();return window.addEventListener("resize",a),()=>{window.removeEventListener("resize",a),t.dispose()}}return()=>{}},[f]),e.jsxs(t.div,{className:"dashboard-container",initial:{opacity:0},animate:{opacity:1},transition:{duration:.4},children:[h&&e.jsx("div",{className:"dashboard-loading",style:{position:"relative",zIndex:1,marginBottom:12},children:e.jsx(n,{size:"large"})}),"captar"===String(j).toLowerCase()&&v.length>0&&e.jsxs("div",{style:{marginBottom:12,display:"flex",gap:8,alignItems:"center"},children:[e.jsx("span",{style:{fontSize:12,color:"#666"},children:"VISUALIZAR:"}),e.jsx(o,{style:{minWidth:240},size:"small",placeholder:"Selecionar tenant",value:("undefined"!=typeof window?localStorage.getItem("viewTenantSlug"):null)||"",options:v,onChange:e=>{try{const t=v.find(t=>String(t.value).toLowerCase()===String(e).toLowerCase()),a=t?t.label:e;e?(localStorage.setItem("viewTenantSlug",String(e)),localStorage.setItem("viewTenantName",String(a))):(localStorage.removeItem("viewTenantSlug"),localStorage.removeItem("viewTenantName"))}catch{}C()}})]}),e.jsxs(l,{gutter:[16,16],className:"stats-row",children:[e.jsx(d,{xs:24,sm:12,md:8,xl:8,children:e.jsx(c,{style:{background:"#e6f4ff"},hoverable:!0,children:e.jsx(u,{title:"TOTAL DE ELEITORES",value:f?.total_eleitores||0,prefix:e.jsx(m,{}),valueStyle:{color:"#1677ff",fontWeight:700}})})}),e.jsx(d,{xs:24,sm:12,md:8,xl:8,children:e.jsx(c,{style:{background:"#f6ffed"},hoverable:!0,children:e.jsx(u,{title:"TOTAL DE ATIVISTAS",value:f?.total_ativistas||0,prefix:e.jsx(g,{}),valueStyle:{color:"#52c41a",fontWeight:700}})})}),e.jsx(d,{xs:24,sm:12,md:8,xl:8,children:e.jsx(c,{style:{background:"#fff7e6"},hoverable:!0,children:e.jsx(u,{title:"TOTAL DE USUÁRIOS",value:f?.total_usuarios||0,prefix:e.jsx(x,{}),valueStyle:{color:"#faad14",fontWeight:700}})})})]}),e.jsxs(l,{gutter:[16,16],style:{marginTop:12},children:[e.jsx(d,{xs:24,md:12,children:e.jsx(c,{title:"TOP USUÁRIOS (CADASTROS)",children:e.jsx("div",{ref:T,style:{width:"100%",height:320}})})}),e.jsx(d,{xs:24,md:12,children:e.jsx(c,{title:"TOP ATIVISTAS (CATEGORIAS)",children:e.jsx("div",{ref:b,style:{width:"100%",height:320}})})})]}),e.jsxs(l,{gutter:[16,16],style:{marginTop:12},children:[e.jsx(d,{xs:24,md:12,children:e.jsx(c,{title:"ELEITORES POR ZONA",children:e.jsx("div",{ref:E,style:{width:"100%",height:300}})})}),e.jsx(d,{xs:24,md:12,children:e.jsx(c,{title:"ATIVISTAS POR FUNÇÃO",children:e.jsx("div",{ref:A,style:{width:"100%",height:300}})})})]}),e.jsx(l,{gutter:[16,16],style:{marginTop:12},children:e.jsx(d,{xs:24,md:6,children:e.jsx(c,{children:e.jsx(u,{title:"TENANTS",value:N,valueStyle:{fontWeight:700}})})})})]})}export{f as default};
