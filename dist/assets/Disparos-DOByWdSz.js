import{u as e,j as r}from"./index-DfSuK2jA.js";import{r as a}from"./react-vendor-31_VYUn4.js";import{l as s,T as o,K as t,N as i,C as n,S as m,f as l,_ as u,t as c,B as A,$ as p,v as N}from"./ui-vendor-CwlfwZAq.js";import{m as d}from"./utils-DLZ5AbYM.js";import"./charts-vendor-CRs37Wg2.js";function D(){const[D,g]=a.useState(!1),[S,h]=a.useState([]),[O,b]=a.useState([]),[E,T]=a.useState(null),[R,x]=a.useState(null),[P,f]=a.useState(""),[v,C]=a.useState(!1),[V,j]=a.useState({}),[J,w]=a.useState({current:1,pageSize:50}),I=e(),{message:_}=s.useApp(),y=e=>{const r=String(e).toUpperCase().trim();return"ENVIADO"===r||"ENTREGUE"===r||"VISUALIZADO"===r?"green":"FALHA"===r?"red":"PENDENTE"===r?"default":"blue"},U=e=>{const r=String(e).toUpperCase().trim();return"POSITIVO"===r?"green":"NEGATIVO"===r?"red":"AGUARDANDO"===r?"default":"blue"},z=a.useMemo(()=>{const e=[{title:"NOME",dataIndex:"nome",align:"left",sorter:(e,r)=>String(e.nome||"").localeCompare(String(r.nome||""))},{title:"NÚMERO",dataIndex:"numero",align:"left",sorter:(e,r)=>String(e.numero||"").localeCompare(String(r.numero||"")),render:e=>{const a=String(e||"").trim(),s=a?V[a]:void 0;return r.jsxDEV(m,{size:8,wrap:!0,children:[r.jsxDEV("span",{children:a||"—"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:50,columnNumber:15},this),!0===s?r.jsxDEV(o,{color:"green",children:"WHATSAPP VÁLIDO"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:51,columnNumber:32},this):null,!1===s?r.jsxDEV(o,{color:"red",children:"WHATSAPP INVÁLIDO"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:52,columnNumber:33},this):null]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:49,columnNumber:13},this)}},{title:"STATUS ENVIO",dataIndex:"envio_status",align:"center",render:e=>{const a=String(e||"").toUpperCase()||"—";return r.jsxDEV(o,{color:y(a),children:a},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:63,columnNumber:18},this)}},{title:"DATA ENVIO",dataIndex:"envio_datahora",align:"center",render:e=>e?new Date(e).toLocaleString("pt-BR",{hour12:!1}):"—",sorter:(e,r)=>new Date(e.envio_datahora||0).getTime()-new Date(r.envio_datahora||0).getTime()},{title:"ENTREGUE",dataIndex:"entregue_em",align:"center",render:e=>e?new Date(e).toLocaleString("pt-BR",{hour12:!1}):"—",sorter:(e,r)=>new Date(e.entregue_em||0).getTime()-new Date(r.entregue_em||0).getTime()},{title:"VISUALIZADO",dataIndex:"visualizado_em",align:"center",render:e=>e?new Date(e).toLocaleString("pt-BR",{hour12:!1}):"—",sorter:(e,r)=>new Date(e.visualizado_em||0).getTime()-new Date(r.visualizado_em||0).getTime()},{title:"STATUS DA MENSAGEM",dataIndex:"__status_mensagem__",align:"center",render:(e,a)=>{const s=!!a?.entregue_em,t=!!a?.visualizado_em;return s?r.jsxDEV(m,{size:6,wrap:!0,children:[r.jsxDEV(o,{color:"green",children:"RECEBIDO"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:97,columnNumber:15},this),t?r.jsxDEV(o,{color:"blue",children:"VISUALIZADO"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:98,columnNumber:30},this):r.jsxDEV(o,{children:"AGUARDANDO VISUALIZAÇÃO"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:98,columnNumber:68},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:96,columnNumber:13},this):r.jsxDEV(o,{color:"red",children:"NÃO RECEBIDO"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:94,columnNumber:33},this)}}];return v?[...e,{title:"RESPOSTA",dataIndex:"resposta_classificacao",align:"center",render:e=>{const a=String(e||"").toUpperCase()||"—";return r.jsxDEV(o,{color:U(a),children:a},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:115,columnNumber:18},this)}},{title:"DATA RESPOSTA",dataIndex:"resposta_datahora",align:"center",render:e=>e?new Date(e).toLocaleString("pt-BR",{hour12:!1}):"—",sorter:(e,r)=>new Date(e.resposta_datahora||0).getTime()-new Date(r.resposta_datahora||0).getTime()}]:e},[v,V]),L=async e=>{const r="number"==typeof e?e:E;if(r)try{g(!0),j({}),w({current:1,pageSize:50});const e=await I.getCampanhaDisparosGrid(r),a=e.rows||[];h(a),x(e.stats||null),f(String(e.pergunta||""));try{const r=e?.campanha?.anexo_json,a="string"==typeof r?JSON.parse(r):r,s=a?.config||{};C("SIM_NAO"===String(s?.response_mode||"").toUpperCase())}catch{C(!1)}try{const e=a.slice(0,50),r=Array.from(new Set(e.map(e=>String(e?.numero||"").trim()).filter(Boolean)));if(r.length){const e=await I.whatsappCheckNumbers({numbers:r}),a={};for(const r of e?.rows||[]){const e=String(r?.number||"").trim();e&&(a[e]=!!r?.is_whatsapp)}j(a)}}catch{}}catch(a){_.error(a?.response?.data?.detail||"Erro ao carregar disparos da campanha")}finally{g(!1)}};a.useEffect(()=>{(async()=>{try{g(!0);const e=(await I.getCampanhas()).rows||[];if(b(e),e.length&&null===E){const r=e[0];r?.id&&T(Number(r.id))}}catch(e){_.error(e?.response?.data?.detail||"Erro ao carregar campanhas")}finally{g(!1)}})()},[]),a.useEffect(()=>{E&&L(E)},[E]);const B=a.useMemo(()=>(O||[]).map(e=>({label:`${String(e.nome||"").toUpperCase()} (${e.id})`,value:Number(e.id)})),[O]),G=a.useMemo(()=>O.find(e=>Number(e.id)===Number(E)),[O,E]);return r.jsxDEV(d.div,{className:"page-container",initial:{opacity:0,y:6},animate:{opacity:1,y:0},transition:{duration:.3},children:r.jsxDEV(t,{gutter:[16,16],children:[r.jsxDEV(i,{span:24,children:r.jsxDEV(n,{children:r.jsxDEV(m,{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[r.jsxDEV(m,{children:[r.jsxDEV(l,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:206,columnNumber:17},this),r.jsxDEV(u.Title,{level:4,style:{margin:0},children:"AUTOMAÇÃO • DISPAROS"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:207,columnNumber:17},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:205,columnNumber:15},this),r.jsxDEV(m,{children:[r.jsxDEV(c,{style:{width:420},placeholder:"Selecione uma campanha",showSearch:!0,optionFilterProp:"label",value:E??void 0,options:B,onChange:e=>T(Number(e))},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:210,columnNumber:17},this),r.jsxDEV(A,{icon:r.jsxDEV(p,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:219,columnNumber:31},this),onClick:()=>L(),children:"Atualizar"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:219,columnNumber:17},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:209,columnNumber:15},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:204,columnNumber:13},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:203,columnNumber:11},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:202,columnNumber:9},this),r.jsxDEV(i,{span:24,children:r.jsxDEV(n,{children:[r.jsxDEV(m,{style:{marginBottom:12,width:"100%",justifyContent:"space-between"},children:[r.jsxDEV(m,{children:[r.jsxDEV(u.Text,{strong:!0,children:G?String(G.nome||"").toUpperCase():"—"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:228,columnNumber:17},this),P?r.jsxDEV(o,{color:"blue",children:P},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:229,columnNumber:29},this):null]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:227,columnNumber:15},this),r.jsxDEV(m,{wrap:!0,children:[r.jsxDEV(o,{color:"default",children:["CONTATOS: ",Number(R?.total_contatos||0)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:232,columnNumber:17},this),r.jsxDEV(o,{color:"green",children:["ENVIADOS: ",Number(R?.enviados||0)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:233,columnNumber:17},this),r.jsxDEV(o,{color:"green",children:["ENTREGUES: ",Number(R?.entregues||0)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:234,columnNumber:17},this),r.jsxDEV(o,{color:"green",children:["VISUALIZADOS: ",Number(R?.visualizados||0)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:235,columnNumber:17},this),r.jsxDEV(o,{color:"red",children:["FALHAS: ",Number(R?.falhas||0)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:236,columnNumber:17},this),v&&r.jsxDEV(o,{color:"blue",children:["RESPOSTAS: ",Number(R?.respostas||0)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:237,columnNumber:39},this),v&&r.jsxDEV(o,{color:"green",children:["POSITIVOS: ",Number(R?.positivos||0)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:238,columnNumber:39},this),v&&r.jsxDEV(o,{color:"red",children:["NEGATIVOS: ",Number(R?.negativos||0)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:239,columnNumber:39},this),v&&r.jsxDEV(o,{color:"default",children:["AGUARDANDO: ",Number(R?.aguardando||0)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:240,columnNumber:39},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:231,columnNumber:15},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:226,columnNumber:13},this),r.jsxDEV(N,{rowKey:e=>String(e.numero||JSON.stringify(e)),loading:D,dataSource:S,columns:z,size:"small",bordered:!0,pagination:{pageSize:J.pageSize,current:J.current,showSizeChanger:!0},onChange:async(e,r,a,s)=>{const o={current:Number(e?.current||1),pageSize:Number(e?.pageSize||50)};w(o);try{const e=(o.current-1)*o.pageSize,r=(s?.currentDataSource||S).slice(e,e+o.pageSize),a=Array.from(new Set(r.map(e=>String(e?.numero||"").trim()).filter(Boolean))).filter(e=>void 0===V[e]);if(!a.length)return;const t=await I.whatsappCheckNumbers({numbers:a}),i=t?.rows||[];j(e=>{const r={...e};for(const a of i){const e=String(a?.number||"").trim();e&&(r[e]=!!a?.is_whatsapp)}return r})}catch{}}},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:243,columnNumber:13},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:225,columnNumber:11},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:224,columnNumber:9},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:201,columnNumber:7},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Disparos.tsx",lineNumber:200,columnNumber:5},this)}export{D as default};
