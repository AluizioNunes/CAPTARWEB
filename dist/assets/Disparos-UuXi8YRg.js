import{j as e,m as r}from"./utils-CdldNp8C.js";import{r as t}from"./react-vendor-qiAl16-a.js";import{u as a}from"./index-Di9gGO82.js";import{l as s,T as n,K as o,N as i,C as l,S as d,f as c,Z as u,t as p,B as m,_ as h,$ as g,v as S}from"./ui-vendor-W3kvUvq_.js";function x(){const[x,j]=t.useState(!1),[f,N]=t.useState([]),[A,O]=t.useState([]),[T,b]=t.useState(null),[y,w]=t.useState(null),[E,D]=t.useState(""),I=a(),{message:C}=s.useApp(),v=e=>{const r=String(e).toUpperCase().trim();return"ENVIADO"===r?"green":"FALHA"===r?"red":"PENDENTE"===r?"default":"blue"},_=e=>{const r=String(e).toUpperCase().trim();return"POSITIVO"===r?"green":"NEGATIVO"===r?"red":"AGUARDANDO"===r?"default":"blue"},U=t.useMemo(()=>[{title:"NOME",dataIndex:"nome",align:"left",sorter:(e,r)=>String(e.nome||"").localeCompare(String(r.nome||""))},{title:"NÚMERO",dataIndex:"numero",align:"left",sorter:(e,r)=>String(e.numero||"").localeCompare(String(r.numero||""))},{title:"STATUS ENVIO",dataIndex:"envio_status",align:"center",render:r=>{const t=String(r||"").toUpperCase()||"—";return e.jsx(n,{color:v(t),children:t})}},{title:"DATA ENVIO",dataIndex:"envio_datahora",align:"center",render:e=>e?new Date(e).toLocaleString("pt-BR",{hour12:!1}):"—",sorter:(e,r)=>new Date(e.envio_datahora||0).getTime()-new Date(r.envio_datahora||0).getTime()},{title:"RESPOSTA",dataIndex:"resposta_classificacao",align:"center",render:r=>{const t=String(r||"").toUpperCase()||"—";return e.jsx(n,{color:_(t),children:t})}},{title:"DATA RESPOSTA",dataIndex:"resposta_datahora",align:"center",render:e=>e?new Date(e).toLocaleString("pt-BR",{hour12:!1}):"—",sorter:(e,r)=>new Date(e.resposta_datahora||0).getTime()-new Date(r.resposta_datahora||0).getTime()},{title:"TEXTO",dataIndex:"resposta_texto",align:"left",render:e=>{const r=String(e??"").trim();return r?r.length>120?`${r.slice(0,120)}…`:r:"—"}}],[]),R=async e=>{const r="number"==typeof e?e:T;if(r)try{j(!0);const e=await I.getCampanhaDisparosGrid(r);N(e.rows||[]),w(e.stats||null),D(String(e.pergunta||""))}catch(t){C.error(t?.response?.data?.detail||"Erro ao carregar disparos da campanha")}finally{j(!1)}};t.useEffect(()=>{(async()=>{try{j(!0);const e=(await I.getCampanhas()).rows||[];if(O(e),e.length&&null===T){const r=e[0];r?.id&&b(Number(r.id))}}catch(e){C.error(e?.response?.data?.detail||"Erro ao carregar campanhas")}finally{j(!1)}})()},[]),t.useEffect(()=>{T&&R(T)},[T]);const P=t.useMemo(()=>(A||[]).map(e=>({label:`${String(e.nome||"").toUpperCase()} (${e.id})`,value:Number(e.id)})),[A]),V=t.useMemo(()=>A.find(e=>Number(e.id)===Number(T)),[A,T]);return e.jsx(r.div,{className:"page-container",initial:{opacity:0,y:6},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsxs(o,{gutter:[16,16],children:[e.jsx(i,{span:24,children:e.jsx(l,{children:e.jsxs(d,{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[e.jsxs(d,{children:[e.jsx(c,{}),e.jsx(u.Title,{level:4,style:{margin:0},children:"AUTOMAÇÃO • DISPAROS"})]}),e.jsxs(d,{children:[e.jsx(p,{style:{width:420},placeholder:"Selecione uma campanha",showSearch:!0,optionFilterProp:"label",value:T??void 0,options:P,onChange:e=>b(Number(e))}),e.jsx(m,{icon:e.jsx(h,{}),onClick:()=>R(),children:"Atualizar"}),e.jsx(m,{type:"primary",icon:e.jsx(g,{}),children:"Novo Disparo"})]})]})})}),e.jsx(i,{span:24,children:e.jsxs(l,{children:[e.jsxs(d,{style:{marginBottom:12,width:"100%",justifyContent:"space-between"},children:[e.jsxs(d,{children:[e.jsx(u.Text,{strong:!0,children:V?String(V.nome||"").toUpperCase():"—"}),E?e.jsx(n,{color:"blue",children:E}):null]}),e.jsxs(d,{wrap:!0,children:[e.jsxs(n,{color:"default",children:["CONTATOS: ",Number(y?.total_contatos||0)]}),e.jsxs(n,{color:"green",children:["ENVIADOS: ",Number(y?.enviados||0)]}),e.jsxs(n,{color:"red",children:["FALHAS: ",Number(y?.falhas||0)]}),e.jsxs(n,{color:"blue",children:["RESPOSTAS: ",Number(y?.respostas||0)]}),e.jsxs(n,{color:"green",children:["POSITIVOS: ",Number(y?.positivos||0)]}),e.jsxs(n,{color:"red",children:["NEGATIVOS: ",Number(y?.negativos||0)]}),e.jsxs(n,{color:"default",children:["AGUARDANDO: ",Number(y?.aguardando||0)]})]})]}),e.jsx(S,{rowKey:e=>String(e.numero||JSON.stringify(e)),loading:x,dataSource:f,columns:U,size:"small",bordered:!0,pagination:{pageSize:50,showSizeChanger:!0}})]})})]})})}export{x as default};
