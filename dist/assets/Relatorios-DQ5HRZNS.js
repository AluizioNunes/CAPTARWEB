import{u as e,j as a}from"./index-DfSuK2jA.js";import{r as o}from"./react-vendor-31_VYUn4.js";import{l as i,K as t,N as r,C as s,S as l,c as m,_ as n,B as c,$ as u,t as d,I as R,v as A,i as N,Q as p,T as b}from"./ui-vendor-CwlfwZAq.js";import{m as x}from"./utils-DLZ5AbYM.js";import"./charts-vendor-CRs37Wg2.js";function h(){const h=e(),{message:O}=i.useApp(),[T,P]=o.useState(!1),[E,D]=o.useState(!1),[g,S]=o.useState([]),[C,f]=o.useState(void 0),[v,j]=o.useState(""),[J,V]=o.useState("portrait"),[y,w]=o.useState([]),[I,k]=o.useState(!1),[U,L]=o.useState(null),_=async e=>{try{const a=await h.downloadRelatorioPdf(e,J),o=window.URL.createObjectURL(a);if(!window.open(o,"_blank")){const a=document.createElement("a");a.href=o,a.download=`relatorio_${e}.pdf`,document.body.appendChild(a),a.click(),a.remove()}window.setTimeout(()=>window.URL.revokeObjectURL(o),3e3)}catch(a){O.error(a?.response?.data?.detail||"Erro ao baixar PDF")}},F=o.useMemo(()=>(g||[]).map(e=>({label:`${e.nome} (#${e.id})`,value:Number(e.id)})),[g]),M=[{title:"ID",dataIndex:"id",align:"center",sorter:(e,a)=>Number(e.id)-Number(a.id)},{title:"CAMPANHA",dataIndex:"campanha_id",align:"center",render:e=>e?String(e):"—"},{title:"TÍTULO",dataIndex:"titulo",align:"left",render:e=>String(e||"")||"—"},{title:"TIPO",dataIndex:"tipo",align:"center",render:e=>a.jsxDEV(b,{children:String(e||"").toUpperCase()||"—"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:50,columnNumber:78},this)},{title:"CRIADO EM",dataIndex:"criado_em",align:"center",render:e=>e?new Date(e).toLocaleString("pt-BR",{hour12:!1}):"—"},{title:"CRIADO POR",dataIndex:"criado_por",align:"left",render:e=>e?String(e):"—"},{title:"AÇÕES",dataIndex:"id",align:"center",render:(e,o)=>a.jsxDEV(l,{children:[a.jsxDEV(c,{size:"small",onClick:async()=>{try{const e=await h.getRelatorio(Number(o.id));L(e),k(!0)}catch(e){O.error(e?.response?.data?.detail||"Erro ao abrir relatório")}},children:"Abrir"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:59,columnNumber:11},this),"COMPROVANTE"===String(o?.tipo||"").toUpperCase()?a.jsxDEV(c,{size:"small",icon:a.jsxDEV(p,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:71,columnNumber:40},this),onClick:()=>_(Number(o.id)),children:"PDF"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:71,columnNumber:13},this):null]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:58,columnNumber:9},this)}],z=async()=>{try{P(!0);const[e,a]=await Promise.all([h.getCampanhas(),h.getRelatorios({limit:200})]);S(e.rows||[]),w(a.rows||[])}catch(e){O.error(e?.response?.data?.detail||"Erro ao carregar relatórios")}finally{P(!1)}};o.useEffect(()=>{z()},[]);return a.jsxDEV(x.div,{className:"page-container",initial:{opacity:0,y:6},animate:{opacity:1,y:0},transition:{duration:.3},children:[a.jsxDEV(t,{gutter:[16,16],children:[a.jsxDEV(r,{span:24,children:a.jsxDEV(s,{children:a.jsxDEV(l,{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[a.jsxDEV(l,{children:[a.jsxDEV(m,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:123,columnNumber:17},this),a.jsxDEV(n.Title,{level:4,style:{margin:0},children:"AUTOMAÇÃO • RELATÓRIOS"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:124,columnNumber:17},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:122,columnNumber:15},this),a.jsxDEV(c,{icon:a.jsxDEV(u,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:126,columnNumber:29},this),onClick:z,children:"Atualizar"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:126,columnNumber:15},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:121,columnNumber:13},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:120,columnNumber:11},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:119,columnNumber:9},this),a.jsxDEV(r,{span:24,children:a.jsxDEV(s,{title:"Gerar comprovante",children:a.jsxDEV(t,{gutter:[12,12],children:[a.jsxDEV(r,{xs:24,md:8,children:[a.jsxDEV(n.Text,{children:"Campanha"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:135,columnNumber:17},this),a.jsxDEV(d,{style:{width:"100%"},showSearch:!0,optionFilterProp:"label",placeholder:"Selecione",value:C,onChange:e=>f(Number(e)),options:F},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:136,columnNumber:17},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:134,columnNumber:15},this),a.jsxDEV(r,{xs:24,md:8,children:[a.jsxDEV(n.Text,{children:"Título (opcional)"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:147,columnNumber:17},this),a.jsxDEV(R,{value:v,onChange:e=>j(e.target.value),placeholder:"Comprovante..."},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:148,columnNumber:17},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:146,columnNumber:15},this),a.jsxDEV(r,{xs:24,md:4,children:[a.jsxDEV(n.Text,{children:"Orientação PDF"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:151,columnNumber:17},this),a.jsxDEV(d,{style:{width:"100%"},placeholder:"Selecione",value:J,onChange:e=>V(e),options:[{label:"Retrato",value:"portrait"},{label:"Paisagem",value:"landscape"}]},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:152,columnNumber:17},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:150,columnNumber:15},this),a.jsxDEV(r,{xs:24,md:4,style:{display:"flex",alignItems:"end"},children:a.jsxDEV(c,{type:"primary",block:!0,loading:E,onClick:async()=>{if(C)try{D(!0),await h.createRelatorioComprovante({campanha_id:C,titulo:v||void 0}),j(""),await z(),O.success("Relatório gerado")}catch(e){O.error(e?.response?.data?.detail||"Erro ao gerar relatório")}finally{D(!1)}else O.warning("Selecione uma campanha")},children:"Gerar"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:164,columnNumber:17},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:163,columnNumber:15},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:133,columnNumber:13},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:132,columnNumber:11},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:131,columnNumber:9},this),a.jsxDEV(r,{span:24,children:a.jsxDEV(s,{children:a.jsxDEV(A,{rowKey:e=>e.id||JSON.stringify(e),loading:T,dataSource:y,columns:M,size:"small",bordered:!0},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:172,columnNumber:13},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:171,columnNumber:11},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:170,columnNumber:9},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:118,columnNumber:7},this),a.jsxDEV(N,{open:I,onCancel:()=>k(!1),width:900,footer:a.jsxDEV(l,{children:["COMPROVANTE"===String(U?.tipo||"").toUpperCase()&&U?.id?a.jsxDEV(c,{icon:a.jsxDEV(p,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:191,columnNumber:29},this),onClick:()=>_(Number(U.id)),children:"Baixar PDF"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:191,columnNumber:15},this):null,a.jsxDEV(c,{onClick:()=>k(!1),children:"Fechar"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:195,columnNumber:13},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:189,columnNumber:11},this),title:U?.titulo||"Relatório",children:a.jsxDEV("pre",{style:{margin:0,maxHeight:520,overflow:"auto"},children:U?JSON.stringify(U,null,2):""},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:200,columnNumber:9},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:184,columnNumber:7},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Relatorios.tsx",lineNumber:117,columnNumber:5},this)}export{h as default};
