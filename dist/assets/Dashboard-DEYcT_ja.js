import{j as e,m as t}from"./utils-CdldNp8C.js";import{r as a}from"./react-vendor-qiAl16-a.js";import{i as s}from"./charts-vendor-DwS0P6Ka.js";import{u as r}from"./index-2VJChLdb.js";import{h as i,Z as n,t as o,J as l,K as d,C as c,_ as u,a as m,b as g,c as x}from"./ui-vendor-BtVq8T1Y.js";function f(){const{message:f}=i.useApp(),[p,h]=a.useState(null),[S,v]=a.useState(!0),[y,j]=a.useState([]),w=("undefined"!=typeof window?localStorage.getItem("tenantSlug"):null)||"captar",T=r(),b=a.useRef(null),A=a.useRef(null),E=a.useRef(null),O=a.useRef(null);a.useRef(null);const[L,I]=a.useState([]),[z,N]=a.useState([]),[R,C]=a.useState(0);a.useEffect(()=>{(async()=>{try{if("captar"===String(w).toLowerCase()){try{localStorage.setItem("adminContext","1")}catch{}const e=await T.listTenants(),t=(e.rows||[]).filter(e=>"captar"!==String(e.Slug??e.slug).toLowerCase()),a=t.length>0?[{label:"TODOS OS TENANTS",value:""},...t.map(e=>({label:String(e.Nome??e.nome),value:String(e.Slug??e.slug)}))]:[];j(a)}else j([])}catch{}U()})()},[]);const U=async()=>{try{v(!0);const e=await T.getDashboardStats();h(e);try{const e=(await T.getTopUsuarios()||[]).map(e=>({name:String(e["Usuário"]??e.usuario??""),value:Number(e.Quantidade??e.qtd??0)}));I(e)}catch{}try{const e=(await T.getTopAtivistas()||[]).map(e=>({name:String(e.Categoria??e.categoria??""),value:Number(e.Quantidade??e.qtd??0)}));N(e)}catch{}try{const e=await T.listTenants();C((e.rows||[]).length)}catch{}}catch(e){f.error("Erro ao carregar dados do dashboard")}finally{v(!1)}};return a.useEffect(()=>{if(b.current){const e=s(b.current);e.setOption({tooltip:{trigger:"axis"},xAxis:{type:"category",data:L.map(e=>e.name),axisLabel:{rotate:30}},yAxis:{type:"value"},series:[{type:"bar",data:L.map(e=>e.value),itemStyle:{color:"#1677ff"}}]});const t=()=>e.resize();return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t),e.dispose()}}},[L]),a.useEffect(()=>{if(A.current){const e=s(A.current);e.setOption({tooltip:{trigger:"item"},legend:{top:"3%",left:"center"},series:[{type:"pie",radius:["40%","70%"],avoidLabelOverlap:!0,itemStyle:{borderRadius:6,borderColor:"#fff",borderWidth:2},data:z.map(e=>({name:e.name,value:e.value}))}]});const t=()=>e.resize();return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t),e.dispose()}}},[z]),a.useEffect(()=>{if(E.current&&p){const e=Object.entries(p.eleitores_por_zona||{}),t=s(E.current);t.setOption({tooltip:{trigger:"axis"},xAxis:{type:"category",data:e.map(e=>String(e[0])),axisLabel:{rotate:30}},yAxis:{type:"value"},series:[{type:"line",smooth:!0,data:e.map(e=>Number(e[1])),itemStyle:{color:"#52c41a"}}]});const a=()=>t.resize();return window.addEventListener("resize",a),()=>{window.removeEventListener("resize",a),t.dispose()}}},[p]),a.useEffect(()=>{if(O.current&&p){const e=Object.entries(p.ativistas_por_funcao||{}),t=s(O.current);t.setOption({tooltip:{trigger:"axis"},xAxis:{type:"category",data:e.map(e=>String(e[0])),axisLabel:{rotate:30}},yAxis:{type:"value"},series:[{type:"bar",data:e.map(e=>Number(e[1])),itemStyle:{color:"#faad14"}}]});const a=()=>t.resize();return window.addEventListener("resize",a),()=>{window.removeEventListener("resize",a),t.dispose()}}},[p]),e.jsxs(t.div,{className:"dashboard-container",initial:{opacity:0},animate:{opacity:1},transition:{duration:.4},children:[S&&e.jsx("div",{className:"dashboard-loading",style:{position:"relative",zIndex:1,marginBottom:12},children:e.jsx(n,{size:"large"})}),"captar"===String(w).toLowerCase()&&y.length>0&&e.jsxs("div",{style:{marginBottom:12,display:"flex",gap:8,alignItems:"center"},children:[e.jsx("span",{style:{fontSize:12,color:"#666"},children:"VISUALIZAR:"}),e.jsx(o,{style:{minWidth:240},size:"small",placeholder:"Selecionar tenant",value:("undefined"!=typeof window?localStorage.getItem("viewTenantSlug"):null)||"",options:y,onChange:e=>{try{const t=y.find(t=>String(t.value).toLowerCase()===String(e).toLowerCase()),a=t?t.label:e;e?(localStorage.setItem("viewTenantSlug",String(e)),localStorage.setItem("viewTenantName",String(a))):(localStorage.removeItem("viewTenantSlug"),localStorage.removeItem("viewTenantName"))}catch{}U()}})]}),e.jsxs(l,{gutter:[16,16],className:"stats-row",children:[e.jsx(d,{xs:24,sm:12,md:8,xl:8,children:e.jsx(c,{style:{background:"#e6f4ff"},hoverable:!0,children:e.jsx(u,{title:"TOTAL DE ELEITORES",value:p?.total_eleitores||0,prefix:e.jsx(m,{}),valueStyle:{color:"#1677ff",fontWeight:700}})})}),e.jsx(d,{xs:24,sm:12,md:8,xl:8,children:e.jsx(c,{style:{background:"#f6ffed"},hoverable:!0,children:e.jsx(u,{title:"TOTAL DE ATIVISTAS",value:p?.total_ativistas||0,prefix:e.jsx(g,{}),valueStyle:{color:"#52c41a",fontWeight:700}})})}),e.jsx(d,{xs:24,sm:12,md:8,xl:8,children:e.jsx(c,{style:{background:"#fff7e6"},hoverable:!0,children:e.jsx(u,{title:"TOTAL DE USUÁRIOS",value:p?.total_usuarios||0,prefix:e.jsx(x,{}),valueStyle:{color:"#faad14",fontWeight:700}})})})]}),e.jsxs(l,{gutter:[16,16],style:{marginTop:12},children:[e.jsx(d,{xs:24,md:12,children:e.jsx(c,{title:"TOP USUÁRIOS (CADASTROS)",children:e.jsx("div",{ref:b,style:{width:"100%",height:320}})})}),e.jsx(d,{xs:24,md:12,children:e.jsx(c,{title:"TOP ATIVISTAS (CATEGORIAS)",children:e.jsx("div",{ref:A,style:{width:"100%",height:320}})})})]}),e.jsxs(l,{gutter:[16,16],style:{marginTop:12},children:[e.jsx(d,{xs:24,md:12,children:e.jsx(c,{title:"ELEITORES POR ZONA",children:e.jsx("div",{ref:E,style:{width:"100%",height:300}})})}),e.jsx(d,{xs:24,md:12,children:e.jsx(c,{title:"ATIVISTAS POR FUNÇÃO",children:e.jsx("div",{ref:O,style:{width:"100%",height:300}})})})]}),e.jsx(l,{gutter:[16,16],style:{marginTop:12},children:e.jsx(d,{xs:24,md:6,children:e.jsx(c,{children:e.jsx(u,{title:"TENANTS",value:R,valueStyle:{fontWeight:700}})})})})]})}export{f as default};
