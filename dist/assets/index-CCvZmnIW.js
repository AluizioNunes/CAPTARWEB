const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Dashboard-BHYDSYyS.js","assets/utils-CdldNp8C.js","assets/react-vendor-qiAl16-a.js","assets/charts-vendor-DwS0P6Ka.js","assets/ui-vendor-BtVq8T1Y.js","assets/Estatisticas-DJbptZDc.js","assets/Tenants-y579Rx6U.js"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=(t,a,r)=>((t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r)(t,"symbol"!=typeof a?a+"":a,r);import{a,j as r,p as n,i as s,c as o,b as i,d as l,e as c,f as d,g as u,m,A as p}from"./utils-CdldNp8C.js";import{f as h,g,r as f,R as x,u as y,h as j,B as S,i as w,j as v,N as b}from"./react-vendor-qiAl16-a.js";import{L as C,R as I,a as A,b as T,c as N,d as E,e as U,M as k,D,B as P,A as O,f as R,g as F,h as M,F as L,i as _,I as $,j as V,S as z,T as q,k as B,l as W,m as H,n as Y,P as J,o as G,C as K,p as X,q as Z,r as Q,s as ee,t as te,u as ae,v as re,w as ne,x as se,y as oe,z as ie,E as le,G as ce,H as de,J as ue,K as me,N as pe,O as he,Q as ge,U as fe,V as xe,W as ye,X as je,Y as Se}from"./ui-vendor-BtVq8T1Y.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var we,ve={};const be=g(function(){if(we)return ve;we=1;var e=h();return ve.createRoot=e.createRoot,ve.hydrateRoot=e.hydrateRoot,ve}()),Ce=void 0!==import.meta&&{BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_URL:"http://localhost:8001/api",VITE_APP_NAME:"CAPTAR v2.0"}?"http://localhost:8001/api":"/api";const Ie=new class{constructor(){t(this,"api"),this.api=a.create({baseURL:Ce,headers:{"Content-Type":"application/json"}}),this.api.interceptors.request.use(e=>{const t=localStorage.getItem("token");t&&(e.headers.Authorization=`Bearer ${t}`);const a=String(e.url||"").includes("/auth/login"),r=!(!e.headers||!e.headers["X-Tenant"]);if(a)!r&&e.headers&&delete e.headers["X-Tenant"];else{const t=localStorage.getItem("rootTenantSlug")||"captar",a="1"===localStorage.getItem("adminContext"),r=localStorage.getItem("tenantSlug")||"captar",n=a&&"captar"===String(t).toLowerCase()?"captar":r;e.headers["X-Tenant"]=n;const s=localStorage.getItem("viewTenantSlug")||"";a&&s?e.headers["X-View-Tenant"]=s:e.headers["X-View-Tenant"]&&delete e.headers["X-View-Tenant"]}return e}),this.api.interceptors.response.use(e=>e,e=>(401===e.response?.status&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(e)))}async login(e){const t=async t=>{const a=t??"captar",r=a?{headers:{"X-Tenant":a}}:{},n=(await this.api.post("/auth/login",e,r)).data,s=String((n?.tenantSlug??n?.tenant??n?.slug??n?.TenantSlug??n?.Tenant)||a);localStorage.setItem("tenantSlug",s);try{localStorage.getItem("rootTenantSlug")||localStorage.setItem("rootTenantSlug",s),"captar"===s.toLowerCase()&&(localStorage.setItem("rootTenantSlug","captar"),localStorage.setItem("adminContext","1"))}catch{}try{const e=await this.listTenants(),t=(e.rows||[]).find(e=>String(e.Slug??e.slug).toUpperCase()===s.toUpperCase()),a=t?String(t.Nome??t.nome):s;localStorage.setItem("tenantName",a)}catch{}if(n&&n.token&&!n.user){const e={id:n.id,nome:n.nome,funcao:n.funcao,usuario:n.usuario,email:n.email,cpf:n.cpf,perfil:n.funcao};return{token:n.token,user:e}}return n};try{return await t()}catch(a){try{return await t("captar")}catch(r){try{const e=await this.listTenants().catch(()=>({rows:[]})),a=(e.rows||[]).map(e=>String(e.Slug??e.slug??"")).filter(Boolean);for(const r of a)try{return await t(r)}catch{}}catch{}throw a}}}async healthDb(){try{return(await this.api.get("/health/db")).data}catch(e){try{return{ok:!!(await this.api.get("/health")).data}}catch(t){try{const e=a.create({baseURL:"http://localhost:8001",headers:{"Content-Type":"application/json"}});return(await e.get("/api/health/db")).data}catch(r){const e=a.create({baseURL:"http://localhost:8001",headers:{"Content-Type":"application/json"}});return{ok:!!(await e.get("/health")).data}}}}}async logout(){await this.api.post("/auth/logout")}async getCurrentUser(){return(await this.api.get("/auth/me")).data}async getPermissoes(){return(await this.api.get("/permissoes")).data}async getPermissao(e){return(await this.api.get(`/permissoes/${e}`)).data}async updatePermissao(e,t){return(await this.api.put(`/permissoes/${e}`,t)).data}async createPermissao(e){return(await this.api.post("/permissoes",e)).data}async deletePermissao(e){return(await this.api.delete(`/permissoes/${e}`)).data}async getPerfilSchema(){try{return(await this.api.get("/perfil/schema")).data}catch(e){const t=a.create({baseURL:"http://localhost:8001/api",headers:{"Content-Type":"application/json"}});return(await t.get("/perfil/schema")).data}}async listPerfil(){const e=(localStorage.getItem("tenantSlug")||"captar").toLowerCase(),t=await this.api.get("/perfil").then(e=>e.data).catch(async()=>{const e=a.create({baseURL:"http://localhost:8001/api",headers:{"Content-Type":"application/json"}});return(await e.get("/perfil")).data});if("captar"===e)return t;const r={"Content-Type":"application/json","X-Tenant":"captar"},n=localStorage.getItem("token");n&&(r.Authorization=`Bearer ${n}`);const s=a.create({baseURL:Ce,headers:r}),o=await s.get("/perfil").then(e=>e.data).catch(async()=>{const e=a.create({baseURL:"http://localhost:8001/api",headers:r});return(await e.get("/perfil")).data}),i=t.rows||[],l=o.rows||[],c={};for(const a of[...l,...i]){const e=String(a.Perfil??a.perfil??a.Descricao??a.descricao??"").toUpperCase();c[e]||(c[e]=a)}return{rows:Object.values(c),columns:t.columns||o.columns||[]}}async createPerfil(e){try{return(await this.api.post("/perfil",e)).data}catch(t){const r=a.create({baseURL:"http://localhost:8000/api",headers:{"Content-Type":"application/json"}});return(await r.post("/perfil",e)).data}}async updatePerfil(e,t){try{return(await this.api.put(`/perfil/${e}`,t)).data}catch(r){const n=a.create({baseURL:"http://localhost:8000/api",headers:{"Content-Type":"application/json"}});return(await n.put(`/perfil/${e}`,t)).data}}async deletePerfil(e){try{return(await this.api.delete(`/perfil/${e}`)).data}catch(t){const r=a.create({baseURL:"http://localhost:8000/api",headers:{"Content-Type":"application/json"}});return(await r.delete(`/perfil/${e}`)).data}}async getFuncoesSchema(){return(await this.api.get("/funcoes/schema")).data}async listFuncoes(){const e=(localStorage.getItem("tenantSlug")||"captar").toLowerCase(),t=await this.api.get("/funcoes").then(e=>e.data).catch(async()=>{const e=a.create({baseURL:"http://localhost:8001/api",headers:{"Content-Type":"application/json"}});return(await e.get("/funcoes")).data});if("captar"===e)return t;const r={"Content-Type":"application/json","X-Tenant":"captar"},n=localStorage.getItem("token");n&&(r.Authorization=`Bearer ${n}`);const s=a.create({baseURL:Ce,headers:r}),o=await s.get("/funcoes").then(e=>e.data).catch(async()=>{const e=a.create({baseURL:"http://localhost:8001/api",headers:r});return(await e.get("/funcoes")).data}),i=t.rows||[],l=o.rows||[],c={};for(const a of[...l,...i]){const e=String(a.Funcao??a.funcao??a.Descricao??a.descricao??"").toUpperCase();c[e]||(c[e]=a)}return{rows:Object.values(c),columns:t.columns||o.columns||[]}}async createFuncao(e){return(await this.api.post("/funcoes",e)).data}async updateFuncao(e,t){return(await this.api.put(`/funcoes/${e}`,t)).data}async deleteFuncao(e){return(await this.api.delete(`/funcoes/${e}`)).data}async applyFilter(e){return(await this.api.post("/filtros/aplicar",e)).data}async exportExcel(e){return(await this.api.post("/export/excel",{tabela:e},{responseType:"blob"})).data}async exportPdf(e){return(await this.api.post("/export/pdf",{tabela:e},{responseType:"blob"})).data}async exportData(e,t){try{const a="excel"===t?await this.exportExcel(e):await this.exportPdf(e),r=window.URL.createObjectURL(new Blob([a])),n=document.createElement("a");n.href=r,n.setAttribute("download",`${e}.${"excel"===t?"xlsx":"pdf"}`),document.body.appendChild(n),n.click(),n.parentNode?.removeChild(n)}catch(a){throw a}}async getAuditLogs(e=0,t=100){return(await this.api.get("/audit-logs",{params:{skip:e,limit:t}})).data}async createAuditLog(e){return(await this.api.post("/audit-logs",e)).data}async getAuditLogsByUser(e){return(await this.api.get(`/audit-logs/usuario/${e}`)).data}async importCsv(e){const t=new FormData;t.append("file",e);return(await this.api.post("/import/csv",t,{headers:{"Content-Type":"multipart/form-data"}})).data}async getNotificacoes(e){return(await this.api.get(`/notificacoes/${e}`)).data}async createNotificacao(e){return(await this.api.post("/notificacoes",e)).data}async marcarNotificacaoLida(e){return(await this.api.put(`/notificacoes/${e}/marcar-lida`)).data}async getEleitores(){try{const e=(await this.api.get("/eleitores")).data,t=Array.isArray(e)?e:e.rows||[],a="1"===(localStorage.getItem("adminContext")||""),r=(localStorage.getItem("viewTenantSlug")||"").toUpperCase(),n=(localStorage.getItem("viewTenantName")||"").toUpperCase();if(a&&r){const a=new Set([r,n]);return{rows:t.filter(e=>a.has(String(e.TenantLayer||"").toUpperCase())),columns:Array.isArray(e)?[]:e.columns||[]}}return{rows:t,columns:Array.isArray(e)?[]:e.columns||[]}}catch(e){const t=a.create({baseURL:"http://localhost:8001/api",headers:{"Content-Type":"application/json"}}),r=(await t.get("/eleitores")).data,n=Array.isArray(r)?r:r.rows||[],s="1"===(localStorage.getItem("adminContext")||""),o=(localStorage.getItem("viewTenantSlug")||"").toUpperCase(),i=(localStorage.getItem("viewTenantName")||"").toUpperCase();if(s&&o){const e=new Set([o,i]);return{rows:n.filter(t=>e.has(String(t.TenantLayer||"").toUpperCase())),columns:Array.isArray(r)?[]:r.columns||[]}}return{rows:n,columns:Array.isArray(r)?[]:r.columns||[]}}}async createEleitor(e){return(await this.api.post("/eleitores",e)).data}async updateEleitor(e,t){return(await this.api.put(`/eleitores/${e}`,t)).data}async deleteEleitor(e){return(await this.api.delete(`/eleitores/${e}`)).data}async getAtivistas(){const e=(await this.api.get("/ativistas")).data,t=Array.isArray(e)?e:e.rows||[],a="1"===(localStorage.getItem("adminContext")||""),r=(localStorage.getItem("viewTenantSlug")||"").toUpperCase(),n=(localStorage.getItem("viewTenantName")||"").toUpperCase();if(a&&r){const a=new Set([r,n]);return{rows:t.filter(e=>a.has(String(e.TenantLayer||"").toUpperCase())),columns:Array.isArray(e)?[]:e.columns||[]}}return{rows:t,columns:Array.isArray(e)?[]:e.columns||[]}}async listCandidatos(){return(await this.api.get("/candidatos")).data}async createCandidato(e){return(await this.api.post("/candidatos",e)).data}async updateCandidato(e,t){return(await this.api.put(`/candidatos/${e}`,t)).data}async deleteCandidato(e){return(await this.api.delete(`/candidatos/${e}`)).data}async listEleicoes(){return(await this.api.get("/eleicoes")).data}async createEleicao(e){return(await this.api.post("/eleicoes",e)).data}async updateEleicao(e,t){return(await this.api.put(`/eleicoes/${e}`,t)).data}async deleteEleicao(e){return(await this.api.delete(`/eleicoes/${e}`)).data}async listMetas(){return(await this.api.get("/metas")).data}async createMeta(e){return(await this.api.post("/metas",e)).data}async updateMeta(e,t){return(await this.api.put(`/metas/${e}`,t)).data}async deleteMeta(e){return(await this.api.delete(`/metas/${e}`)).data}async getUsuariosSchema(){try{return(await this.api.get("/usuarios/schema")).data}catch(e){const t=a.create({baseURL:"http://localhost:8001/api",headers:{"Content-Type":"application/json"}});return(await t.get("/usuarios/schema")).data}}async listUsuarios(){const e=async()=>{try{const e=localStorage.getItem("tenantSlug")||"captar",t=localStorage.getItem("tenantName")||"",a=(await this.listTenants()).rows||[],r=a.find(e=>String(e.Nome??e.nome).toUpperCase()===String(t).toUpperCase()),n=a.find(t=>String(t.Slug??t.slug)===e),s=r||n;return{id:s?.IdTenant??s?.id,nome:s?.Nome??s?.nome,slug:e}}catch{return{slug:localStorage.getItem("tenantSlug")||"captar",nome:localStorage.getItem("tenantName")||""}}};try{const t=(await this.api.get("/usuarios")).data,a="1"===(localStorage.getItem("adminContext")||""),r=(localStorage.getItem("viewTenantSlug")||"").toUpperCase(),n=(localStorage.getItem("viewTenantName")||"").toUpperCase(),s=await e();if("captar"!==(s.slug||"").toLowerCase()){return{rows:(t.rows||[]).filter(e=>Number(e.IdTenant??e.idTenant)===Number(s.id)),columns:t.columns||[]}}if(a&&r){const e=new Set([r,n]);return{rows:(t.rows||[]).filter(t=>e.has(String(t.TenantLayer||"").toUpperCase())),columns:t.columns||[]}}return t}catch(t){const r=a.create({baseURL:"http://localhost:8001/api",headers:{"Content-Type":"application/json"}}),n=(await r.get("/usuarios")).data,s="1"===(localStorage.getItem("adminContext")||""),o=(localStorage.getItem("viewTenantSlug")||"").toUpperCase(),i=(localStorage.getItem("viewTenantName")||"").toUpperCase(),l=await e();if("captar"!==(l.slug||"").toLowerCase()){return{rows:(n.rows||[]).filter(e=>Number(e.IdTenant??e.idTenant)===Number(l.id)),columns:n.columns||[]}}if(s&&o){const e=new Set([o,i]);return{rows:(n.rows||[]).filter(t=>e.has(String(t.TenantLayer||"").toUpperCase())),columns:n.columns||[]}}return n}}async createUsuario(e){try{return(await this.api.post("/usuarios",e)).data}catch(t){const r=a.create({baseURL:"http://localhost:8001/api",headers:{"Content-Type":"application/json"}});return(await r.post("/usuarios",e)).data}}async updateUsuario(e,t){try{return(await this.api.put(`/usuarios/${e}`,t)).data}catch(r){const n=a.create({baseURL:"http://localhost:8001/api",headers:{"Content-Type":"application/json"}});return(await n.put(`/usuarios/${e}`,t)).data}}async uploadUsuarioFoto(e,t){const a=new FormData;t.file&&a.append("file",t.file),t.data_url&&a.append("data_url",t.data_url);return(await this.api.post(`/usuarios/${e}/foto`,a,{headers:{"Content-Type":"multipart/form-data"}})).data}async deleteUsuario(e){try{return(await this.api.delete(`/usuarios/${e}`)).data}catch(t){const r=a.create({baseURL:"http://localhost:8001/api",headers:{"Content-Type":"application/json"}});return(await r.delete(`/usuarios/${e}`)).data}}async getDashboardStats(){const e="1"===(localStorage.getItem("adminContext")||""),t=(localStorage.getItem("viewTenantSlug")||"").trim(),a={};e&&t&&(a["X-View-Tenant"]=t);const r=(await this.api.get("/dashboard/stats",{headers:a})).data||{};try{if("captar"!==(localStorage.getItem("tenantSlug")||"captar").toLowerCase()){const e=await this.listUsuarios();r.total_usuarios=(e.rows||[]).length}else if(e&&t){const e=await this.listUsuarios();r.total_usuarios=(e.rows||[]).length;try{const e=await this.getEleitores();r.total_eleitores=(e.rows||e||[]).length;const t=await this.getAtivistas();r.total_ativistas=(t.rows||t||[]).length}catch{}}}catch{}return r}async getTopAtivistas(){return(await this.api.get("/dashboard/top-ativistas")).data}async getTopUsuarios(){return(await this.api.get("/dashboard/top-usuarios")).data}async getTopSupervisores(){return(await this.api.get("/dashboard/top-supervisores")).data}async getTopCoordenadores(){return(await this.api.get("/dashboard/top-coordenadores")).data}async getTopBairros(){return(await this.api.get("/dashboard/top-bairros")).data}async getTopZonas(){return(await this.api.get("/dashboard/top-zonas")).data}async listCoordenadores(){return{rows:((await this.listUsuarios()).rows||[]).filter(e=>"COORDENADOR"===String(e.Funcao||e.funcao).toUpperCase().trim()||"ADMINISTRADOR"===String(e.Funcao||e.funcao).toUpperCase().trim())}}async listSupervisores(e){return{rows:((await this.listUsuarios()).rows||[]).filter(t=>"SUPERVISOR"===String(t.Funcao||t.funcao).toUpperCase().trim()&&String(t.Coordenador||t.coordenador).trim()===String(e).trim())}}async getTenantsSchema(){try{return(await this.api.get("/tenants/schema")).data}catch(e){try{return(await this.api.get("/tenants/schema",{baseURL:"http://localhost:8001/api"})).data}catch(t){const e="undefined"!=typeof window?window.location.origin:"",a=e?`${e}/api`:"http://localhost:8001/api";return(await this.api.get("/tenants/schema",{baseURL:a})).data}}}async listTenants(){try{return(await this.api.get("/tenants")).data}catch(e){try{return(await this.api.get("/tenants",{baseURL:"http://localhost:8001/api"})).data}catch(t){const e="undefined"!=typeof window?window.location.origin:"",a=e?`${e}/api`:"http://localhost:8001/api";return(await this.api.get("/tenants",{baseURL:a})).data}}}async createTenant(e){try{return(await this.api.post("/tenants",e)).data}catch(t){try{return(await this.api.post("/tenants",e,{baseURL:"http://localhost:8001/api"})).data}catch(a){const t="undefined"!=typeof window?window.location.origin:"",r=t?`${t}/api`:"http://localhost:8001/api";return(await this.api.post("/tenants",e,{baseURL:r})).data}}}async updateTenant(e,t){try{return(await this.api.put(`/tenants/${e}`,t)).data}catch(a){try{return(await this.api.put(`/tenants/${e}`,t,{baseURL:"http://localhost:8001/api"})).data}catch(r){const a="undefined"!=typeof window?window.location.origin:"",n=a?`${a}/api`:"http://localhost:8001/api";return(await this.api.put(`/tenants/${e}`,t,{baseURL:n})).data}}}async deleteTenant(e){try{return(await this.api.delete(`/tenants/${e}`)).data}catch(t){try{return(await this.api.delete(`/tenants/${e}`,{baseURL:"http://localhost:8001/api"})).data}catch(a){const t="undefined"!=typeof window?window.location.origin:"",r=t?`${t}/api`:"http://localhost:8001/api";return(await this.api.delete(`/tenants/${e}`,{baseURL:r})).data}}}async deleteTenantAndDb(e){try{return(await this.api.delete("/tenants/delete_all",{data:{slug:e}})).data}catch(t){const r=a.create({baseURL:"http://localhost:8001/api",headers:{"Content-Type":"application/json"}});return(await r.delete("/tenants/delete_all",{data:{slug:e}})).data}}async provisionTenant(e){try{return(await this.api.post("/tenants/provision",e)).data}catch(t){const r=a.create({baseURL:"http://localhost:8001/api",headers:{"Content-Type":"application/json"}});return(await r.post("/tenants/provision",e)).data}}async recreateTenantDb(e){try{return(await this.api.post(`/tenants/${e}/recreate_db`)).data}catch(t){try{return(await this.api.post(`/tenants/${e}/recreate_db`,void 0,{baseURL:"http://localhost:8001/api"})).data}catch(a){const t="undefined"!=typeof window?window.location.origin:"",r=t?`${t}/api`:"http://localhost:8001/api";return(await this.api.post(`/tenants/${e}/recreate_db`,void 0,{baseURL:r})).data}}}async setTenantDsn(e,t){try{return(await this.api.post(`/tenants/${e}/set_dsn`,{dsn:t})).data}catch(r){const n=a.create({baseURL:"http://localhost:8001/api",headers:{"Content-Type":"application/json"}});return(await n.post(`/tenants/${e}/set_dsn`,{dsn:t})).data}}async migrateAllTenants(){try{return(await this.api.post("/admin/migrate_all_tenants")).data}catch(e){const t=a.create({baseURL:"http://localhost:8001/api",headers:{"Content-Type":"application/json"}});return(await t.post("/admin/migrate_all_tenants")).data}}async migrateTenantData(e){try{return(await this.api.post("/tenants/migrate_data",{slug:e})).data}catch(t){const r=a.create({baseURL:"http://localhost:8001/api",headers:{"Content-Type":"application/json"}});return(await r.post("/tenants/migrate_data",{slug:e})).data}}async testarIntegracao(e){return(await this.api.post("/integracoes/testar",e)).data}async salvarIntegracaoConfig(e){return(await this.api.post("/integracoes/config",e)).data}async obterIntegracaoConfig(){return(await this.api.get("/integracoes/config")).data}async listarMunicipios(e){return(await this.api.get(`/integracoes/municipios/${e}`)).data}async listarRecursosCkan(e,t){return(await this.api.post("/integracoes/ckan/resources",{dataset:e,uf:t})).data}async previewRecursoCkan(e,t=15){return(await this.api.post("/integracoes/ckan/preview",{resource_url:e,limit:t})).data}},Ae=f.createContext(Ie);function Te({children:e}){const t=f.useMemo(()=>{const e=new Map,t=(e,t)=>`${("undefined"!=typeof window?localStorage.getItem("tenantSlug"):null)||"captar"}:${("undefined"!=typeof window?localStorage.getItem("viewTenantSlug"):null)||""}:${e}:${JSON.stringify(t)}`,a=Ie,r={listTenants:a.listTenants.bind(Ie),listUsuarios:a.listUsuarios.bind(Ie),listPerfil:a.listPerfil.bind(Ie),listFuncoes:a.listFuncoes.bind(Ie),createUsuario:a.createUsuario.bind(Ie),updateUsuario:a.updateUsuario.bind(Ie),deleteUsuario:a.deleteUsuario.bind(Ie),uploadUsuarioFoto:a.uploadUsuarioFoto.bind(Ie)};return a.listTenants=async()=>{const a=t("listTenants",[]);if(e.has(a))return e.get(a);const n=await r.listTenants();return e.set(a,n),n},a.listUsuarios=async()=>{const a=t("listUsuarios",[]);if(e.has(a))return e.get(a);const n=await r.listUsuarios();return e.set(a,n),n},a.listPerfil=async()=>{const a=t("listPerfil",[]);if(e.has(a))return e.get(a);const n=await r.listPerfil();return e.set(a,n),n},a.listFuncoes=async()=>{const a=t("listFuncoes",[]);if(e.has(a))return e.get(a);const n=await r.listFuncoes();return e.set(a,n),n},a.createUsuario=async t=>{const a=await r.createUsuario(t);return e.clear(),a},a.updateUsuario=async(t,a)=>{const n=await r.updateUsuario(t,a);return e.clear(),n},a.deleteUsuario=async t=>{const a=await r.deleteUsuario(t);return e.clear(),a},a.uploadUsuarioFoto=async(t,a)=>{const n=await r.uploadUsuarioFoto(t,a);return e.clear(),n},Ie},[]);return r.jsx(Ae.Provider,{value:t,children:e})}function Ne(){return f.useContext(Ae)}var Ee,Ue={},ke={exports:{}};function De(){return Ee||(Ee=1,(e=ke).exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports),ke.exports;var e}var Pe,Oe={};var Re,Fe={},Me={},Le={},_e={exports:{}},$e={exports:{}},Ve={exports:{}},ze={exports:{}};function qe(){return Re||(Re=1,function(e){function t(a){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(a)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}(ze)),ze.exports}var Be,We,He,Ye,Je={exports:{}};function Ge(){return We||(We=1,e=Ve,t=qe().default,a=function(){return Be||(Be=1,e=Je,t=qe().default,e.exports=function(e,a){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,a||"default");if("object"!=t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports),Je.exports;var e,t}(),e.exports=function(e){var r=a(e,"string");return"symbol"==t(r)?r:r+""},e.exports.__esModule=!0,e.exports.default=e.exports),Ve.exports;var e,t,a}function Ke(){return Ye||(Ye=1,function(e){var t=function(){return He||(He=1,e=$e,t=Ge(),e.exports=function(e,a,r){return(a=t(a))in e?Object.defineProperty(e,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[a]=r,e},e.exports.__esModule=!0,e.exports.default=e.exports),$e.exports;var e,t}();function a(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,r)}return a}e.exports=function(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?a(Object(n),!0).forEach(function(a){t(e,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e},e.exports.__esModule=!0,e.exports.default=e.exports}(_e)),_e.exports}var Xe,Ze,Qe={};function et(){if(Ze)return Le;Ze=1;var e=De().default;Object.defineProperty(Le,"__esModule",{value:!0}),Le.default=void 0;var t=e(Ke()),a=(Xe||(Xe=1,Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.commonLocale=void 0,Qe.commonLocale={yearFormat:"YYYY",dayFormat:"D",cellMeridiemFormat:"A",monthBeforeYear:!0}),Qe),r=(0,t.default)((0,t.default)({},a.commonLocale),{},{locale:"pt_BR",today:"Hoje",now:"Agora",backToToday:"Voltar para hoje",ok:"OK",clear:"Limpar",week:"Semana",month:"MÃªs",year:"Ano",timeSelect:"Selecionar hora",dateSelect:"Selecionar data",monthSelect:"Escolher mÃªs",yearSelect:"Escolher ano",decadeSelect:"Escolher dÃ©cada",dateFormat:"D/M/YYYY",dateTimeFormat:"D/M/YYYY HH:mm:ss",monthBeforeYear:!1,previousMonth:"MÃªs anterior (PageUp)",nextMonth:"PrÃ³ximo mÃªs (PageDown)",previousYear:"Ano anterior (Control + esquerda)",nextYear:"PrÃ³ximo ano (Control + direita)",previousDecade:"DÃ©cada anterior",nextDecade:"PrÃ³xima dÃ©cada",previousCentury:"SÃ©culo anterior",nextCentury:"PrÃ³ximo sÃ©culo",shortWeekDays:["Dom","Seg","Ter","Qua","Qui","Sex","SÃ¡b"],shortMonths:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"]});return Le.default=r,Le}var tt,at,rt,nt,st,ot,it={};function lt(){if(tt)return it;tt=1,Object.defineProperty(it,"__esModule",{value:!0}),it.default=void 0;return it.default={placeholder:"Hora",rangePlaceholder:["Hora de inÃ­cio","Hora de tÃ©rmino"]},it}function ct(){if(at)return Me;at=1;var e=De().default;Object.defineProperty(Me,"__esModule",{value:!0}),Me.default=void 0;var t=e(et()),a=e(lt());const r={lang:Object.assign({placeholder:"Selecionar data",rangePlaceholder:["Data inicial","Data final"]},t.default),timePickerLocale:Object.assign({},a.default)};return Me.default=r,Me}function dt(){if(rt)return Fe;rt=1;var e=De().default;Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.default=void 0;var t=e(ct());return Fe.default=t.default,Fe}function ut(){if(nt)return Ue;nt=1;var e=De().default;Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.default=void 0;var t=e((Pe||(Pe=1,Object.defineProperty(Oe,"__esModule",{value:!0}),Oe.default=void 0,Oe.default={items_per_page:"/ pÃ¡gina",jump_to:"VÃ¡ atÃ©",jump_to_confirm:"confirme",page:"PÃ¡gina",prev_page:"PÃ¡gina anterior",next_page:"PrÃ³xima pÃ¡gina",prev_5:"5 pÃ¡ginas anteriores",next_5:"5 prÃ³ximas pÃ¡ginas",prev_3:"3 pÃ¡ginas anteriores",next_3:"3 prÃ³ximas pÃ¡ginas",page_size:"tamanho da pÃ¡gina"}),Oe)),a=e(dt()),r=e(ct()),n=e(lt());const s="${label} nÃ£o Ã© um ${type} vÃ¡lido",o={locale:"pt-br",Pagination:t.default,DatePicker:r.default,TimePicker:n.default,Calendar:a.default,global:{placeholder:"Por favor escolha",close:"Fechar"},Table:{filterTitle:"Menu de Filtro",filterConfirm:"OK",filterReset:"Resetar",filterEmptyText:"Sem filtros",filterCheckAll:"Selecionar todos os itens",filterSearchPlaceholder:"Pesquisar nos filtros",emptyText:"Sem conteÃºdo",selectAll:"Selecionar pÃ¡gina atual",selectInvert:"Inverter seleÃ§Ã£o",selectNone:"Apagar todo o conteÃºdo",selectionAll:"Selecionar todo o conteÃºdo",sortTitle:"Ordenar tÃ­tulo",expand:"Expandir linha",collapse:"Colapsar linha",triggerDesc:"Clique organiza por descendente",triggerAsc:"Clique organiza por ascendente",cancelSort:"Clique para cancelar organizaÃ§Ã£o"},Tour:{Next:"PrÃ³ximo",Previous:"Anterior",Finish:"Finalizar"},Modal:{okText:"OK",cancelText:"Cancelar",justOkText:"OK"},Popconfirm:{okText:"OK",cancelText:"Cancelar"},Transfer:{titles:["",""],searchPlaceholder:"Procurar",itemUnit:"item",itemsUnit:"items",remove:"Remover",selectCurrent:"Selecionar pÃ¡gina atual",removeCurrent:"Remover pÃ¡gina atual",selectAll:"Selecionar todos",removeAll:"Remover todos",selectInvert:"Inverter seleÃ§Ã£o atual"},Upload:{uploading:"Enviando...",removeFile:"Remover arquivo",uploadError:"Erro no envio",previewFile:"Visualizar arquivo",downloadFile:"Baixar arquivo"},Empty:{description:"NÃ£o hÃ¡ dados"},Icon:{icon:"Ã­cone"},Text:{edit:"editar",copy:"copiar",copied:"copiado",expand:"expandir"},Form:{optional:"(opcional)",defaultValidateMessages:{default:"Erro ${label} na validaÃ§Ã£o de campo",required:"Por favor, insira ${label}",enum:"${label} deve ser um dos seguinte: [${enum}]",whitespace:"${label} nÃ£o pode ser um carÃ¡cter vazio",date:{format:" O formato de data ${label} Ã© invÃ¡lido",parse:"${label} nÃ£o pode ser convertido para uma data",invalid:"${label} Ã© uma data invÃ¡lida"},types:{string:s,method:s,array:s,object:s,number:s,date:s,boolean:s,integer:s,float:s,regexp:s,email:s,url:s,hex:s},string:{len:"${label} deve possuir ${len} caracteres",min:"${label} deve possuir ao menos ${min} caracteres",max:"${label} deve possuir no mÃ¡ximo ${max} caracteres",range:"${label} deve possuir entre ${min} e ${max} caracteres"},number:{len:"${label} deve ser igual Ã  ${len}",min:"O valor mÃ­nimo de ${label} Ã© ${min}",max:"O valor mÃ¡ximo de ${label} Ã© ${max}",range:"${label} deve estar entre ${min} e ${max}"},array:{len:"Deve ser ${len} ${label}",min:"No mÃ­nimo ${min} ${label}",max:"No mÃ¡ximo ${max} ${label}",range:"A quantidade de ${label} deve estar entre ${min} e ${max}"},pattern:{mismatch:"${label} nÃ£o se encaixa no padrÃ£o ${pattern}"}}},Image:{preview:"PrÃ©-visualizaÃ§Ã£o"}};return Ue.default=o,Ue}function mt(){return ot?st:(ot=1,st=ut())}const pt=g(mt()),ht={},gt=function(e,t,a){let r=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),n=a?.nonce||a?.getAttribute("nonce");r=e(t.map(e=>{if((e=function(e){return"/"+e}(e))in ht)return;ht[e]=!0;const t=e.endsWith(".css"),a=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const r=document.createElement("link");return r.rel=t?"stylesheet":"modulepreload",t||(r.as="script"),r.crossOrigin="",r.href=e,n&&r.setAttribute("nonce",n),document.head.appendChild(r),t?new Promise((t,a)=>{r.addEventListener("load",t),r.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function n(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then(t=>{for(const e of t||[])"rejected"===e.status&&n(e.reason);return e().catch(n)})},ft=localStorage.getItem("user");let xt=null;if(ft)try{const e=JSON.parse(ft);if(e&&e.login_time){const t=n(e.login_time);if(s(t))xt=e;else{const t=new Date(e.login_time);s(t)?e.login_time=t.toISOString():e.login_time=(new Date).toISOString(),localStorage.setItem("user",JSON.stringify(e)),xt=e}}else xt=e}catch{xt=null,localStorage.removeItem("user")}const yt=o(e=>({user:xt,token:localStorage.getItem("token"),isLoading:!1,isAuthenticated:!!localStorage.getItem("token"),setUser:t=>{t?localStorage.setItem("user",JSON.stringify(t)):localStorage.removeItem("user"),e({user:t})},setToken:t=>{t?localStorage.setItem("token",t):localStorage.removeItem("token"),e({token:t,isAuthenticated:!!t})},setIsLoading:t=>e({isLoading:t}),logout:()=>{localStorage.removeItem("user"),localStorage.removeItem("token"),e({user:null,token:null,isAuthenticated:!1})},login:(t,a)=>{localStorage.setItem("user",JSON.stringify(t)),localStorage.setItem("token",a),e({user:t,token:a,isAuthenticated:!0})}})),jt="/assets/CAPTAR%20LOGO%20OFICIAL-DwGQlJkk.jpg",St={lessThanXSeconds:{one:"menos de um segundo",other:"menos de {{count}} segundos"},xSeconds:{one:"1 segundo",other:"{{count}} segundos"},halfAMinute:"meio minuto",lessThanXMinutes:{one:"menos de um minuto",other:"menos de {{count}} minutos"},xMinutes:{one:"1 minuto",other:"{{count}} minutos"},aboutXHours:{one:"cerca de 1 hora",other:"cerca de {{count}} horas"},xHours:{one:"1 hora",other:"{{count}} horas"},xDays:{one:"1 dia",other:"{{count}} dias"},aboutXWeeks:{one:"cerca de 1 semana",other:"cerca de {{count}} semanas"},xWeeks:{one:"1 semana",other:"{{count}} semanas"},aboutXMonths:{one:"cerca de 1 mÃªs",other:"cerca de {{count}} meses"},xMonths:{one:"1 mÃªs",other:"{{count}} meses"},aboutXYears:{one:"cerca de 1 ano",other:"cerca de {{count}} anos"},xYears:{one:"1 ano",other:"{{count}} anos"},overXYears:{one:"mais de 1 ano",other:"mais de {{count}} anos"},almostXYears:{one:"quase 1 ano",other:"quase {{count}} anos"}},wt={date:i({formats:{full:"EEEE, d 'de' MMMM 'de' y",long:"d 'de' MMMM 'de' y",medium:"d MMM y",short:"dd/MM/yyyy"},defaultWidth:"full"}),time:i({formats:{full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},defaultWidth:"full"}),dateTime:i({formats:{full:"{{date}} 'Ã s' {{time}}",long:"{{date}} 'Ã s' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},vt={lastWeek:e=>{const t=e.getDay();return"'"+(0===t||6===t?"Ãºltimo":"Ãºltima")+"' eeee 'Ã s' p"},yesterday:"'ontem Ã s' p",today:"'hoje Ã s' p",tomorrow:"'amanhÃ£ Ã s' p",nextWeek:"eeee 'Ã s' p",other:"P"},bt={code:"pt-BR",formatDistance:(e,t,a)=>{let r;const n=St[e];return r="string"==typeof n?n:1===t?n.one:n.other.replace("{{count}}",String(t)),a?.addSuffix?a.comparison&&a.comparison>0?"em "+r:"hÃ¡ "+r:r},formatLong:wt,formatRelative:(e,t,a,r)=>{const n=vt[e];return"function"==typeof n?n(t):n},localize:{ordinalNumber:(e,t)=>{const a=Number(e);return"week"===t?.unit?a+"Âª":a+"Âº"},era:l({values:{narrow:["AC","DC"],abbreviated:["AC","DC"],wide:["antes de cristo","depois de cristo"]},defaultWidth:"wide"}),quarter:l({values:{narrow:["1","2","3","4"],abbreviated:["T1","T2","T3","T4"],wide:["1Âº trimestre","2Âº trimestre","3Âº trimestre","4Âº trimestre"]},defaultWidth:"wide",argumentCallback:e=>e-1}),month:l({values:{narrow:["j","f","m","a","m","j","j","a","s","o","n","d"],abbreviated:["jan","fev","mar","abr","mai","jun","jul","ago","set","out","nov","dez"],wide:["janeiro","fevereiro","marÃ§o","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"]},defaultWidth:"wide"}),day:l({values:{narrow:["D","S","T","Q","Q","S","S"],short:["dom","seg","ter","qua","qui","sex","sab"],abbreviated:["domingo","segunda","terÃ§a","quarta","quinta","sexta","sÃ¡bado"],wide:["domingo","segunda-feira","terÃ§a-feira","quarta-feira","quinta-feira","sexta-feira","sÃ¡bado"]},defaultWidth:"wide"}),dayPeriod:l({values:{narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"manhÃ£",afternoon:"tarde",evening:"tarde",night:"noite"},abbreviated:{am:"AM",pm:"PM",midnight:"meia-noite",noon:"meio-dia",morning:"manhÃ£",afternoon:"tarde",evening:"tarde",night:"noite"},wide:{am:"a.m.",pm:"p.m.",midnight:"meia-noite",noon:"meio-dia",morning:"manhÃ£",afternoon:"tarde",evening:"tarde",night:"noite"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"da manhÃ£",afternoon:"da tarde",evening:"da tarde",night:"da noite"},abbreviated:{am:"AM",pm:"PM",midnight:"meia-noite",noon:"meio-dia",morning:"da manhÃ£",afternoon:"da tarde",evening:"da tarde",night:"da noite"},wide:{am:"a.m.",pm:"p.m.",midnight:"meia-noite",noon:"meio-dia",morning:"da manhÃ£",afternoon:"da tarde",evening:"da tarde",night:"da noite"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:d({matchPattern:/^(\d+)[ÂºÂªo]?/i,parsePattern:/\d+/i,valueCallback:e=>parseInt(e,10)}),era:c({matchPatterns:{narrow:/^(ac|dc|a|d)/i,abbreviated:/^(a\.?\s?c\.?|d\.?\s?c\.?)/i,wide:/^(antes de cristo|depois de cristo)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^ac/i,/^dc/i],wide:[/^antes de cristo/i,/^depois de cristo/i]},defaultParseWidth:"any"}),quarter:c({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^T[1234]/i,wide:/^[1234](Âº)? trimestre/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:e=>e+1}),month:c({matchPatterns:{narrow:/^[jfmajsond]/i,abbreviated:/^(jan|fev|mar|abr|mai|jun|jul|ago|set|out|nov|dez)/i,wide:/^(janeiro|fevereiro|marÃ§o|abril|maio|junho|julho|agosto|setembro|outubro|novembro|dezembro)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^fev/i,/^mar/i,/^abr/i,/^mai/i,/^jun/i,/^jul/i,/^ago/i,/^set/i,/^out/i,/^nov/i,/^dez/i]},defaultParseWidth:"any"}),day:c({matchPatterns:{narrow:/^(dom|[23456]Âª?|s[aÃ¡]b)/i,short:/^(dom|[23456]Âª?|s[aÃ¡]b)/i,abbreviated:/^(dom|seg|ter|qua|qui|sex|s[aÃ¡]b)/i,wide:/^(domingo|(segunda|ter[cÃ§]a|quarta|quinta|sexta)([- ]feira)?|s[aÃ¡]bado)/i},defaultMatchWidth:"wide",parsePatterns:{short:[/^d/i,/^2/i,/^3/i,/^4/i,/^5/i,/^6/i,/^s[aÃ¡]/i],narrow:[/^d/i,/^2/i,/^3/i,/^4/i,/^5/i,/^6/i,/^s[aÃ¡]/i],any:[/^d/i,/^seg/i,/^t/i,/^qua/i,/^qui/i,/^sex/i,/^s[aÃ¡]b/i]},defaultParseWidth:"any"}),dayPeriod:c({matchPatterns:{narrow:/^(a|p|mn|md|(da) (manhÃ£|tarde|noite))/i,any:/^([ap]\.?\s?m\.?|meia[-\s]noite|meio[-\s]dia|(da) (manhÃ£|tarde|noite))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mn|^meia[-\s]noite/i,noon:/^md|^meio[-\s]dia/i,morning:/manhÃ£/i,afternoon:/tarde/i,evening:/tarde/i,night:/noite/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}},{Header:Ct}=C;const It=x.memo(function(){const e=y(),t=j(),{user:a,logout:o}=yt(),i=Ne(),l=("undefined"!=typeof window?localStorage.getItem("tenantSlug"):null)||"captar",[c,d]=f.useState(localStorage.getItem("tenantName")||"");if(f.useEffect(()=>{const e=localStorage.getItem("tenantSlug")||"captar";(async()=>{try{const t=await i.listTenants(),a=(t.rows||[]).find(t=>String(t.Slug??t.slug).toUpperCase()===String(e).toUpperCase()),r=a?String(a.Nome??a.nome):e;d(r);try{localStorage.setItem("tenantName",r)}catch{}}catch{d(e)}})()},[i]),!a)return null;const p=f.useMemo(()=>{const e=a?.login_time;if(!e)return null;const t=n(e);if(s(t))return t;const r=new Date(e);return isNaN(r.getTime())?null:r},[a?.login_time]),h=p?u(p,"dd/MM/yyyy HH:mm",{locale:bt}):"",[g,x]=f.useState("");f.useEffect(()=>{const e=()=>{if(!p)return void x("");const e=Date.now()-p.getTime(),t=Math.floor(e/36e5),a=Math.floor(e%36e5/6e4),r=Math.floor(e%6e4/1e3),n=String(t).padStart(2,"0"),s=String(a).padStart(2,"0"),o=String(r).padStart(2,"0");x(`${n}:${s}:${o}`)};e();const t=setInterval(e,1e3);return()=>clearInterval(t)},[p]);const S=[{key:"logout",label:"LOGOUT",icon:r.jsx(F,{}),onClick:()=>{o(),e("/login")}}],w=[{key:"/",icon:r.jsx(I,{}),label:"DASHBOARD",onClick:()=>e("/")},{key:"cadastros",icon:r.jsx(A,{}),label:"CADASTROS",children:[{key:"/eleitores",icon:r.jsx(A,{}),label:"ELEITORES",onClick:()=>e("/eleitores")},{key:"/ativistas",icon:r.jsx(T,{}),label:"ATIVISTAS",onClick:()=>e("/ativistas")}]},{key:"/estatisticas",icon:r.jsx(N,{}),label:"ESTATÃSTICAS",onClick:()=>e("/estatisticas")},{key:"/consultas",icon:r.jsx(N,{}),label:"CONSULTAS",onClick:()=>e("/consultas")},{key:"sistema",icon:r.jsx(U,{}),label:"SISTEMA",children:[{key:"/usuarios",icon:r.jsx(N,{}),label:"USUÃRIOS",onClick:()=>e("/usuarios")},{key:"/perfil",icon:r.jsx(A,{}),label:"PERFIL",onClick:()=>e("/perfil")},{key:"/funcoes",icon:r.jsx(A,{}),label:"FUNÃ‡Ã•ES",onClick:()=>e("/funcoes")},{key:"/permissoes",icon:r.jsx(N,{}),label:"PERMISSÃ•ES",onClick:()=>e("/permissoes")},{key:"/integracoes",icon:r.jsx(E,{}),label:"INTEGRAÃ‡Ã•ES",onClick:()=>e("/integracoes")}]},{key:"parametros",icon:r.jsx(N,{}),label:"PARÃ‚METROS",children:(()=>{const t=[{key:"/parametros/metas",icon:r.jsx(N,{}),label:"METAS",onClick:()=>e("/parametros/metas")},{key:"/parametros/tenants",icon:r.jsx(N,{}),label:"TENANTS",onClick:()=>e("/parametros/tenants")},{key:"/parametros/eleicoes",icon:r.jsx(N,{}),label:"ELEIÃ‡Ã•ES",onClick:()=>e("/parametros/eleicoes")},{key:"/parametros/candidatos",icon:r.jsx(N,{}),label:"CANDIDATOS",onClick:()=>e("/parametros/candidatos")}];return"captar"!==String(l).toLowerCase()?t.filter(e=>"/parametros/tenants"!==e.key):t})()}];return r.jsx(Ct,{className:"navbar",children:r.jsxs("div",{className:"navbar-container",children:[r.jsxs("div",{className:"navbar-logo",style:{height:"100%",display:"flex",alignItems:"center"},children:[r.jsx("img",{src:jt,alt:"CAPTAR",style:{height:110,backgroundColor:"#ffffff",borderRadius:8,padding:6}}),r.jsxs("span",{style:{marginLeft:12,fontSize:12,color:"#666",letterSpacing:".3px"},children:["TENANT: ",r.jsx("strong",{style:{color:"#333"},children:String(c||l).toUpperCase()})]})]}),r.jsx(m.div,{initial:{opacity:0,y:-8},animate:{opacity:1,y:0},transition:{duration:.4},children:r.jsx(k,{mode:"horizontal",selectedKeys:[t.pathname],items:w,className:"navbar-menu"})}),r.jsxs("div",{className:"navbar-content",children:[r.jsx("div",{className:"navbar-user-info",children:r.jsxs("div",{className:"user-details",children:[r.jsx("p",{className:"user-name",children:a.nome}),r.jsxs("p",{className:"user-meta",children:["FunÃ§Ã£o: ",r.jsx("strong",{children:a.funcao})," | Perfil: ",r.jsx("strong",{children:a.perfil})]}),r.jsxs("p",{className:"user-login-time",children:["LOGIN: ",h," | TEMPO CONECTADO: ",g]})]})}),r.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:r.jsx(D,{menu:{items:S},trigger:["click"],children:r.jsxs(P,{type:"text",className:"user-menu-button",children:[r.jsx(O,{icon:r.jsx(A,{}),size:"large"}),r.jsx(R,{})]})})})]})]})})}),At="/assets/CAPTAR%20LOGIN-My8ZjooI.png";function Tt(){const{message:e}=M.useApp(),t=y(),{login:a}=yt(),[n,s]=f.useState(!1),[o,i]=f.useState(null),[l]=L.useForm(),c=Ne(),[d,u]=f.useState(null),m=async r=>{s(!0);try{if(r.acesso_direto){try{localStorage.setItem("tenantSlug","captar")}catch{}const r={id:9999,nome:"USUÃRIO TEMPORÃRIO",funcao:"ADMINISTRADOR",usuario:"admin",email:"admin@example.com",cpf:"000.000.000-00",perfil:"ADMINISTRADOR",login_time:(new Date).toISOString()};return a(r,"temp-token-dev"),e.success("Acesso direto ativado!"),void t("/")}const n=await c.login({usuario:r.usuario,senha:r.senha}),s={...n.user,login_time:(new Date).toISOString()};a(s,n.token),e.success("Login realizado com sucesso!"),t("/")}catch(n){e.error(n.response?.data?.detail||"UsuÃ¡rio ou senha invÃ¡lidos")}finally{s(!1)}};return f.useEffect(()=>{const e=At,t=new Image;t.crossOrigin="anonymous",t.onload=()=>{const a=t.naturalWidth||512,r=t.naturalHeight||512,n=document.createElement("canvas");n.width=a,n.height=r;const s=n.getContext("2d");if(!s)return void u(e);s.drawImage(t,0,0,a,r);const o=s.getImageData(0,0,a,r),i=o.data;for(let e=0;e<i.length;e+=4){const t=i[e],a=i[e+1],r=i[e+2],n=Math.max(t,a,r),s=Math.min(t,a,r);n>230&&s>210&&(i[e+3]=0)}s.putImageData(o,0,0),u(n.toDataURL("image/png"))},t.src=e},[]),r.jsx("div",{style:{minHeight:"100vh"},children:r.jsx(_,{open:!0,centered:!0,footer:null,closable:!1,maskClosable:!1,width:520,destroyOnHidden:!0,className:"login-modal",children:r.jsxs("div",{style:{width:"100%",display:"flex",flexDirection:"column",gap:16},children:[r.jsx("style",{children:".login-modal .ant-modal-content{ border-radius:0 !important; box-shadow:none !important; border:none !important; } .login-modal .ant-modal-header{ border-bottom:none !important; }"}),r.jsx("div",{style:{display:"flex",justifyContent:"center"},children:r.jsx("img",{src:d||At,alt:"CAPTAR",style:{width:400,height:"auto",maxWidth:"90%"}})}),r.jsxs(L,{form:l,onFinish:m,layout:"vertical",className:"login-form",style:{width:"100%"},children:[r.jsx(L.Item,{name:"usuario",getValueFromEvent:e=>(e?.target?.value||"").toUpperCase(),rules:[{required:!0,message:"Por favor, insira seu usuÃ¡rio"},{min:3,message:"UsuÃ¡rio deve ter pelo menos 3 caracteres"}],children:r.jsx($,{prefix:r.jsx(A,{}),placeholder:"UsuÃ¡rio",size:"large",autoComplete:"username",style:{textTransform:"uppercase"}})}),r.jsx(L.Item,{name:"senha",rules:[{required:!0,message:"Por favor, insira sua senha"},{min:3,message:"Senha deve ter pelo menos 3 caracteres"}],children:r.jsx($.Password,{prefix:r.jsx(V,{}),placeholder:"Senha",size:"large",autoComplete:"current-password"})}),r.jsx(L.Item,{children:r.jsx(P,{type:"primary",htmlType:"submit",size:"large",block:!0,loading:n,className:"login-button",children:"ENTRAR"})})]}),r.jsxs(z,{style:{width:"100%",justifyContent:"space-between",marginTop:8},children:[r.jsxs("div",{children:[r.jsx("span",{children:"Status BD: "}),null===o&&r.jsx(q,{children:"?"}),!0===o&&r.jsx(q,{color:"green",children:"OK"}),!1===o&&r.jsx(q,{color:"red",children:"FALHA"})]}),r.jsx(P,{size:"small",onClick:async()=>{try{const t=await c.healthDb();i(!!t?.ok),t?.ok&&e.success("ConexÃ£o com banco OK")}catch(t){i(!1),e.error(t?.response?.data?.detail||"Falha ao conectar no banco")}},children:"Testar conexÃ£o"})]}),r.jsx(B,{children:"OU"}),r.jsx(P,{type:"dashed",size:"large",block:!0,loading:n,className:"dev-button",onClick:()=>{m({usuario:"",senha:"",acesso_direto:!0})},children:"ðŸ”§ Acesso Direto (Desenvolvedor)"}),r.jsxs("div",{className:"login-footer",children:[r.jsx("p",{children:"CAPTAR Â© 2025 - Sistema de CaptaÃ§Ã£o Eleitoral"}),r.jsx("p",{className:"version",children:"v2.0 - React + TypeScript + Vite"})]})]})})})}function Nt(){const{message:e}=M.useApp(),[t,a]=f.useState([]),[n,s]=f.useState(!1),[o,i]=f.useState(!1),[l]=L.useForm(),[c,d]=f.useState(null),u=Ne(),p=e=>{const t=(e||"").replace(/\D/g,"").slice(0,11);return t.length<=2?`(${t}`:t.length<=7?`(${t.slice(0,2)}) ${t.slice(2)}`:`(${t.slice(0,2)}) ${t.slice(2,7)}-${t.slice(7)}`};f.useEffect(()=>{h()},[]);const h=async()=>{try{s(!0);const e=await u.getEleitores();a(e.rows||[])}catch(t){e.error("Erro ao carregar eleitores")}finally{s(!1)}},g=[{title:"ID",dataIndex:"id",key:"id"},{title:"Nome",dataIndex:"nome",key:"nome"},{title:"CPF",dataIndex:"cpf",key:"cpf"},{title:"Celular",dataIndex:"celular",key:"celular",render:e=>p(String(e||""))},{title:"Bairro",dataIndex:"bairro",key:"bairro"},{title:"AÃ§Ãµes",key:"actions",render:(t,a)=>r.jsxs(z,{children:[r.jsx(P,{type:"primary",size:"small",icon:r.jsx(Y,{}),onClick:()=>(e=>{d(e.id),l.setFieldsValue(e),i(!0)})(a)}),r.jsx(J,{title:"Confirmar exclusÃ£o",description:"Tem certeza que deseja deletar este eleitor?",onConfirm:()=>(async t=>{try{await u.deleteEleitor(t),e.success("Eleitor deletado com sucesso"),h()}catch(a){e.error("Erro ao deletar eleitor")}})(a.id),okText:"Sim",cancelText:"NÃ£o",children:r.jsx(P,{type:"primary",danger:!0,size:"small",icon:r.jsx(G,{})})})]})}];return r.jsxs(m.div,{className:"page-container",initial:{opacity:0,y:6},animate:{opacity:1,y:0},transition:{duration:.3},children:[r.jsx("div",{className:"page-actions",children:r.jsx(P,{type:"primary",icon:r.jsx(W,{}),onClick:()=>{d(null),l.resetFields(),i(!0)},children:"NOVO ELEITOR"})}),r.jsx(H,{columns:g,dataSource:t,loading:n,rowKey:"id",pagination:{pageSize:10}}),r.jsx(_,{title:c?"EDITAR ELEITOR":"NOVO ELEITOR",open:o,onOk:()=>l.submit(),onCancel:()=>i(!1),children:r.jsxs(L,{form:l,layout:"vertical",onFinish:async t=>{try{c?(await u.updateEleitor(c,t),e.success("Eleitor atualizado com sucesso")):(await u.createEleitor(t),e.success("Eleitor criado com sucesso")),i(!1),h()}catch(a){e.error("Erro ao salvar eleitor")}},children:[r.jsx(L.Item,{name:"nome",label:"Nome",rules:[{required:!0}],children:r.jsx($,{})}),r.jsx(L.Item,{name:"cpf",label:"CPF",rules:[{required:!0}],children:r.jsx($,{})}),r.jsx(L.Item,{name:"celular",label:"Celular",children:r.jsx($,{maxLength:15,onChange:e=>{const t=p(e.target.value);l.setFieldsValue({celular:t})}})}),r.jsx(L.Item,{name:"bairro",label:"Bairro",children:r.jsx($,{})})]})})]})}function Et(){return r.jsx(m.div,{className:"page-container",initial:{opacity:0,y:6},animate:{opacity:1,y:0},transition:{duration:.3},children:r.jsx("p",{children:"PÃ¡gina de gerenciamento de ativistas"})})}function Ut({open:e,initial:t,onCancel:a,onSaved:o}){const[i]=L.useForm(),[l,c]=f.useState([]),[d,m]=f.useState([]),[p,h]=f.useState([]),[g,x]=f.useState([]),[y,j]=f.useState([]),[S,w]=f.useState([]),[v,b]=f.useState({}),[C,I]=f.useState({}),[T,N]=f.useState([]),E=Ne(),U=f.useRef(null),[k,D]=f.useState(null),[R,F]=f.useState(void 0),{user:M}=yt(),q=f.useMemo(()=>{const e=M?.login_time;if(!e)return null;const t=n(e);if(s(t))return t;const a=new Date(e);return isNaN(a.getTime())?null:a},[M]),[B,W]=f.useState(""),H=q?u(q,"dd/MM/yyyy HH:mm",{locale:bt}):"",Y=String(localStorage.getItem("tenantSlug")||"captar"),J=String(localStorage.getItem("tenantName")||"CAPTAR");f.useEffect(()=>{const e=()=>{if(!q)return void W("");const e=Date.now()-q.getTime(),t=Math.floor(e/36e5),a=Math.floor(e%36e5/6e4),r=Math.floor(e%6e4/1e3),n=String(t).padStart(2,"0"),s=String(a).padStart(2,"0"),o=String(r).padStart(2,"0");W(`${n}:${s}:${o}`)};e();const t=setInterval(e,1e3);return()=>clearInterval(t)},[q]);const G=e=>{const t=e?.target?.value;return"string"==typeof t?t.toUpperCase():t},ue=e=>{const t=e?.target?.value;return"string"==typeof t?t.toLowerCase():t};f.useEffect(()=>{if(e){(async()=>{try{const e=(await E.getUsuariosSchema()).columns||[],t=new Set(e.map(e=>e.name)),a=["Coordenador","Supervisor","Ativista"].filter(e=>!t.has(e)).map(e=>({name:e,type:"varchar",nullable:!0}));c([...e,...a]),m(e.map(e=>e.name))}catch{}})(),(async()=>{try{const e=((await E.listPerfil()).rows||[]).map(e=>({label:e.Perfil??e.perfil,value:String(e.Perfil??e.perfil)}));h(e)}catch{}})(),(async()=>{try{const e=((await E.listFuncoes()).rows||[]).map(e=>({label:e.Funcao??e.Descricao??"",value:String(e.Funcao??e.Descricao??"")}));x(e)}catch{}})(),(async()=>{try{const e=(await E.listCoordenadores()).rows||[];j(e.map(e=>({label:e.Nome??e.nome,value:String(e.Nome??e.nome)})));const t={};for(const a of e){const e=a.Nome??a.nome,r=String(a.TenantLayer??a.NomeTenant??a.nomeTenant??"CAPTAR");void 0!==e&&(t[String(e)]=r)}b(t)}catch{}})(),(async()=>{try{const e=((await E.listTenants()).rows||[]).map(e=>({label:e.Nome??e.nome,value:String(e.Nome??e.nome),slug:e.Slug??e.slug}));N(e);const a=localStorage.getItem("tenantSlug")||"captar",r=e.find(e=>(e.slug||"").toLowerCase()===a.toLowerCase());r&&!t&&i.setFieldValue("TenantLayer",r.value)}catch{}})(),t?i.setFieldsValue(t):i.resetFields();try{const e=i.getFieldValue("ImagemUploadDataUrl");F(e||t?.Imagem)}catch{}}},[e,t]);const me=L.useWatch("Funcao",i),pe=L.useWatch("Coordenador",i),he=L.useWatch("TenantLayer",i);f.useEffect(()=>{const e=String(me||"").toUpperCase().trim();"ADMINISTRADOR"===e||"COORDENADOR"===e?(i.setFieldValue("Coordenador",i.getFieldValue("Nome")),i.setFieldValue("Supervisor","NAO SE APLICA"),i.setFieldValue("Ativista","NAO SE APLICA")):"SUPERVISOR"===e&&(i.setFieldValue("Supervisor",i.getFieldValue("Nome")),i.setFieldValue("Ativista","NAO SE APLICA"))},[me]),f.useEffect(()=>{const e=String(me||"").toUpperCase().trim();"SUPERVISOR"!==e&&"ATIVISTA"!==e||!pe?w([]):(async()=>{try{const e=(await E.listSupervisores(String(pe))).rows||[];w(e.map(e=>({label:e.Nome??e.nome,value:String(e.Nome??e.nome)})));const t={};for(const a of e){const e=a.Nome??a.nome,r=String(a.TenantLayer??a.NomeTenant??a.nomeTenant??"CAPTAR");void 0!==e&&(t[String(e)]=r)}I(t)}catch{}})()},[pe,me]);const ge=e=>{const a=new Set(["DataCadastro","Cadastrante","DataUpdate","TipoUpdate","CadastranteUpdate","UltimoAcesso","TokenRecuperacao","TokenExpiracao","Candidato","UsuarioUpdate","IdTenant"]);if("IdUsuario"===e.name)return null;if("IdPerfil"===e.name)return null;if("IdTenant"===e.name)return null;if(a.has(e.name))return null;const n=!e.nullable,s=e.type.toLowerCase();if("Perfil"===e.name)return r.jsx(L.Item,{name:e.name,label:e.name,rules:[{required:n}],children:r.jsx(te,{options:p,optionFilterProp:"label",showSearch:!0,style:{borderRadius:8},suffixIcon:r.jsx(ae,{})})},e.name);if("TenantLayer"===e.name){const a=!!!t?.IdUsuario;return r.jsx(L.Item,{name:e.name,label:e.name,rules:[{required:!0}],children:r.jsx(te,{options:T,optionFilterProp:"label",showSearch:!0,style:{borderRadius:8},disabled:a})},e.name)}if("Funcao"===e.name)return r.jsx(L.Item,{name:e.name,label:e.name,rules:[{required:n}],children:r.jsx(te,{options:g,optionFilterProp:"label",showSearch:!0,style:{borderRadius:8},suffixIcon:r.jsx(re,{})})},e.name);if("Coordenador"===e.name){const t=String(me||"").toUpperCase().trim(),a="ADMINISTRADOR"===t||"COORDENADOR"===t,n=String(he||"").trim(),s=n&&"CAPTAR"!==n.toUpperCase()?y.filter(e=>String(v[e.value]||"").toUpperCase()===n.toUpperCase()):y;return r.jsx(L.Item,{name:e.name,label:e.name,rules:[{required:"ADMINISTRADOR"!==t&&"COORDENADOR"!==t}],children:r.jsx(te,{options:s,optionFilterProp:"label",showSearch:!0,style:{borderRadius:8},disabled:a})},e.name)}if("Supervisor"===e.name){const t=String(me||"").toUpperCase().trim(),a="ADMINISTRADOR"===t||"COORDENADOR"===t,n="ATIVISTA"===t,s=String(he||"").trim(),o=s&&"CAPTAR"!==s.toUpperCase()?S.filter(e=>String(C[e.value]||"").toUpperCase()===s.toUpperCase()):S;return r.jsx(L.Item,{name:e.name,label:e.name,rules:[{required:n}],children:r.jsx(te,{options:o,optionFilterProp:"label",showSearch:!0,style:{borderRadius:8},disabled:a})},e.name)}if("Ativista"===e.name)return r.jsx(L.Item,{name:e.name,label:e.name,children:r.jsx($,{style:{borderRadius:8},disabled:!0})},e.name);if("Senha"===e.name)return r.jsx(L.Item,{name:e.name,label:e.name,rules:[{required:n}],children:r.jsx($.Password,{style:{borderRadius:8},prefix:r.jsx(V,{})})},e.name);if(s.includes("boolean"))return r.jsx(L.Item,{name:e.name,valuePropName:"checked",label:e.name,children:r.jsx(ne,{})},e.name);if(s.includes("date")){const t=s.includes("timestamp");return r.jsx(L.Item,{name:e.name,label:e.name,rules:[{required:n}],children:r.jsx(se,{style:{width:"100%",borderRadius:8},showTime:t})},e.name)}return s.includes("int")||s.includes("numeric")?r.jsx(L.Item,{name:e.name,label:e.name,rules:[{required:n}],children:r.jsx(oe,{style:{width:"100%",borderRadius:8}})},e.name):"Celular"===e.name?r.jsx(L.Item,{name:e.name,label:e.name,rules:[{required:n}],children:r.jsx($,{style:{borderRadius:8},prefix:r.jsx(ie,{}),maxLength:15,onChange:t=>{const a=(e=>{const t=(e||"").replace(/\D/g,"").slice(0,11);if(t.length<=2)return`(${t}`;const a=t.slice(0,2),r=t.slice(2),n="9"===r[0]?r:"9"+r,s=n.slice(0,5),o=n.slice(5,9);return s?o?`(${a}) ${s}-${o}`:`(${a}) ${s}`:`(${a})`})(t.target.value);i.setFieldsValue({[e.name]:a})}})},e.name):"Nome"===e.name?r.jsx(L.Item,{name:e.name,label:e.name,rules:[{required:n}],getValueFromEvent:G,children:r.jsx($,{style:{borderRadius:8},prefix:r.jsx(A,{}),maxLength:"number"==typeof e.maxLength?e.maxLength:void 0})},e.name):"CPF"===e.name?r.jsx(L.Item,{name:e.name,label:e.name,rules:[{required:n}],children:r.jsx($,{style:{borderRadius:8},prefix:r.jsx(le,{}),maxLength:"number"==typeof e.maxLength?e.maxLength:14,onChange:t=>{const a=(e=>{const t=(e||"").replace(/\D/g,"").slice(0,11),a=t.slice(0,3),r=t.slice(3,6),n=t.slice(6,9),s=t.slice(9,11);let o=a;return r&&(o+=`.${r}`),n&&(o+=`.${n}`),s&&(o+=`-${s}`),o})(t.target.value);i.setFieldsValue({[e.name]:a})}})},e.name):"Email"===e.name?r.jsx(L.Item,{name:e.name,label:e.name,rules:[{required:n}],getValueFromEvent:ue,children:r.jsx($,{style:{borderRadius:8},prefix:r.jsx(ce,{}),maxLength:"number"==typeof e.maxLength?e.maxLength:void 0})},e.name):"Usuario"===e.name?r.jsx(L.Item,{name:e.name,label:e.name,rules:[{required:n}],getValueFromEvent:G,children:r.jsx($,{style:{borderRadius:8},prefix:r.jsx(de,{}),maxLength:"number"==typeof e.maxLength?e.maxLength:void 0})},e.name):"Imagem"===e.name?null:r.jsx(L.Item,{name:e.name,label:e.name,rules:[{required:n}],getValueFromEvent:G,children:r.jsx($,{style:{borderRadius:8},maxLength:"number"==typeof e.maxLength?e.maxLength:void 0})},e.name)};return r.jsxs(_,{open:e,title:r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsxs("div",{className:"navbar-logo",style:{display:"flex",alignItems:"center",gap:8},children:[r.jsx("img",{src:jt,alt:"CAPTAR",style:{height:110,backgroundColor:"#ffffff",borderRadius:8,padding:6}}),r.jsxs("div",{style:{fontSize:12},children:["TENANT: ",r.jsx("strong",{style:{color:"#333"},children:String(J||Y).toUpperCase()})]})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[r.jsxs("div",{style:{textAlign:"right"},children:[r.jsx("div",{style:{fontWeight:700},children:M?.usuario?String(M?.usuario).toUpperCase():String(M?.nome||"").toUpperCase()||"USUÃRIO"}),r.jsx("div",{style:{fontSize:12},children:`FUNÃ‡ÃƒO: ${String(M?.funcao||"").toUpperCase()} | PERFIL: ${String(M?.perfil||"").toUpperCase()}`}),r.jsx("div",{style:{fontSize:12},children:`LOGIN: ${H||"--"} | TEMPO CONECTADO: ${B||"--:--:--"}`})]}),r.jsx(O,{size:"large"})]})]}),onCancel:a,footer:null,destroyOnHidden:!0,width:980,closable:!1,maskClosable:!1,className:"usuarios-modal",children:[r.jsx("style",{children:".usuarios-modal .ant-modal-header{ border-bottom: 1px solid #e8e8e8; } .usuarios-modal .ant-modal-content{ border-radius: 0 !important; } .usuarios-modal .ant-form-item{ margin-bottom:6px; }"}),r.jsxs(L,{form:i,layout:"vertical",children:[r.jsx("div",{style:{display:"grid",gap:16},children:(()=>{const e={};for(const a of l)e[a.name]=a;const t=["Funcao","Perfil","Usuario","Senha","Coordenador","Supervisor","Ativista"].filter(t=>e[t]);return r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:16},children:[r.jsx(K,{title:"IdentificaÃ§Ã£o",size:"small",children:r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 160px",gap:6,alignItems:"end"},children:[e.CPF&&r.jsx("div",{style:{width:"50%"},children:ge(e.CPF)}),e.Ativo&&r.jsx(L.Item,{name:"Ativo",label:"Ativo",valuePropName:"checked",style:{marginBottom:0},children:r.jsx(X,{})}),e.Nome&&r.jsx("div",{style:{gridColumn:"1 / span 2"},children:ge(e.Nome)}),e.Celular&&r.jsx("div",{style:{width:"50%"},children:ge(e.Celular)}),e.Email&&r.jsx("div",{style:{gridColumn:"1 / span 2"},children:ge(e.Email)})]})}),r.jsx(K,{title:"Foto",size:"small",children:r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[r.jsxs("div",{style:{display:"flex",gap:8},children:[r.jsx(P,{onClick:async()=>{try{const e=await navigator.mediaDevices.getUserMedia({video:!0});D(e),U.current&&(U.current.srcObject=e,await U.current.play())}catch{}},children:"Usar Webcam"}),r.jsx(P,{onClick:()=>{const e=U.current;if(e){const t=document.createElement("canvas");t.width=e.videoWidth||640,t.height=e.videoHeight||480;const a=t.getContext("2d");if(a){a.drawImage(e,0,0,t.width,t.height);const r=t.toDataURL("image/jpeg",.92);i.setFieldsValue({ImagemUploadDataUrl:r}),F(r)}}},children:"Capturar"}),r.jsx(P,{onClick:()=>{k&&k.getTracks().forEach(e=>e.stop()),D(null)},children:"Encerrar"})]}),r.jsx("div",{children:r.jsx("input",{type:"file",accept:"image/*,.webp",onChange:e=>{const t=e.target.files?.[0];if(t){i.setFieldsValue({ImagemUploadFile:t});const e=new FileReader;e.onload=()=>{const t=e.result;i.setFieldsValue({ImagemUploadDataUrl:t}),F(t)},e.readAsDataURL(t)}}})}),r.jsx("div",{style:{display:"flex",justifyContent:"center"},children:k?r.jsx("video",{ref:U,style:{width:"100%",maxWidth:360,borderRadius:8}}):R?r.jsx("img",{src:R,alt:"Preview",style:{width:"100%",maxWidth:360,borderRadius:8,background:"#f5f5f5"}}):r.jsx("div",{style:{width:360,height:240,background:"#fafafa",border:"1px dashed #ddd",borderRadius:8}})})]})})]}),r.jsx(K,{title:"Acesso",size:"small",children:r.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:16},children:t.map(t=>ge(e[t]))})})]})})()}),r.jsxs(z,{style:{marginTop:16,display:"flex",justifyContent:"flex-end",width:"100%"},children:[r.jsx(P,{onClick:a,icon:r.jsx(Z,{}),children:"CANCELAR"}),r.jsx(P,{type:"primary",onClick:async()=>{try{const n=await i.validateFields();if(n.Funcao){const e=String(n.Funcao);n.Funcao=e}const s=String(n.Nome||"").trim(),l=String(n.Funcao||"").toUpperCase().trim();if("ADMINISTRADOR"===l||"COORDENADOR"===l)n.Coordenador=s,n.Supervisor="NAO SE APLICA",n.Ativista="NAO SE APLICA";else if("SUPERVISOR"===l){if(!String(n.Coordenador||"").trim())throw new Error("Coordenador Ã© obrigatÃ³rio");n.Supervisor=s,n.Ativista="NAO SE APLICA"}else if("ATIVISTA"===l){if(!String(n.Coordenador||"").trim())throw new Error("Coordenador Ã© obrigatÃ³rio");if(!String(n.Supervisor||"").trim())throw new Error("Supervisor Ã© obrigatÃ³rio");n.Ativista=s}if("string"==typeof n.Celular){const e=String(n.Celular);n.Celular=e.length>15?e.slice(0,15):e}const c=async()=>{const e=new Set([...d]);e.delete("IdTenant");const a={};for(const t of Object.keys(n))e.has(t)&&(a[t]=n[t]);if(t?.IdUsuario){const e=await E.updateUsuario(t.IdUsuario,a);return ee.success("UsuÃ¡rio atualizado"),e.id}{const e=await E.createUsuario(a);return ee.success("UsuÃ¡rio criado"),e.id}},u=String(localStorage.getItem("tenantName")||"CAPTAR"),m=String(n.TenantLayer||u);if("CAPTAR"===String(u).toUpperCase()){const e=String(n.Coordenador||"").trim(),t=String(n.Supervisor||"").trim();if(e){const t=String(v[e]||m);if(t&&m&&t.toUpperCase()!==m.toUpperCase())return void ee.error("NÃ£o Ã© possÃ­vel vincular: Tenants diferentes")}if(t){const e=String(C[t]||m);if(e&&m&&e.toUpperCase()!==m.toUpperCase())return void ee.error("NÃ£o Ã© possÃ­vel vincular: Tenants diferentes")}}try{const e=(await E.listTenants()).rows||[],t=String(n.TenantLayer||m);(e.find(e=>String(e.Nome??e.nome).toUpperCase()===t.toUpperCase())||e.find(e=>String(e.Slug??e.slug).toUpperCase()===String(localStorage.getItem("tenantSlug")||"captar").toUpperCase()))&&delete n.IdTenant}catch{}try{const t=await c();if(i.getFieldValue("ImagemUploadFile")||i.getFieldValue("ImagemUploadDataUrl")){const r=i.getFieldValue("ImagemUploadFile"),n=i.getFieldValue("ImagemUploadDataUrl");try{await E.uploadUsuarioFoto(t,{file:r,data_url:n}),n&&F(n)}catch{try{if(r&&"image/webp"===r.type||n&&String(n).startsWith("data:image/webp")){const s=n||(r?await(a=r,new Promise((e,t)=>{const r=new FileReader;r.onload=()=>e(String(r.result||"")),r.onerror=e=>t(e),r.readAsDataURL(a)})):void 0);if(s){const a=await(e=s,new Promise((t,a)=>{const r=new Image;r.onload=()=>{const a=document.createElement("canvas");a.width=r.width||640,a.height=r.height||480;const n=a.getContext("2d");if(n){n.drawImage(r,0,0);try{const e=a.toDataURL("image/jpeg",.92);t(e)}catch(s){t(e)}}else t(e)},r.onerror=e=>a(e),r.src=e}));await E.uploadUsuarioFoto(t,{data_url:a}),F(a)}}}catch{}}}}catch(r){const e=r?.response?.data?.detail||"";if(!n.Celular||"string"!=typeof n.Celular||!e.includes("character varying(15)")){const e=r?.response?.data?.detail||r?.message||"Falha ao salvar usuÃ¡rio";throw ee.error(e),r}n.Celular=n.Celular.replace(" ",""),await c(),ee.warning("Celular ajustado para caber no limite atual do banco")}o()}catch{}var e,a},icon:r.jsx(Q,{}),children:"SALVAR"})]})]})]})}function kt(){const[e,t]=f.useState([]),[a,n]=f.useState(!1),[s,o]=f.useState(!1),[i,l]=f.useState(null),[c,d]=f.useState([]),[u,p]=f.useState({}),[h,g]=f.useState([]),x=Ne(),{user:y}=yt(),j=()=>r.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[r.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z",fill:"currentColor"}),r.jsx("path",{d:"M20.71 7.04a1 1 0 0 0 0-1.41l-2.34-2.34a1 1 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z",fill:"currentColor"})]}),S=()=>r.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:r.jsx("path",{d:"M6 7h12M9 7v10m6-10v10M4 7h16l-1 14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2L4 7z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),w=()=>r.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:r.jsx("path",{d:"M3 4h6v16H3V4zm12 0h6v16h-6V4z",fill:"currentColor"})}),v=()=>r.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[r.jsx("circle",{cx:"12",cy:"8",r:"4",stroke:"currentColor",strokeWidth:"2"}),r.jsx("path",{d:"M4 20c0-3.866 3.582-7 8-7s8 3.134 8 7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),r.jsx("path",{d:"M18 6h3M19.5 4.5v3",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),b=async()=>{try{n(!0);const e=await x.getUsuariosSchema(),a=["IdUsuario","Nome","CPF","Usuario","Funcao","Perfil","Email","DataCadastro","Cadastrante","TenantLayer","Ativo"],r={};for(const t of e.columns||[])r[t.name]=t;const s=a.filter(e=>r[e]).map(e=>r[e]),o=(e.columns||[]).filter(e=>!a.includes(e.name));d([...s,...o]);let i=(await x.listUsuarios()).rows||[];try{const e=(await x.listPerfil()).rows||[],t=e=>e.IdPerfil??e.id??e.Id??e.ID,a=e=>e.Perfil??e.perfil,r=new Map;for(const o of e){const e=t(o),n=a(o);void 0!==e&&void 0!==n&&r.set(Number(e),String(n))}const n=(await x.listFuncoes()).rows||[],s=new Map;for(const o of n){const e=o.IdFuncao??o.id??o.Id??o.ID,t=o.Funcao??o.Descricao;void 0!==e&&void 0!==t&&s.set(Number(e),String(t))}i=i.map(e=>{const t=e.IdPerfil??e.idPerfil??e.id_perfil,a=void 0!==t?r.get(Number(t)):e.Perfil??e.perfil,n=e.IdFuncao??e.idFuncao??e.id_funcao;let o=void 0!==n?s.get(Number(n)):void 0;if(!o){const t=e.Funcao,a=Number(t);o=!isNaN(a)&&String(a)===String(t)?s.get(a):t}return{...e,Perfil:a??e.Perfil,Funcao:o??e.Funcao}})}catch{}t(i);const l={};for(const t of a)r[t]&&(l[t]=!0);for(const t of o)l[t.name]=!1;r.IdPerfil&&(l.IdPerfil=!1);const c=`usuarios.columns.visible.${y?.usuario||"default"}`,u=localStorage.getItem(c);p(u?JSON.parse(u):l);const m=`usuarios.columns.order.${y?.usuario||"default"}`,h=localStorage.getItem(m);g(h?JSON.parse(h):a.filter(e=>r[e]))}catch(e){ee.error(e?.response?.data?.detail||"Erro ao carregar usuÃ¡rios")}finally{n(!1)}};f.useEffect(()=>{b()},[]);const C=c.map(t=>{const a=t.name,n=Array.from(new Set((e||[]).map(e=>e[a]).filter(e=>null!=e))).slice(0,20).map(e=>({text:Array.isArray(e)?String(e.join(", ")).toUpperCase():String(e).toUpperCase(),value:Array.isArray(e)?String(e.join(", ")).toUpperCase():String(e).toUpperCase()})),s=(t.type||"").toLowerCase(),o=new Set(["IdUsuario","Ativo","CPF","Funcao","Perfil","DataCadastro","TenantLayer","DataUpdate","UltimoAcesso","TokenExpiracao"]),i={title:{IdUsuario:"ID",Nome:"NOME",CPF:"CPF",Usuario:"USUÃRIO",Funcao:"FUNÃ‡ÃƒO",Perfil:"PERFIL",Email:"EMAIL",DataCadastro:"DATA E HORA DE CADASTRO",Cadastrante:"CADASTRANTE",TenantLayer:"TENANT LAYER",Ativo:"ATIVO"}[a]||a.toUpperCase(),dataIndex:a,align:o.has(a)?"center":"left",filters:n,onFilter:(e,t)=>String(t[a]).toUpperCase()===String(e).toUpperCase(),sorter:(e,t)=>{const r=e[a],n=t[a];if(null==r)return-1;if(null==n)return 1;if(Array.isArray(r)||Array.isArray(n)){const e=Array.isArray(r)?r.join(", "):String(r),t=Array.isArray(n)?n.join(", "):String(n);return e.toUpperCase().localeCompare(t.toUpperCase())}return s.includes("int")||s.includes("numeric")?Number(r)-Number(n):s.includes("date")||s.includes("timestamp")?new Date(r).getTime()-new Date(n).getTime():String(r).toUpperCase().localeCompare(String(n).toUpperCase())},sortDirections:["ascend","descend"],render:e=>{if("boolean"==typeof e)return e?"SIM":"NÃƒO";if(null==e)return"";if(Array.isArray(e))return e.map(e=>String(e).toUpperCase()).join(" | ");const t=new Set(["DataUpdate","UltimoAcesso","TokenExpiracao"]);if(s.includes("date")||s.includes("timestamp")){const r=new Date(e);if(!isNaN(r.getTime())){if("DataCadastro"===a)return r.toLocaleString("pt-BR",{hour12:!1});if(t.has(a))return r.toLocaleTimeString("pt-BR",{hour12:!1})}}if("Ativo"===a){const t="true"===String(e).toLowerCase()||1===e||"SIM"===String(e).toUpperCase();return r.jsx(q,{color:t?"green":"red",children:t?"SIM":"NÃƒO"})}return"Email"===a?String(e).toLowerCase():String(e).toUpperCase()},onHeaderCell:()=>({draggable:!0,onDragStart:e=>{e.dataTransfer.setData("text/plain",a)},onDragOver:e=>{e.preventDefault()},onDrop:e=>{const t=e.dataTransfer.getData("text/plain"),r=a;t&&t!==r&&g(e=>{const a=e.filter(e=>e!==t),n=a.indexOf(r);if(-1===n)return e;a.splice(n,0,t);const s=`usuarios.columns.order.${y?.usuario||"default"}`;return localStorage.setItem(s,JSON.stringify(a)),a})}})};return"IdUsuario"===a&&(i.defaultSortOrder="ascend"),i}),I={title:"AÃ‡Ã•ES",dataIndex:"__actions__",render:(e,t)=>r.jsxs(z,{children:[r.jsx(P,{type:"text",icon:r.jsx(j,{}),title:"EDITAR",onClick:()=>{l(t),o(!0)}}),r.jsx(P,{type:"text",danger:!0,icon:r.jsx(S,{}),title:"DELETAR",onClick:async()=>{try{if(!t.IdUsuario)return void ee.info("REGISTRO SEM ID");await x.deleteUsuario(t.IdUsuario),ee.success("USUÃRIO DELETADO"),await b()}catch(e){ee.error(e?.response?.data?.detail||"ERRO AO DELETAR USUÃRIO")}}})]})},A=(h.length?h:C.map(e=>e.dataIndex)).map(e=>C.find(t=>t.dataIndex===e)).filter(Boolean).filter(e=>u[e.dataIndex]).concat([I]),T=r.jsx("div",{style:{padding:12},children:c.map(e=>r.jsx("div",{style:{marginBottom:6},children:r.jsx(ne,{checked:!!u[e.name],onChange:t=>{const a={...u,[e.name]:t.target.checked};p(a);const r=`usuarios.columns.visible.${y?.usuario||"default"}`;localStorage.setItem(r,JSON.stringify(a))},children:e.name.toUpperCase()})},e.name))});return r.jsxs(m.div,{className:"page-container",initial:{opacity:0,y:6},animate:{opacity:1,y:0},transition:{duration:.3},children:[r.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:12},children:r.jsxs(z,{children:[r.jsx(D,{placement:"bottomRight",trigger:["click"],menu:{items:[]},popupRender:()=>T,children:r.jsx(P,{shape:"circle",icon:r.jsx(w,{}),style:{background:"#FFD700",borderColor:"#FFD700",color:"#000"},title:"VISUALIZAÃ‡ÃƒO DE COLUNAS"})}),r.jsx(P,{shape:"circle",icon:r.jsx(v,{}),style:{background:"#FFD700",borderColor:"#FFD700",color:"#000"},onClick:()=>{l(null),o(!0)},title:"NOVO USUÃRIO"})]})}),r.jsx("style",{children:"\n        .usuarios-table .ant-table-thead > tr > th{ background:#FFD700; color:#000; font-family: 'Arimo', Arial, sans-serif; }\n        .usuarios-table .ant-table-thead > tr > th .ant-table-column-title{ display:flex; justify-content:center; align-items:center; text-align:center; }\n        .usuarios-table .ant-table-tbody > tr > td{ font-family: 'Roboto Condensed', Arial, sans-serif; padding:2px 6px; line-height:0.95; height:22px; }\n      "}),r.jsx(H,{loading:a,dataSource:e,columns:A,rowKey:e=>e.IdUsuario??e.id??e.ID??e.id_usuario??JSON.stringify(e),bordered:!0,size:"small",className:"ant-table-striped usuarios-table"}),r.jsx(Ut,{open:s,initial:i||void 0,onCancel:()=>o(!1),onSaved:async()=>{o(!1),await b()}})]})}function Dt(){const[e,t]=f.useState([]),[a,n]=f.useState(!1),[s,o]=f.useState(!1),[i,l]=f.useState(null),[c]=L.useForm(),d=Ne();f.useEffect(()=>{u()},[]);const u=async()=>{try{n(!0);const e=await d.getPermissoes();t(e)}catch(e){ee.error("Erro ao carregar permissÃµes")}finally{n(!1)}},m=[{title:"PERFIL",dataIndex:"perfil",key:"perfil",sorter:(e,t)=>String(e.perfil).toUpperCase().localeCompare(String(t.perfil).toUpperCase()),sortDirections:["ascend","descend"]},{title:"DESCRIÃ‡ÃƒO",dataIndex:"descricao",key:"descricao",sorter:(e,t)=>String(e.descricao).toUpperCase().localeCompare(String(t.descricao).toUpperCase()),sortDirections:["ascend","descend"]},{title:"AÃ‡Ã•ES",key:"actions",render:(e,t)=>r.jsx(z,{children:r.jsx(P,{type:"text",onClick:()=>(e=>{l(e.id),c.setFieldsValue(e),o(!0)})(t),children:"âœŽ"})})}];return r.jsxs("div",{style:{padding:"24px"},children:[r.jsx(H,{columns:m,dataSource:e,loading:a,rowKey:"id",pagination:{pageSize:10}}),r.jsx(_,{title:i?"Editar PermissÃ£o":"Nova PermissÃ£o",open:s,onOk:()=>c.submit(),onCancel:()=>o(!1),width:800,children:r.jsxs(L,{form:c,layout:"vertical",onFinish:async e=>{try{i&&(await d.updatePermissao(e.perfil,e),ee.success("PermissÃ£o atualizada com sucesso")),o(!1),u()}catch(t){ee.error("Erro ao salvar permissÃ£o")}},children:[r.jsx(L.Item,{name:"perfil",label:"Perfil",rules:[{required:!0}],children:r.jsx("input",{disabled:!0})}),r.jsx(L.Item,{name:"descricao",label:"DescriÃ§Ã£o",children:r.jsx("input",{})}),r.jsxs(ue,{gutter:16,children:[r.jsx(me,{span:12,children:r.jsxs(K,{title:"Eleitores",children:[r.jsxs(L.Item,{name:"pode_criar_eleitor",valuePropName:"checked",children:[r.jsx(X,{})," Criar"]}),r.jsxs(L.Item,{name:"pode_editar_eleitor",valuePropName:"checked",children:[r.jsx(X,{})," Editar"]}),r.jsxs(L.Item,{name:"pode_deletar_eleitor",valuePropName:"checked",children:[r.jsx(X,{})," Deletar"]})]})}),r.jsx(me,{span:12,children:r.jsxs(K,{title:"Ativistas",children:[r.jsxs(L.Item,{name:"pode_criar_ativista",valuePropName:"checked",children:[r.jsx(X,{})," Criar"]}),r.jsxs(L.Item,{name:"pode_editar_ativista",valuePropName:"checked",children:[r.jsx(X,{})," Editar"]}),r.jsxs(L.Item,{name:"pode_deletar_ativista",valuePropName:"checked",children:[r.jsx(X,{})," Deletar"]})]})})]}),r.jsxs(ue,{gutter:16,children:[r.jsx(me,{span:12,children:r.jsxs(K,{title:"UsuÃ¡rios",children:[r.jsxs(L.Item,{name:"pode_criar_usuario",valuePropName:"checked",children:[r.jsx(X,{})," Criar"]}),r.jsxs(L.Item,{name:"pode_editar_usuario",valuePropName:"checked",children:[r.jsx(X,{})," Editar"]}),r.jsxs(L.Item,{name:"pode_deletar_usuario",valuePropName:"checked",children:[r.jsx(X,{})," Deletar"]})]})}),r.jsx(me,{span:12,children:r.jsxs(K,{title:"Sistema",children:[r.jsxs(L.Item,{name:"pode_enviar_disparos",valuePropName:"checked",children:[r.jsx(X,{})," Disparos"]}),r.jsxs(L.Item,{name:"pode_ver_relatorios",valuePropName:"checked",children:[r.jsx(X,{})," RelatÃ³rios"]}),r.jsxs(L.Item,{name:"pode_exportar_dados",valuePropName:"checked",children:[r.jsx(X,{})," Exportar"]}),r.jsxs(L.Item,{name:"pode_importar_dados",valuePropName:"checked",children:[r.jsx(X,{})," Importar"]})]})})]})]})})]})}const Pt=()=>{const[e]=L.useForm(),[t,a]=f.useState(!1),[n,s]=f.useState([]),[o,i]=f.useState({current:1,pageSize:10,total:0}),l=[{title:"ID",dataIndex:"id",key:"id",width:80,sorter:(e,t)=>String(e.id).localeCompare(String(t.id)),sortDirections:["ascend","descend"]},{title:"NOME",dataIndex:"nome",key:"nome",width:150,sorter:(e,t)=>String(e.nome).toUpperCase().localeCompare(String(t.nome).toUpperCase()),sortDirections:["ascend","descend"]},{title:"TIPO",dataIndex:"tipo",key:"tipo",width:120,sorter:(e,t)=>String(e.tipo).toUpperCase().localeCompare(String(t.tipo).toUpperCase()),sortDirections:["ascend","descend"]},{title:"DATA",dataIndex:"data",key:"data",width:120,sorter:(e,t)=>new Date(e.data).getTime()-new Date(t.data).getTime(),sortDirections:["ascend","descend"]},{title:"STATUS",dataIndex:"status",key:"status",width:100,sorter:(e,t)=>String(e.status).toUpperCase().localeCompare(String(t.status).toUpperCase()),sortDirections:["ascend","descend"],render:e=>r.jsx("span",{style:{color:{ativo:"green",inativo:"red",pendente:"orange"}[e]||"black"},children:String(e).toUpperCase()})},{title:"RESULTADO",dataIndex:"resultado",key:"resultado",width:200,sorter:(e,t)=>String(e.resultado).toUpperCase().localeCompare(String(t.resultado).toUpperCase()),sortDirections:["ascend","descend"]}];return r.jsx("div",{className:"consultas-container",children:r.jsxs(K,{title:"Consultas AvanÃ§adas",className:"consultas-card",children:[r.jsxs(L,{form:e,layout:"vertical",onFinish:async()=>{a(!0);try{const e=[{id:"1",nome:"Eleitor 1",tipo:"Eleitor",data:"2025-01-15",status:"ativo",resultado:"Encontrado"},{id:"2",nome:"Ativista 2",tipo:"Ativista",data:"2025-01-14",status:"ativo",resultado:"Encontrado"}];s(e),i({...o,total:e.length})}catch(e){console.error("Erro ao buscar:",e)}finally{a(!1)}},className:"consultas-form",children:[r.jsxs(ue,{gutter:16,children:[r.jsx(me,{xs:24,sm:12,md:8,children:r.jsx(L.Item,{label:"Buscar por",name:"searchType",initialValue:"nome",children:r.jsx(te,{options:[{label:"Nome",value:"nome"},{label:"CPF",value:"cpf"},{label:"Email",value:"email"},{label:"Telefone",value:"telefone"}]})})}),r.jsx(me,{xs:24,sm:12,md:8,children:r.jsx(L.Item,{label:"Valor",name:"searchValue",rules:[{required:!0,message:"Digite um valor"}],children:r.jsx($,{placeholder:"Digite o valor para buscar"})})}),r.jsx(me,{xs:24,sm:12,md:8,children:r.jsx(L.Item,{label:"Tipo",name:"tipo",initialValue:"todos",children:r.jsx(te,{options:[{label:"Todos",value:"todos"},{label:"Eleitor",value:"eleitor"},{label:"Ativista",value:"ativista"},{label:"UsuÃ¡rio",value:"usuario"}]})})})]}),r.jsxs(ue,{gutter:16,children:[r.jsx(me,{xs:24,sm:12,md:8,children:r.jsx(L.Item,{label:"Data Inicial",name:"dataInicial",children:r.jsx(se,{style:{width:"100%"}})})}),r.jsx(me,{xs:24,sm:12,md:8,children:r.jsx(L.Item,{label:"Data Final",name:"dataFinal",children:r.jsx(se,{style:{width:"100%"}})})}),r.jsx(me,{xs:24,sm:12,md:8,children:r.jsx(L.Item,{label:"Status",name:"status",initialValue:"todos",children:r.jsx(te,{options:[{label:"Todos",value:"todos"},{label:"Ativo",value:"ativo"},{label:"Inativo",value:"inativo"},{label:"Pendente",value:"pendente"}]})})})]}),r.jsx(L.Item,{children:r.jsxs(z,{children:[r.jsx(P,{type:"primary",htmlType:"submit",icon:r.jsx(pe,{}),loading:t,children:"Buscar"}),r.jsx(P,{icon:r.jsx(he,{}),onClick:()=>{e.resetFields(),s([])},children:"Limpar"}),r.jsx(P,{icon:r.jsx(ge,{}),onClick:()=>{console.log("Exportando resultados...")},disabled:0===n.length,children:"Exportar"})]})})]}),r.jsx(H,{columns:l,dataSource:n,loading:t,pagination:o,rowKey:"id",size:"middle",bordered:!0,className:"ant-table-striped"})]})})};function Ot({open:e,initial:t,onCancel:a,onSaved:n}){const[s]=L.useForm(),[o,i]=f.useState([]),l=Ne();f.useEffect(()=>{e&&((async()=>{try{const e=await l.getPerfilSchema();i(e.columns||[])}catch{}})(),t?s.setFieldsValue(t):s.resetFields())},[e,t]);return r.jsx(_,{open:e,title:t?.id?"Editar Perfil":"Novo Perfil",onCancel:a,footer:null,destroyOnHidden:!0,children:r.jsxs(L,{form:s,layout:"vertical",children:[o.map(e=>{if("IdPerfil"===e.name)return null;const t=!e.nullable,a=e.type.toLowerCase();if(a.includes("boolean"))return r.jsx(L.Item,{name:e.name,valuePropName:"checked",label:e.name,children:r.jsx(ne,{})},e.name);if(a.includes("date")){const n=a.includes("timestamp");return r.jsx(L.Item,{name:e.name,label:e.name,rules:[{required:t}],children:r.jsx(se,{style:{width:"100%"},showTime:n})},e.name)}return a.includes("int")||a.includes("numeric")?r.jsx(L.Item,{name:e.name,label:e.name,rules:[{required:t}],children:r.jsx(oe,{style:{width:"100%"}})},e.name):r.jsx(L.Item,{name:e.name,label:e.name,rules:[{required:t}],children:r.jsx($,{})},e.name)}),r.jsxs(z,{style:{marginTop:16},children:[r.jsx(P,{onClick:a,children:"Cancelar"}),r.jsx(P,{type:"primary",onClick:async()=>{try{const e=await s.validateFields();t?.IdPerfil?(await l.updatePerfil(t.IdPerfil,e),ee.success("Perfil atualizado")):(await l.createPerfil(e),ee.success("Perfil criado")),n()}catch{}},children:"Salvar"})]})]})})}function Rt(){const[e,t]=f.useState([]),[a,n]=f.useState(!1),[s,o]=f.useState(!1),[i,l]=f.useState(null),[c,d]=f.useState([]),[u,p]=f.useState({}),h=Ne(),g=()=>r.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[r.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z",fill:"currentColor"}),r.jsx("path",{d:"M20.71 7.04a1 1 0 0 0 0-1.41l-2.34-2.34a1 1 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z",fill:"currentColor"})]}),x=()=>r.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:r.jsx("path",{d:"M6 7h12M9 7v10m6-10v10M4 7h16l-1 14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2L4 7z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),y=()=>r.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:r.jsx("path",{d:"M3 4h6v16H3V4zm12 0h6v16h-6V4z",fill:"currentColor"})}),j=()=>r.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:r.jsx("path",{d:"M12 5v14M5 12h14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),S=async()=>{try{n(!0);const e=await h.getPerfilSchema();d(e.columns||[]);const a=await h.listPerfil();t(a.rows||[]);const r={};for(const t of e.columns||[])r[t.name]=!0;p(r)}catch(e){ee.error(e?.response?.data?.detail||"Erro ao carregar perfil")}finally{n(!1)}};f.useEffect(()=>{S()},[]);const w={title:"AÃ‡Ã•ES",dataIndex:"__actions__",render:(e,t)=>r.jsxs(z,{children:[r.jsx(P,{type:"text",icon:r.jsx(g,{}),onClick:()=>{l(t),o(!0)}}),r.jsx(P,{type:"text",danger:!0,icon:r.jsx(x,{}),onClick:async()=>{try{if(!t.IdPerfil)return void ee.info("REGISTRO SEM ID");await h.deletePerfil(t.IdPerfil),ee.success("PERFIL DELETADO"),await S()}catch(e){ee.error(e?.response?.data?.detail||"ERRO AO DELETAR PERFIL")}}})]})},v=c.map(t=>{const a=t.name,r=Array.from(new Set((e||[]).map(e=>e[a]).filter(e=>null!=e))).slice(0,20).map(e=>({text:String(e).toUpperCase(),value:String(e).toUpperCase()})),n=(t.type||"").toLowerCase();return{title:a.toUpperCase(),dataIndex:a,filters:r,onFilter:(e,t)=>String(t[a]).toUpperCase()===String(e).toUpperCase(),sorter:(e,t)=>{const r=e[a],s=t[a];return null==r?-1:null==s?1:n.includes("int")||n.includes("numeric")?Number(r)-Number(s):n.includes("date")||n.includes("timestamp")?new Date(r).getTime()-new Date(s).getTime():String(r).toUpperCase().localeCompare(String(s).toUpperCase())},sortDirections:["ascend","descend"],render:e=>"boolean"==typeof e?e?"SIM":"NÃƒO":null==e?"":String(e).toUpperCase()}}).filter(e=>u[e.dataIndex]).concat([w]),b=r.jsx("div",{style:{padding:12},children:c.map(e=>r.jsx("div",{style:{marginBottom:6},children:r.jsx(ne,{checked:!!u[e.name],onChange:t=>p({...u,[e.name]:t.target.checked}),children:e.name})},e.name))});return r.jsxs(m.div,{className:"page-container",initial:{opacity:0,y:6},animate:{opacity:1,y:0},transition:{duration:.3},children:[r.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:12},children:r.jsxs(z,{children:[r.jsx(D,{placement:"bottomRight",trigger:["click"],menu:{items:[]},popupRender:()=>b,children:r.jsx(P,{icon:r.jsx(y,{}),children:"COLUNAS"})}),r.jsx(P,{type:"primary",icon:r.jsx(j,{}),onClick:()=>{l(null),o(!0)},children:"NOVO PERFIL"})]})}),r.jsx(H,{loading:a,dataSource:e,columns:v,rowKey:e=>e.IdPerfil||JSON.stringify(e),bordered:!0,size:"middle",className:"ant-table-striped"}),r.jsx(Ot,{open:s,initial:i||void 0,onCancel:()=>o(!1),onSaved:async()=>{o(!1),await S()}})]})}function Ft({open:e,initial:t,onCancel:a,onSaved:n}){const[s]=L.useForm(),o=Ne(),[i,l]=f.useState([]);f.useEffect(()=>{e&&((async()=>{try{const e=await o.listPerfil();l(e.rows||[])}catch{}})(),t?s.setFieldsValue(t):s.resetFields())},[e,t]);return r.jsx(_,{open:e,title:t?.IdFuncao?"Editar FunÃ§Ã£o":"Nova FunÃ§Ã£o",onCancel:a,footer:null,destroyOnHidden:!0,children:r.jsxs(L,{form:s,layout:"vertical",children:[r.jsx(L.Item,{name:"Funcao",label:"Funcao",rules:[{required:!0}],children:r.jsx($,{})}),r.jsx(L.Item,{name:"Perfil",label:"Perfil",rules:[{required:!0}],children:r.jsx(te,{placeholder:"Selecione um perfil",showSearch:!0,options:(i||[]).map(e=>({label:e.Perfil??e.Nome??e.Descricao??String(e.IdPerfil??""),value:e.Perfil??String(e.IdPerfil??"")})),filterOption:(e,t)=>t?.label?.toLowerCase().includes(e.toLowerCase())})}),r.jsx(L.Item,{name:"Cadastrante",label:"Cadastrante",children:r.jsx($,{})}),r.jsx(L.Item,{name:"Candidato",label:"Candidato",children:r.jsx($,{})}),r.jsx(L.Item,{name:"TenantLayer",label:"TenantLayer",children:r.jsx($,{})}),r.jsx(L.Item,{name:"Ativo",label:"Ativo",valuePropName:"checked",children:r.jsx(X,{})}),r.jsxs(z,{style:{marginTop:16},children:[r.jsx(P,{onClick:a,children:"Cancelar"}),r.jsx(P,{type:"primary",onClick:async()=>{try{const e=await s.validateFields();t?.IdFuncao?(await o.updateFuncao(t.IdFuncao,e),ee.success("FunÃ§Ã£o atualizada")):(await o.createFuncao(e),ee.success("FunÃ§Ã£o criada")),n()}catch{}},children:"Salvar"})]})]})})}function Mt(){const[e,t]=f.useState([]),[a,n]=f.useState(!1),[s,o]=f.useState(!1),[i,l]=f.useState(null),[c,d]=f.useState([]),[u,p]=f.useState({}),h=Ne(),g=()=>r.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[r.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z",fill:"currentColor"}),r.jsx("path",{d:"M20.71 7.04a1 1 0 0 0 0-1.41l-2.34-2.34a1 1 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z",fill:"currentColor"})]}),x=()=>r.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:r.jsx("path",{d:"M6 7h12M9 7v10m6-10v10M4 7h16l-1 14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2L4 7z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),y=()=>r.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:r.jsx("path",{d:"M3 4h6v16H3V4zm12 0h6v16h-6V4z",fill:"currentColor"})}),j=()=>r.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:r.jsx("path",{d:"M12 5v14M5 12h14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),S=(c||[]).map(e=>({title:e.name,dataIndex:e.name})),w=async()=>{try{n(!0);const e=await h.getFuncoesSchema();d(e.columns||[]);const a=await h.listFuncoes();t(a.rows||[]);const r={};for(const t of e.columns||[])r[t.name]=!0;p(r)}catch(e){ee.error(e?.response?.data?.detail||"Erro ao carregar funÃ§Ãµes")}finally{n(!1)}};f.useEffect(()=>{w()},[]);const v={title:"AÃ§Ãµes",key:"actions",render:(e,t)=>r.jsxs(z,{children:[r.jsx(P,{type:"text",icon:r.jsx(g,{}),onClick:()=>{l(t),o(!0)}}),r.jsx(P,{type:"text",danger:!0,icon:r.jsx(x,{}),onClick:async()=>{try{if(!t.IdFuncao)return void ee.info("REGISTRO SEM ID");await h.deleteFuncao(t.IdFuncao),ee.success("FunÃ§Ã£o deletada"),await w()}catch(e){ee.error(e?.response?.data?.detail||"Erro ao deletar funÃ§Ã£o")}}})]})},b=S.filter(e=>u[e.dataIndex]).concat([v]),C=r.jsx("div",{style:{padding:12},children:S.map(e=>r.jsx("div",{style:{marginBottom:6},children:r.jsx(ne,{checked:!!u[e.dataIndex],onChange:t=>p({...u,[e.dataIndex]:t.target.checked}),children:e.title})},e.dataIndex))});return r.jsxs(m.div,{className:"page-container",initial:{opacity:0,y:6},animate:{opacity:1,y:0},transition:{duration:.3},children:[r.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:12},children:r.jsxs(z,{children:[r.jsx(D,{placement:"bottomRight",trigger:["click"],menu:{items:[]},popupRender:()=>C,children:r.jsx(P,{icon:r.jsx(y,{}),children:"COLUNAS"})}),r.jsx(P,{type:"primary",icon:r.jsx(j,{}),onClick:()=>{l(null),o(!0)},children:"NOVA FUNÃ‡ÃƒO"})]})}),r.jsx(H,{bordered:!0,size:"small",loading:a,columns:b,dataSource:e,rowKey:e=>e.IdFuncao}),r.jsx(Ft,{open:s,initial:i,onCancel:()=>o(!1),onSaved:async()=>{o(!1),await w()}})]})}function Lt(){const[e]=L.useForm(),[t]=L.useForm(),[n]=L.useForm(),[s,o]=f.useState("DESCONECTADO"),[i,l]=f.useState([]),[c,d]=f.useState([]),[u,p]=f.useState([]),[h,g]=f.useState([]),[x,y]=f.useState(0),j=Ne(),S=async()=>{try{const{dataset:t,uf:a}=e.getFieldsValue(),r=await j.listarRecursosCkan(t,a);d(r.resources||[]),y(0)}catch(t){try{const{dataset:t,uf:r}=e.getFieldsValue(),n=`https://dadosabertos.tse.jus.br/api/3/action/package_search?q=${encodeURIComponent(t)}`,s=await a.get(n),o=[];for(const e of s.data?.result?.results||[])for(const t of e.resources||[])o.push({id:t.id,name:t.name,format:t.format,url:t.url||t.download_url});let i="AM"===r?o.filter(e=>(e.name||"").toUpperCase().includes("AMAZONAS")||(e.name||"").toUpperCase().endsWith("AM")):o;if(!i.length){const e=["resultados","prestacao","eleicoes","candidatos"];for(const t of e){const e=`https://dadosabertos.tse.jus.br/api/3/action/package_search?q=${encodeURIComponent(t)}`,r=await a.get(e);for(const t of r.data?.result?.results||[])for(const e of t.resources||[]){const t={id:e.id,name:e.name,format:e.format,url:e.url||e.download_url};i.find(e=>e.id===t.id)||i.push(t)}if(i.length)break}"AM"===r&&(i=i.filter(e=>(e.name||"").toUpperCase().includes("AMAZONAS")||(e.name||"").toUpperCase().endsWith("AM")))}d(i),y(0)}catch{}}},w=async()=>{try{const e=c[x]||c[0];if(!e?.url)return void ee.info("Nenhum recurso disponÃ­vel para prÃ©via");const t=await j.previewRecursoCkan(e.url,15);p(t.columns),g(t.rows)}catch(e){try{const e=c[x]||c[0],t=await a.get(e.url),r="string"==typeof t.data?t.data:t.request?.responseText;if(!r)throw new Error("Sem dados");const n=r.split(/\r?\n/).filter(e=>e.trim().length>0);if(n.length<2)throw new Error("CSV vazio");const s=n[0].includes(";")?";":",",o=n[0].split(s).map(e=>e.trim()),i=n.slice(1,Math.min(n.length,16)).map(e=>{const t=e.split(s),a={};return o.forEach((e,r)=>{a[e]=(t[r]??"").trim()}),a});p(o),g(i)}catch(t){ee.error(t?.message||"Erro ao carregar prÃ©via")}}};return f.useEffect(()=>{(async()=>{await(async()=>{try{const e=localStorage.getItem("municipios_AM");if(e){const t=JSON.parse(e);Array.isArray(t)&&t.length&&l(t)}const t=await j.listarMunicipios("AM");l(t.municipios),localStorage.setItem("municipios_AM",JSON.stringify(t.municipios))}catch(e){try{const e=((await a.get("https://servicodados.ibge.gov.br/api/v1/localidades/estados/13/municipios")).data||[]).map(e=>({id:e.id,nome:e.nome}));l(e),localStorage.setItem("municipios_AM",JSON.stringify(e))}catch{}}})(),await S(),await w()})()},[]),r.jsxs(m.div,{className:"page-container",initial:{opacity:0,y:6},animate:{opacity:1,y:0},transition:{duration:.3},children:[r.jsx("h1",{className:"page-title",children:"INTEGRAÃ‡Ã•ES"}),r.jsxs(ue,{gutter:[16,16],children:[r.jsx(me,{xs:24,xl:16,children:r.jsx(K,{title:"APIS TSE",extra:r.jsx(q,{color:"blue",children:"AMAZONAS"}),children:r.jsxs(L,{form:e,layout:"vertical",initialValues:{baseUrl:"https://dadosabertos.tse.jus.br",uf:"AM",dataset:"eleitorado_municipio"},children:[r.jsxs(ue,{gutter:16,children:[r.jsx(me,{xs:24,md:12,children:r.jsx(L.Item,{name:"baseUrl",label:"Base URL",children:r.jsx($,{placeholder:"https://dadosabertos.tse.jus.br"})})}),r.jsx(me,{xs:24,md:12,children:r.jsx(L.Item,{name:"uf",label:"UF",children:r.jsx(te,{options:[{label:"Amazonas",value:"AM"}]})})})]}),r.jsxs(ue,{gutter:16,children:[r.jsx(me,{xs:24,md:12,children:r.jsx(L.Item,{name:"dataset",label:"Dataset",children:r.jsx(te,{onChange:async()=>{await S(),await w()},options:[{label:"Eleitorado por municÃ­pio",value:"eleitorado_municipio"},{label:"Resultados por municÃ­pio",value:"resultados_municipio"},{label:"Zonas eleitorais",value:"zonas_eleitorais"},{label:"Candidatos",value:"candidatos"}]})})}),r.jsx(me,{xs:24,md:12,children:r.jsx(L.Item,{name:"municipio",label:"MunicÃ­pio (opcional)",children:r.jsx(te,{showSearch:!0,placeholder:"Selecione um municÃ­pio",options:i.map(e=>({label:e.nome,value:e.nome}))})})})]}),r.jsxs(z,{children:[r.jsx(P,{type:"primary",onClick:async()=>{try{o("TESTANDO");const{baseUrl:t,uf:r,dataset:n,municipio:s}=e.getFieldsValue();try{const e=await j.testarIntegracao({base_url:t,uf:r,dataset:n,municipio:s});e.connected?(o("CONECTADO"),ee.success("ConexÃ£o realizada com sucesso")):(o("DESCONECTADO"),ee.error(`Falha na conexÃ£o (HTTP ${e.status_code})`))}catch{const e=await a.get(t),r=e.status>=200&&e.status<300;o(r?"CONECTADO":"DESCONECTADO"),ee[r?"success":"error"](r?"ConexÃ£o realizada com sucesso":`Falha na conexÃ£o (HTTP ${e.status})`)}}catch(t){o("DESCONECTADO"),ee.error(t?.response?.data?.detail||"Erro ao testar conexÃ£o")}},children:"Testar ConexÃ£o"}),r.jsx(P,{onClick:async()=>{try{const{baseUrl:a,uf:r,dataset:s,municipio:o}=e.getFieldsValue(),{webhookUrl:i,webhookSecret:l}=t.getFieldsValue(),{tseToken:c,externalApiToken:d}=n.getFieldsValue(),u={base_url:a,uf:r,dataset:s,municipio:o,webhook_url:i,webhook_secret:l,tse_token:c,external_api_token:d,active_webhook:!1};(await j.salvarIntegracaoConfig(u)).saved&&ee.success("ConfiguraÃ§Ã£o salva")}catch(a){try{const{baseUrl:a,uf:r,dataset:s,municipio:o}=e.getFieldsValue(),{webhookUrl:i,webhookSecret:l}=t.getFieldsValue(),{tseToken:c,externalApiToken:d}=n.getFieldsValue(),u={base_url:a,uf:r,dataset:s,municipio:o,webhook_url:i,webhook_secret:l,tse_token:c,external_api_token:d,active_webhook:!1};localStorage.setItem("integracao_cfg",JSON.stringify(u)),ee.success("ConfiguraÃ§Ã£o salva localmente")}catch{ee.error(a?.response?.data?.detail||"Erro ao salvar configuraÃ§Ã£o")}}},children:"Salvar ConfiguraÃ§Ã£o"}),r.jsxs(q,{color:"CONECTADO"===s?"green":"TESTANDO"===s?"blue":"default",children:["STATUS: ",s]}),r.jsx(P,{onClick:async()=>{await S(),await w()},children:"PrÃ©via Dataset (AM)"}),r.jsx(te,{style:{minWidth:240},placeholder:"Selecione recurso",value:c.length?x:void 0,onChange:e=>y(e),options:c.map((e,t)=>({label:e.name||e.url,value:t}))})]})]})})}),r.jsxs(me,{xs:24,xl:8,children:[r.jsx(K,{title:"Webhooks",children:r.jsxs(L,{form:t,layout:"vertical",children:[r.jsx(L.Item,{name:"webhookUrl",label:"URL",children:r.jsx($,{placeholder:"https://seu-sistema.com/webhook"})}),r.jsx(L.Item,{name:"webhookSecret",label:"Segredo",children:r.jsx($,{placeholder:"segredo-opcional"})}),r.jsxs(z,{children:[r.jsx(P,{type:"primary",children:"Salvar"}),r.jsx(X,{checkedChildren:"Ativo",unCheckedChildren:"Inativo"})]})]})}),r.jsx(B,{}),r.jsx(K,{title:"Tokens / Credenciais",children:r.jsxs(L,{form:n,layout:"vertical",children:[r.jsx(L.Item,{name:"tseToken",label:"Token TSE (se aplicÃ¡vel)",children:r.jsx($,{placeholder:"insira seu token, se necessÃ¡rio"})}),r.jsx(L.Item,{name:"externalApiToken",label:"Token API Externa",children:r.jsx($,{placeholder:"token de outros serviÃ§os"})}),r.jsx(P,{type:"primary",children:"Salvar"})]})}),r.jsx(B,{}),r.jsx(K,{title:"PrÃ©via do Dataset Selecionado (primeiras linhas)",children:r.jsx(H,{size:"small",bordered:!0,pagination:!1,columns:u.map(e=>({title:e,dataIndex:e})),dataSource:h,rowKey:e=>JSON.stringify(e)})})]})]})]})}function _t({open:e,initial:t,onCancel:a,onSaved:n}){const[s]=L.useForm(),o=Ne(),{message:i}=M.useApp(),[l,c]=f.useState([]),[d,u]=f.useState([]);f.useEffect(()=>{t?s.setFieldsValue(t):s.resetFields()},[t,e]),f.useEffect(()=>{(async()=>{try{const e=await o.listCandidatos();c(e.rows||[])}catch{}try{const e=await o.listEleicoes();u(e.rows||[])}catch{}})()},[e]);return r.jsx(_,{title:t?"Editar Meta":"Nova Meta",open:e,onCancel:a,onOk:async()=>{try{const e=await s.validateFields(),a=e.DataInicio,r=e.DataFim;if(a&&r&&a.isAfter(r))return void i.error("Data InÃ­cio deve ser menor ou igual Ã  Data Fim");const l={IdCandidato:e.IdCandidato,Numero:e.Numero,Partido:e.Partido,Cargo:e.Cargo,IdEleicao:e.IdEleicao,DataInicio:e.DataInicio?.format("YYYY-MM-DD HH:mm:ss"),DataFim:e.DataFim?.format("YYYY-MM-DD HH:mm:ss"),MetaVotos:e.MetaVotos,MetaDisparos:e.MetaDisparos,MetaAprovacao:e.MetaAprovacao,MetaRejeicao:e.MetaRejeicao,Ativo:!0};t&&t.IdMeta?await o.updateMeta(Number(t.IdMeta),l):await o.createMeta(l),i.success("Meta salva"),n()}catch(e){i.error(e?.response?.data?.detail||"Erro ao salvar meta")}},okText:"Salvar",children:r.jsxs(L,{layout:"vertical",form:s,children:[r.jsx(z,{style:{marginBottom:8},children:r.jsx(P,{onClick:()=>s.resetFields(),children:"Limpar"})}),r.jsx(L.Item,{name:"IdCandidato",label:"Candidato",rules:[{required:!0}],children:r.jsx(te,{placeholder:"Selecione",options:(l||[]).map(e=>({label:String(e.Nome||e.nome),value:Number(e.IdCandidato||e.idCandidato),extra:e})),onChange:(e,t)=>{const a=t?.extra||{};s.setFieldsValue({Numero:a.Numero||a.numero||void 0,Partido:a.Partido||a.partido||void 0,Cargo:a.Cargo||a.cargo||void 0})}})}),r.jsx(L.Item,{name:"IdEleicao",label:"EleiÃ§Ã£o",rules:[{required:!0}],children:r.jsx(te,{placeholder:"Selecione",options:(d||[]).map(e=>({label:String(e.Nome||e.nome),value:Number(e.IdEleicao||e.idEleicao)}))})}),r.jsx(L.Item,{name:"Numero",label:"NÃºmero",children:r.jsx(oe,{style:{width:"100%"},min:0})}),r.jsx(L.Item,{name:"Partido",label:"Partido",children:r.jsx($,{})}),r.jsx(L.Item,{name:"Cargo",label:"Cargo",children:r.jsx($,{})}),r.jsx(L.Item,{name:"DataInicio",label:"Data InÃ­cio",children:r.jsx(se,{showTime:!0,style:{width:"100%"}})}),r.jsx(L.Item,{name:"DataFim",label:"Data Fim",rules:[{validator:(e,t)=>{const a=s.getFieldValue("DataInicio");return a&&t&&a.isAfter(t)?Promise.reject(new Error("Data InÃ­cio deve ser menor ou igual Ã  Data Fim")):Promise.resolve()}}],children:r.jsx(se,{showTime:!0,style:{width:"100%"}})}),r.jsx(L.Item,{name:"MetaVotos",label:"Meta Votos",children:r.jsx(oe,{style:{width:"100%"},min:0})}),r.jsx(L.Item,{name:"MetaDisparos",label:"Disparos",children:r.jsx(oe,{style:{width:"100%"},min:0})}),r.jsx(L.Item,{name:"MetaAprovacao",label:"AprovaÃ§Ã£o",children:r.jsx(oe,{style:{width:"100%"},min:0})}),r.jsx(L.Item,{name:"MetaRejeicao",label:"RejeiÃ§Ã£o",children:r.jsx(oe,{style:{width:"100%"},min:0})}),r.jsx(L.Item,{label:"Imagem (opcional)",children:r.jsx(fe,{beforeUpload:async e=>String(e.type||"").startsWith("image/")?e.size>2097152&&(i.error("Imagem acima de 2MB"),fe.LIST_IGNORE):(i.error("Apenas imagens sÃ£o permitidas"),fe.LIST_IGNORE),maxCount:1,accept:"image/*",children:r.jsx(P,{icon:r.jsx(xe,{}),children:"Selecionar imagem"})})})]})})}function $t(){const e=Ne(),{user:t}=yt(),{message:a}=M.useApp(),[n,s]=f.useState([]),[o,i]=f.useState(!1),[l,c]=f.useState(!1),[d,u]=f.useState(null),[p,h]=f.useState([]),[g,x]=f.useState({}),[y,j]=f.useState([]),S=()=>r.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:r.jsx("path",{d:"M3 4h6v16H3V4zm12 0h6v16h-6V4z",fill:"currentColor"})}),w=()=>r.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:r.jsx("path",{d:"M12 5v14M5 12h14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),v=async()=>{try{i(!0);const a=(await e.listMetas()).rows||[];let r=[],n=[];try{r=(await e.listCandidatos()).rows||[]}catch{}try{n=(await e.listEleicoes()).rows||[]}catch{}const o=new Map;for(const e of r){const t=Number(e.IdCandidato??e.idCandidato??e.Id??e.ID),a=String(e.Nome??e.nome??"");isNaN(t)||o.set(t,a)}const l=new Map;for(const e of n){const t=Number(e.IdEleicao??e.idEleicao??e.Id??e.ID),a=String(e.Nome??e.nome??"");isNaN(t)||l.set(t,a)}const c=a.map(e=>{const t=Number(e.IdCandidato??e.idCandidato),a=Number(e.IdEleicao??e.idEleicao),r=o.get(t)||(e.CandidatoNome??""),n=l.get(a)||(e.EleicaoNome??""),s=Number(e.VotosAtual??e.votosAtual??0),i=Number(e.MetaVotos??0),c=i>0?Math.min(100,Math.round(s/i*100)):0;return{...e,Candidato:r,Eleicao:n,ProgressoVotos:c}});s(c);const d=["IdMeta","Candidato","Numero","Partido","Cargo","Eleicao","DataInicio","DataFim","MetaVotos","ProgressoVotos","MetaDisparos","MetaAprovacao","MetaRejeicao","TenantLayer"],u=e=>{const t=c.find(t=>void 0!==t[e]&&null!==t[e]),a=typeof(t?t[e]:"");return"number"===a?"int":"boolean"===a?"bool":String(e).toLowerCase().includes("data")?"timestamp":"text"},m=Array.from(new Set(c.flatMap(e=>Object.keys(e)))),p={};for(const e of m)p[e]={name:e,type:u(e),nullable:!0};const g=d.filter(e=>p[e]).map(e=>p[e]),f=m.filter(e=>!d.includes(e)).map(e=>p[e]);h([...g,...f]);const y={};for(const e of d)p[e]&&(y[e]=!0);for(const e of f)y[e.name]=!1;const S=`metas.columns.visible.${t?.usuario||"default"}`,w=localStorage.getItem(S);x(w?JSON.parse(w):y);const v=`metas.columns.order.${t?.usuario||"default"}`,b=localStorage.getItem(v);j(b?JSON.parse(b):d.filter(e=>p[e]))}catch(r){a.error(r?.response?.data?.detail||"Erro ao carregar metas")}finally{i(!1)}};f.useEffect(()=>{v()},[]);const b=p.map(e=>{const a=e.name,r=Array.from(new Set((n||[]).map(e=>e[a]).filter(e=>null!=e))).slice(0,20).map(e=>({text:Array.isArray(e)?String(e.join(", ")).toUpperCase():String(e).toUpperCase(),value:Array.isArray(e)?String(e.join(", ")).toUpperCase():String(e).toUpperCase()})),s=(e.type||"").toLowerCase(),o=new Set(["IdMeta","Numero","MetaVotos","ProgressoVotos","MetaDisparos","MetaAprovacao","MetaRejeicao","DataInicio","DataFim","TenantLayer"]),i={title:{IdMeta:"ID",Candidato:"CANDIDATO",Numero:"NÃšMERO",Partido:"PARTIDO",Cargo:"CARGO",Eleicao:"ELEIÃ‡ÃƒO",DataInicio:"DATA INÃCIO",DataFim:"DATA FIM",MetaVotos:"META VOTOS",ProgressoVotos:"PROGRESSO (%)",MetaDisparos:"DISPAROS",MetaAprovacao:"APROVAÃ‡ÃƒO",MetaRejeicao:"REJEIÃ‡ÃƒO",TenantLayer:"TENANT LAYER"}[a]||a.toUpperCase(),dataIndex:a,align:o.has(a)?"center":"left",filters:r,onFilter:(e,t)=>String(t[a]).toUpperCase()===String(e).toUpperCase(),sorter:(e,t)=>{const r=e[a],n=t[a];if(null==r)return-1;if(null==n)return 1;if(Array.isArray(r)||Array.isArray(n)){const e=Array.isArray(r)?r.join(", "):String(r),t=Array.isArray(n)?n.join(", "):String(n);return e.toUpperCase().localeCompare(t.toUpperCase())}return s.includes("int")||s.includes("numeric")?Number(r)-Number(n):s.includes("date")||s.includes("timestamp")?new Date(r).getTime()-new Date(n).getTime():String(r).toUpperCase().localeCompare(String(n).toUpperCase())},sortDirections:["ascend","descend"],render:e=>{if("boolean"==typeof e)return e?"SIM":"NÃƒO";if(null==e)return"";if(Array.isArray(e))return e.map(e=>String(e).toUpperCase()).join(" | ");if(s.includes("date")||s.includes("timestamp")){const t=new Date(e);if(!isNaN(t.getTime()))return t.toLocaleString("pt-BR",{hour12:!1})}return"ProgressoVotos"===a?`${Number(e||0)}%`:String(e).toUpperCase()},onHeaderCell:()=>({draggable:!0,onDragStart:e=>{e.dataTransfer.setData("text/plain",a)},onDragOver:e=>{e.preventDefault()},onDrop:e=>{const r=e.dataTransfer.getData("text/plain"),n=a;r&&r!==n&&j(e=>{const a=e.filter(e=>e!==r),s=a.indexOf(n);if(-1===s)return e;a.splice(s,0,r);const o=`metas.columns.order.${t?.usuario||"default"}`;return localStorage.setItem(o,JSON.stringify(a)),a})}})};return"IdMeta"===a&&(i.defaultSortOrder="ascend"),i}),C={title:"AÃ‡Ã•ES",dataIndex:"__actions__",render:(t,n)=>r.jsxs(z,{children:[r.jsx(P,{type:"text",title:"EDITAR",onClick:()=>{u(n),c(!0)},children:"EDITAR"}),r.jsx(P,{type:"text",danger:!0,title:"DELETAR",onClick:async()=>{try{if(!n.IdMeta)return void a.info("REGISTRO SEM ID");await e.deleteMeta(n.IdMeta),a.success("META DELETADA"),await v()}catch(t){a.error(t?.response?.data?.detail||"ERRO AO DELETAR META")}}})]})},I=(y.length?y:b.map(e=>e.dataIndex)).map(e=>b.find(t=>t.dataIndex===e)).filter(Boolean).filter(e=>g[e.dataIndex]).concat([C]),A=r.jsx("div",{style:{padding:12},children:p.map(e=>r.jsx("div",{style:{marginBottom:6},children:r.jsx(ne,{checked:!!g[e.name],onChange:a=>{const r={...g,[e.name]:a.target.checked};x(r);const n=`metas.columns.visible.${t?.usuario||"default"}`;localStorage.setItem(n,JSON.stringify(r))},children:e.name.toUpperCase()})},e.name))});return r.jsxs(m.div,{className:"page-container",initial:{opacity:0,y:6},animate:{opacity:1,y:0},transition:{duration:.3},children:[r.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:12},children:r.jsxs(z,{children:[r.jsx(D,{placement:"bottomRight",trigger:["click"],menu:{items:[]},popupRender:()=>A,children:r.jsx(P,{shape:"circle",icon:r.jsx(S,{}),style:{background:"#FFD700",borderColor:"#FFD700",color:"#000"},title:"VISUALIZAÃ‡ÃƒO DE COLUNAS"})}),r.jsx(P,{shape:"circle",icon:r.jsx(w,{}),style:{background:"#FFD700",borderColor:"#FFD700",color:"#000"},onClick:()=>{u(null),c(!0)},title:"NOVA META"})]})}),r.jsx("style",{children:"\n        .metas-table .ant-table-thead > tr > th{ background:#FFD700; color:#000; font-family: 'Arimo', Arial, sans-serif; }\n        .metas-table .ant-table-thead > tr > th .ant-table-column-title{ display:flex; justify-content:center; align-items:center; text-align:center; }\n        .metas-table .ant-table-tbody > tr > td{ font-family: 'Roboto Condensed', Arial, sans-serif; padding:2px 6px; line-height:0.95; height:22px; }\n      "}),r.jsx(H,{loading:o,dataSource:n,columns:I,rowKey:e=>e.IdMeta??e.id??JSON.stringify(e),bordered:!0,size:"small",className:"ant-table-striped metas-table",scroll:{y:520},locale:{emptyText:"Nenhuma meta cadastrada"}}),r.jsx(_t,{open:l,initial:d||void 0,onCancel:()=>c(!1),onSaved:async()=>{c(!1),await v()}})]})}function Vt(){const e=Ne(),{message:t}=M.useApp(),[a,n]=f.useState(!1),[s,o]=f.useState([]),[i,l]=f.useState(!1),[c]=L.useForm(),d=async()=>{try{n(!0);const t=await e.listEleicoes();o(t.rows||[])}catch{t.error("Erro ao carregar eleiÃ§Ãµes")}finally{n(!1)}};f.useEffect(()=>{d()},[]);return r.jsxs(m.div,{className:"page-container",initial:{opacity:0,y:6},animate:{opacity:1,y:0},transition:{duration:.3},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:12},children:[r.jsx("h3",{style:{margin:0},children:"ELEIÃ‡Ã•ES"}),r.jsx(z,{children:r.jsx(P,{type:"primary",onClick:()=>l(!0),children:"NOVA ELEIÃ‡ÃƒO"})})]}),r.jsx(K,{children:r.jsx(H,{loading:a,dataSource:s,columns:[{title:"Id",dataIndex:"IdEleicao",key:"IdEleicao",width:80},{title:"Nome",dataIndex:"Nome",key:"Nome"},{title:"Ano",dataIndex:"Ano",key:"Ano",width:100},{title:"Turno",dataIndex:"Turno",key:"Turno",width:100},{title:"Cargo",dataIndex:"Cargo",key:"Cargo",width:160},{title:"InÃ­cio",dataIndex:"DataInicio",key:"DataInicio",width:160},{title:"Fim",dataIndex:"DataFim",key:"DataFim",width:160},{title:"Ativo",dataIndex:"Ativo",key:"Ativo",width:100}],rowKey:e=>e.IdEleicao??JSON.stringify(e),pagination:{pageSize:10},scroll:{y:480},locale:{emptyText:"Nenhuma eleiÃ§Ã£o"}})}),r.jsx(_,{title:"Nova EleiÃ§Ã£o",open:i,onCancel:()=>l(!1),onOk:async()=>{try{const a=await c.validateFields(),r={...a,Ativo:!!a.Ativo},n=await e.createEleicao(r);n&&n.id&&(t.success("EleiÃ§Ã£o criada"),l(!1),c.resetFields(),d())}catch{}},okText:"Salvar",children:r.jsxs(L,{layout:"vertical",form:c,children:[r.jsx(L.Item,{name:"Nome",label:"Nome",rules:[{required:!0}],children:r.jsx($,{})}),r.jsx(L.Item,{name:"Ano",label:"Ano",children:r.jsx($,{type:"number"})}),r.jsx(L.Item,{name:"Turno",label:"Turno",children:r.jsx($,{type:"number"})}),r.jsx(L.Item,{name:"Cargo",label:"Cargo",children:r.jsx($,{})}),r.jsx(L.Item,{name:"DataInicio",label:"Data InÃ­cio",children:r.jsx($,{placeholder:"YYYY-MM-DD HH:mm:ss"})}),r.jsx(L.Item,{name:"DataFim",label:"Data Fim",children:r.jsx($,{placeholder:"YYYY-MM-DD HH:mm:ss"})}),r.jsx(L.Item,{name:"Ativo",label:"Ativo",valuePropName:"checked",children:r.jsx(X,{})})]})})]})}function zt(){const e=Ne(),{message:t}=M.useApp(),[a,n]=f.useState(!1),[s,o]=f.useState([]),[i,l]=f.useState(!1),[c]=L.useForm(),[d,u]=f.useState(""),p=async()=>{try{n(!0);const t=await e.listCandidatos();o(t.rows||[])}catch{t.error("Erro ao carregar candidatos")}finally{n(!1)}};f.useEffect(()=>{p()},[]);const h=[{title:"Id",dataIndex:"IdCandidato",key:"IdCandidato",width:80},{title:"Nome",dataIndex:"Nome",key:"Nome"},{title:"Numero",dataIndex:"Numero",key:"Numero",width:120},{title:"Partido",dataIndex:"Partido",key:"Partido",width:160},{title:"Cargo",dataIndex:"Cargo",key:"Cargo",width:160},{title:"Foto",dataIndex:"Foto",key:"Foto",render:e=>e?r.jsx(ye,{src:e,width:48,fallback:""}):r.jsx("span",{style:{color:"#999"},children:"Sem foto"}),width:120}];return r.jsxs(m.div,{className:"page-container",initial:{opacity:0,y:6},animate:{opacity:1,y:0},transition:{duration:.3},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:12},children:[r.jsx("h3",{style:{margin:0},children:"CANDIDATOS"}),r.jsx(z,{children:r.jsx(P,{type:"primary",onClick:()=>l(!0),children:"NOVO CANDIDATO"})})]}),r.jsx(K,{children:r.jsx(H,{loading:a,dataSource:s,columns:h,rowKey:e=>e.IdCandidato??JSON.stringify(e),pagination:{pageSize:10},scroll:{y:480},locale:{emptyText:"Nenhum candidato"}})}),r.jsx(_,{title:"Novo Candidato",open:i,onCancel:()=>l(!1),onOk:async()=>{try{const a={...await c.validateFields(),Foto:d},r=await e.createCandidato(a);r&&r.id&&(t.success("Candidato criado"),l(!1),c.resetFields(),u(""),p())}catch{}},okText:"Salvar",children:r.jsxs(L,{layout:"vertical",form:c,children:[r.jsx(L.Item,{name:"Nome",label:"Nome",rules:[{required:!0}],children:r.jsx($,{})}),r.jsx(L.Item,{name:"Numero",label:"NÃºmero",children:r.jsx($,{type:"number"})}),r.jsx(L.Item,{name:"Partido",label:"Partido",children:r.jsx($,{})}),r.jsx(L.Item,{name:"Cargo",label:"Cargo",children:r.jsx($,{})}),r.jsxs(L.Item,{label:"Foto",children:[r.jsx(fe,{beforeUpload:async e=>{if(!String(e.type||"").startsWith("image/"))return t.error("Apenas imagens sÃ£o permitidas"),fe.LIST_IGNORE;if(e.size>2097152)return t.error("Imagem acima de 2MB"),fe.LIST_IGNORE;const a=new FileReader;return a.onload=()=>{const e=String(a.result||"");u(e)},a.readAsDataURL(e),!1},maxCount:1,accept:"image/*",children:r.jsx(P,{icon:r.jsx(xe,{}),children:"Selecionar imagem"})}),d&&r.jsx("div",{style:{marginTop:8},children:r.jsx(ye,{src:d,width:96})})]})]})})]})}const qt=f.lazy(()=>gt(()=>import("./Dashboard-BHYDSYyS.js"),__vite__mapDeps([0,1,2,3,4]))),Bt=f.lazy(()=>gt(()=>import("./Estatisticas-DJbptZDc.js"),__vite__mapDeps([5,1,2,4]))),Wt=f.lazy(()=>gt(()=>import("./Tenants-y579Rx6U.js"),__vite__mapDeps([6,1,2,4]))),{Content:Ht}=C;function Yt(){const{isAuthenticated:e}=yt(),t=j(),a=("undefined"!=typeof window?localStorage.getItem("rootTenantSlug"):null)||"captar",n="1"===("undefined"!=typeof window?localStorage.getItem("adminContext"):null)||"captar"===String(a).toLowerCase();return r.jsx(p,{mode:"wait",children:r.jsx(m.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},transition:{duration:.25},children:r.jsxs(w,{location:t,children:[r.jsx(v,{path:"/login",element:r.jsx(Tt,{})}),r.jsx(v,{path:"/",element:e?r.jsx(f.Suspense,{fallback:r.jsx("div",{style:{padding:24},children:"Carregando..."}),children:r.jsx(qt,{})}):r.jsx(b,{to:"/login"})}),r.jsx(v,{path:"/eleitores",element:e?r.jsx(Nt,{}):r.jsx(b,{to:"/login"})}),r.jsx(v,{path:"/ativistas",element:e?r.jsx(Et,{}):r.jsx(b,{to:"/login"})}),r.jsx(v,{path:"/usuarios",element:e?r.jsx(kt,{}):r.jsx(b,{to:"/login"})}),r.jsx(v,{path:"/perfil",element:e?r.jsx(Rt,{}):r.jsx(b,{to:"/login"})}),r.jsx(v,{path:"/funcoes",element:e?r.jsx(Mt,{}):r.jsx(b,{to:"/login"})}),r.jsx(v,{path:"/permissoes",element:e?r.jsx(Dt,{}):r.jsx(b,{to:"/login"})}),r.jsx(v,{path:"/estatisticas",element:e?r.jsx(f.Suspense,{fallback:r.jsx("div",{style:{padding:24},children:"Carregando..."}),children:r.jsx(Bt,{})}):r.jsx(b,{to:"/login"})}),r.jsx(v,{path:"/consultas",element:e?r.jsx(Pt,{}):r.jsx(b,{to:"/login"})}),r.jsx(v,{path:"/integracoes",element:e?r.jsx(Lt,{}):r.jsx(b,{to:"/login"})}),r.jsx(v,{path:"/parametros/metas",element:e?r.jsx($t,{}):r.jsx(b,{to:"/login"})}),r.jsx(v,{path:"/parametros/tenants",element:e&&n?r.jsx(f.Suspense,{fallback:r.jsx("div",{style:{padding:24},children:"Carregando..."}),children:r.jsx(Wt,{})}):r.jsx(b,{to:"/"})}),r.jsx(v,{path:"/parametros/eleicoes",element:e?r.jsx(f.Suspense,{fallback:r.jsx("div",{style:{padding:24},children:"Carregando..."}),children:r.jsx(Vt,{})}):r.jsx(b,{to:"/login"})}),r.jsx(v,{path:"/parametros/candidatos",element:e?r.jsx(f.Suspense,{fallback:r.jsx("div",{style:{padding:24},children:"Carregando..."}),children:r.jsx(zt,{})}):r.jsx(b,{to:"/login"})}),r.jsx(v,{path:"*",element:r.jsx(b,{to:"/"})})]})},t.pathname)})}function Jt(){const{isAuthenticated:e}=yt();return r.jsxs(S,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:[e&&r.jsx(It,{}),r.jsx(M,{children:r.jsx(C,{children:r.jsx(Ht,{className:"app-content",children:r.jsx(Yt,{})})})})]})}be.createRoot(document.getElementById("root")).render(r.jsx(x.StrictMode,{children:r.jsx(je,{locale:pt,theme:{algorithm:Se.defaultAlgorithm,token:{colorPrimary:"#667eea",borderRadius:10,fontSize:15,colorBgContainer:"#ffffff"},components:{Table:{headerBg:"#f5f7fa",headerColor:"#1f1f1f",borderRadius:8,rowHoverBg:"#e6f4ff"},Card:{borderRadiusLG:14},Button:{borderRadius:10}}},children:r.jsx(M,{children:r.jsx(Te,{children:r.jsx(Jt,{})})})})}));export{jt as L,Ie as a,yt as b,bt as p,Ne as u};
