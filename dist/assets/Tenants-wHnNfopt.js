import{u as e,a as n,p as t,j as s,L as a}from"./index-DfSuK2jA.js";import{r as o}from"./react-vendor-31_VYUn4.js";import{F as r,i,I as l,t as m,S as c,B as d,w as u,x as T,A as N,l as b,D as p,u as D,v as A,T as O}from"./ui-vendor-CwlfwZAq.js";import{p as P,i as f,g as x,m as S}from"./utils-DLZ5AbYM.js";import"./charts-vendor-CRs37Wg2.js";function R({open:b,initial:p,onCancel:D,onSaved:A}){const[O]=r.useForm(),S=e(),{user:R}=n(),[E,g]=o.useState(""),h=o.useMemo(()=>{const e=R?.login_time;if(!e)return null;const n=P(e);if(f(n))return n;const t=new Date(e);return isNaN(t.getTime())?null:t},[R]),v=h?x(h,"dd/MM/yyyy HH:mm",{locale:t}):"",C=String(localStorage.getItem("tenantSlug")||"captar"),_=String(localStorage.getItem("tenantName")||"CAPTAR");o.useEffect(()=>{const e=()=>{if(!h)return void g("");const e=Date.now()-h.getTime(),n=Math.floor(e/36e5),t=Math.floor(e%36e5/6e4),s=Math.floor(e%6e4/1e3),a=String(n).padStart(2,"0"),o=String(t).padStart(2,"0"),r=String(s).padStart(2,"0");g(`${a}:${o}:${r}`)};e();const n=setInterval(e,1e3);return()=>clearInterval(n)},[h]),o.useEffect(()=>{b&&(p?O.setFieldsValue({Nome:p.Nome,Slug:p.Slug,Status:p.Status,Plano:p.Plano}):O.resetFields())},[b,p]);return s.jsxDEV(i,{open:b,title:s.jsxDEV("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsxDEV("div",{className:"navbar-logo",style:{display:"flex",alignItems:"center",gap:8},children:[s.jsxDEV("img",{src:a,alt:"CAPTAR",style:{height:110,backgroundColor:"#ffffff",borderRadius:8,padding:6}},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantsModal.tsx",lineNumber:90,columnNumber:13},this),s.jsxDEV("div",{style:{fontSize:12},children:["TENANT: ",s.jsxDEV("strong",{style:{color:"#333"},children:String(_||C).toUpperCase()},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantsModal.tsx",lineNumber:92,columnNumber:23},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantsModal.tsx",lineNumber:91,columnNumber:13},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantsModal.tsx",lineNumber:89,columnNumber:11},this),s.jsxDEV("div",{style:{display:"flex",alignItems:"center",gap:12},children:[s.jsxDEV("div",{style:{textAlign:"right"},children:[s.jsxDEV("div",{style:{fontWeight:700},children:R?.usuario?String(R?.usuario).toUpperCase():String(R?.nome||"").toUpperCase()||"USUÁRIO"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantsModal.tsx",lineNumber:97,columnNumber:15},this),s.jsxDEV("div",{style:{fontSize:12},children:`FUNÇÃO: ${String(R?.funcao||"").toUpperCase()} | PERFIL: ${String(R?.perfil||"").toUpperCase()}`},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantsModal.tsx",lineNumber:100,columnNumber:15},this),s.jsxDEV("div",{style:{fontSize:12},children:`LOGIN: ${v||"--"} | TEMPO CONECTADO: ${E||"--:--:--"}`},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantsModal.tsx",lineNumber:103,columnNumber:15},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantsModal.tsx",lineNumber:96,columnNumber:13},this),s.jsxDEV(N,{size:"large"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantsModal.tsx",lineNumber:107,columnNumber:13},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantsModal.tsx",lineNumber:95,columnNumber:11},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantsModal.tsx",lineNumber:88,columnNumber:9},this),onCancel:D,footer:null,destroyOnHidden:!0,width:800,closable:!1,maskClosable:!1,className:"tenants-modal",children:[s.jsxDEV("style",{children:".tenants-modal .ant-modal-header{ border-bottom: 1px solid #e8e8e8; } .tenants-modal .ant-modal-content{ border-radius: 0 !important; } .tenants-modal .ant-form-item{ margin-bottom:6px; }"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantsModal.tsx",lineNumber:119,columnNumber:7},this),s.jsxDEV(r,{form:O,layout:"vertical",children:[s.jsxDEV("div",{style:{display:"grid",gap:16},children:s.jsxDEV("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[s.jsxDEV("div",{children:[s.jsxDEV(r.Item,{name:"Nome",label:"Nome",rules:[{required:!0}],children:s.jsxDEV(l,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantsModal.tsx",lineNumber:125,columnNumber:17},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantsModal.tsx",lineNumber:124,columnNumber:15},this),s.jsxDEV(r.Item,{name:"Slug",label:"Slug",rules:[{required:!0}],children:s.jsxDEV(l,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantsModal.tsx",lineNumber:128,columnNumber:17},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantsModal.tsx",lineNumber:127,columnNumber:15},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantsModal.tsx",lineNumber:123,columnNumber:13},this),s.jsxDEV("div",{children:[s.jsxDEV(r.Item,{name:"Status",label:"Status",children:s.jsxDEV(m,{options:[{value:"ATIVO",label:"ATIVO"},{value:"INATIVO",label:"INATIVO"}]},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantsModal.tsx",lineNumber:133,columnNumber:17},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantsModal.tsx",lineNumber:132,columnNumber:15},this),s.jsxDEV(r.Item,{name:"Plano",label:"Plano",children:s.jsxDEV(m,{options:[{value:"PADRAO",label:"PADRÃO"},{value:"PRO",label:"PRO"}]},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantsModal.tsx",lineNumber:136,columnNumber:17},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantsModal.tsx",lineNumber:135,columnNumber:15},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantsModal.tsx",lineNumber:131,columnNumber:13},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantsModal.tsx",lineNumber:122,columnNumber:11},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantsModal.tsx",lineNumber:121,columnNumber:9},this),s.jsxDEV(c,{style:{marginTop:16,display:"flex",justifyContent:"flex-end",width:"100%"},children:[s.jsxDEV(d,{onClick:D,icon:s.jsxDEV(u,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantsModal.tsx",lineNumber:142,columnNumber:44},this),children:"CANCELAR"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantsModal.tsx",lineNumber:142,columnNumber:11},this),s.jsxDEV(d,{type:"primary",onClick:async()=>{try{const e=await O.validateFields();if(p?.IdTenant){await S.updateTenant(p.IdTenant,e);const n={...p,...e,__db__:!!p?.Dsn,__db_created_at__:p?.DbCreatedAt||"",__new__:!1};A(n)}else{const n=(await S.createTenant(e)).id,t=e.Nome,s=String(e.Slug||"").toLowerCase(),a=`captar_t${String(n).padStart(2,"0")}_${s}`;let o="";try{const e=await S.provisionTenant({nome:t,slug:s,db_name:a,db_host:"postgres",db_port:"5432",db_user:"captar",db_password:"captar"});o=String(e?.dsn||""),o&&await S.setTenantDsn(s,o).catch(()=>{}),await S.migrateTenantData(s).catch(()=>{})}catch{}const r={IdTenant:n,Nome:t,Slug:e.Slug,Status:e.Status??"ATIVO",Plano:e.Plano??"PADRAO",Dsn:o,__db__:!!o,__db_created_at__:o?(new Date).toISOString():"",__new__:!0};A(r)}}catch{}},icon:s.jsxDEV(T,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantsModal.tsx",lineNumber:143,columnNumber:59},this),children:"SALVAR"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantsModal.tsx",lineNumber:143,columnNumber:11},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantsModal.tsx",lineNumber:141,columnNumber:9},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantsModal.tsx",lineNumber:120,columnNumber:7},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantsModal.tsx",lineNumber:85,columnNumber:5},this)}function E({open:m,initial:p,onCancel:D,onSaved:A}){const[O]=r.useForm(),S=e(),{user:R}=n(),{message:E}=b.useApp(),[g,h]=o.useState(""),v=o.useMemo(()=>{const e=R?.login_time;if(!e)return null;const n=P(e);if(f(n))return n;const t=new Date(e);return isNaN(t.getTime())?null:t},[R]),C=v?x(v,"dd/MM/yyyy HH:mm",{locale:t}):"",_=String(localStorage.getItem("tenantSlug")||"captar"),V=String(localStorage.getItem("tenantName")||"CAPTAR");o.useEffect(()=>{m&&(p?O.setFieldsValue(p):O.resetFields())},[m,p]),o.useEffect(()=>{const e=()=>{if(!v)return void h("");const e=Date.now()-v.getTime(),n=Math.floor(e/36e5),t=Math.floor(e%36e5/6e4),s=Math.floor(e%6e4/1e3),a=String(n).padStart(2,"0"),o=String(t).padStart(2,"0"),r=String(s).padStart(2,"0");h(`${a}:${o}:${r}`)};e();const n=setInterval(e,1e3);return()=>clearInterval(n)},[v]);return s.jsxDEV(i,{open:m,title:s.jsxDEV("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsxDEV("div",{className:"navbar-logo",style:{display:"flex",alignItems:"center",gap:8},children:[s.jsxDEV("img",{src:a,alt:"CAPTAR",style:{height:110,backgroundColor:"#ffffff",borderRadius:8,padding:6}},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantProvisionModal.tsx",lineNumber:76,columnNumber:13},this),s.jsxDEV("div",{style:{fontSize:12},children:["TENANT: ",s.jsxDEV("strong",{style:{color:"#333"},children:String(V||_).toUpperCase()},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantProvisionModal.tsx",lineNumber:78,columnNumber:23},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantProvisionModal.tsx",lineNumber:77,columnNumber:13},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantProvisionModal.tsx",lineNumber:75,columnNumber:11},this),s.jsxDEV("div",{style:{display:"flex",alignItems:"center",gap:12},children:[s.jsxDEV("div",{style:{textAlign:"right"},children:[s.jsxDEV("div",{style:{fontWeight:700},children:R?.usuario?String(R?.usuario).toUpperCase():String(R?.nome||"").toUpperCase()||"USUÁRIO"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantProvisionModal.tsx",lineNumber:83,columnNumber:15},this),s.jsxDEV("div",{style:{fontSize:12},children:`FUNÇÃO: ${String(R?.funcao||"").toUpperCase()} | PERFIL: ${String(R?.perfil||"").toUpperCase()}`},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantProvisionModal.tsx",lineNumber:86,columnNumber:15},this),s.jsxDEV("div",{style:{fontSize:12},children:`LOGIN: ${C||"--"} | TEMPO CONECTADO: ${g||"--:--:--"}`},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantProvisionModal.tsx",lineNumber:89,columnNumber:15},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantProvisionModal.tsx",lineNumber:82,columnNumber:13},this),s.jsxDEV(N,{size:"large"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantProvisionModal.tsx",lineNumber:93,columnNumber:13},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantProvisionModal.tsx",lineNumber:81,columnNumber:11},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantProvisionModal.tsx",lineNumber:74,columnNumber:9},this),onCancel:D,footer:null,destroyOnHidden:!0,width:800,closable:!1,maskClosable:!1,className:"tenants-modal",children:[s.jsxDEV("style",{children:".tenants-modal .ant-modal-header{ border-bottom: 1px solid #e8e8e8; } .tenants-modal .ant-modal-content{ border-radius: 0 !important; } .tenants-modal .ant-form-item{ margin-bottom:6px; }"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantProvisionModal.tsx",lineNumber:105,columnNumber:7},this),s.jsxDEV(r,{form:O,layout:"vertical",children:[s.jsxDEV(r.Item,{name:"nome",label:"Nome",rules:[{required:!0}],children:s.jsxDEV(l,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantProvisionModal.tsx",lineNumber:108,columnNumber:11},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantProvisionModal.tsx",lineNumber:107,columnNumber:9},this),s.jsxDEV(r.Item,{name:"slug",label:"Slug",rules:[{required:!0}],children:s.jsxDEV(l,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantProvisionModal.tsx",lineNumber:111,columnNumber:11},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantProvisionModal.tsx",lineNumber:110,columnNumber:9},this),s.jsxDEV(r.Item,{name:"db_name",label:"Nome do Banco",rules:[{required:!0}],children:s.jsxDEV(l,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantProvisionModal.tsx",lineNumber:114,columnNumber:11},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantProvisionModal.tsx",lineNumber:113,columnNumber:9},this),s.jsxDEV(r.Item,{name:"db_host",label:"Host",rules:[{required:!0}],children:s.jsxDEV(l,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantProvisionModal.tsx",lineNumber:117,columnNumber:11},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantProvisionModal.tsx",lineNumber:116,columnNumber:9},this),s.jsxDEV(r.Item,{name:"db_port",label:"Porta",rules:[{required:!0}],children:s.jsxDEV(l,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantProvisionModal.tsx",lineNumber:120,columnNumber:11},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantProvisionModal.tsx",lineNumber:119,columnNumber:9},this),s.jsxDEV(r.Item,{name:"db_user",label:"Usuário",rules:[{required:!0}],children:s.jsxDEV(l,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantProvisionModal.tsx",lineNumber:123,columnNumber:11},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantProvisionModal.tsx",lineNumber:122,columnNumber:9},this),s.jsxDEV(r.Item,{name:"db_password",label:"Senha",rules:[{required:!0}],children:s.jsxDEV(l.Password,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantProvisionModal.tsx",lineNumber:126,columnNumber:11},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantProvisionModal.tsx",lineNumber:125,columnNumber:9},this),s.jsxDEV(c,{style:{marginTop:16,display:"flex",justifyContent:"flex-end",width:"100%"},children:[s.jsxDEV(d,{onClick:D,icon:s.jsxDEV(u,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantProvisionModal.tsx",lineNumber:129,columnNumber:44},this),children:"CANCELAR"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantProvisionModal.tsx",lineNumber:129,columnNumber:11},this),s.jsxDEV(d,{type:"primary",onClick:async()=>{try{const e=await O.validateFields(),n=await S.provisionTenant(e);E.success(`Banco provisionado: ${n.dsn}`),A({idTenant:n.idTenant,dsn:n.dsn})}catch(e){E.error(e?.response?.data?.detail||"Erro ao provisionar banco")}},icon:s.jsxDEV(T,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantProvisionModal.tsx",lineNumber:130,columnNumber:59},this),children:"SALVAR"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantProvisionModal.tsx",lineNumber:130,columnNumber:11},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantProvisionModal.tsx",lineNumber:128,columnNumber:9},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantProvisionModal.tsx",lineNumber:106,columnNumber:7},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/TenantProvisionModal.tsx",lineNumber:71,columnNumber:5},this)}function g({open:e,dsn:r,onCancel:l}){const{user:m}=n(),[c]=o.useState(""),d=o.useMemo(()=>{const e=m?.login_time;if(!e)return null;const n=P(e);if(f(n))return n;const t=new Date(e);return isNaN(t.getTime())?null:t},[m]),u=d?x(d,"dd/MM/yyyy HH:mm",{locale:t}):"",T=String(localStorage.getItem("tenantSlug")||"captar"),b=String(localStorage.getItem("tenantName")||"CAPTAR");return s.jsxDEV(i,{open:e,title:s.jsxDEV("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsxDEV("div",{className:"navbar-logo",style:{display:"flex",alignItems:"center",gap:8},children:[s.jsxDEV("img",{src:a,alt:"CAPTAR",style:{height:110,backgroundColor:"#ffffff",borderRadius:8,padding:6}},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/DsnViewModal.tsx",lineNumber:35,columnNumber:13},this),s.jsxDEV("div",{style:{fontSize:12},children:["TENANT: ",s.jsxDEV("strong",{style:{color:"#333"},children:String(b||T).toUpperCase()},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/DsnViewModal.tsx",lineNumber:37,columnNumber:23},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/DsnViewModal.tsx",lineNumber:36,columnNumber:13},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/DsnViewModal.tsx",lineNumber:34,columnNumber:11},this),s.jsxDEV("div",{style:{display:"flex",alignItems:"center",gap:12},children:[s.jsxDEV("div",{style:{textAlign:"right"},children:[s.jsxDEV("div",{style:{fontWeight:700},children:m?.usuario?String(m?.usuario).toUpperCase():String(m?.nome||"").toUpperCase()||"USUÁRIO"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/DsnViewModal.tsx",lineNumber:42,columnNumber:15},this),s.jsxDEV("div",{style:{fontSize:12},children:`FUNÇÃO: ${String(m?.funcao||"").toUpperCase()} | PERFIL: ${String(m?.perfil||"").toUpperCase()}`},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/DsnViewModal.tsx",lineNumber:45,columnNumber:15},this),s.jsxDEV("div",{style:{fontSize:12},children:`LOGIN: ${u||"--"} | TEMPO CONECTADO: ${c||"--:--:--"}`},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/DsnViewModal.tsx",lineNumber:48,columnNumber:15},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/DsnViewModal.tsx",lineNumber:41,columnNumber:13},this),s.jsxDEV(N,{size:"large"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/DsnViewModal.tsx",lineNumber:52,columnNumber:13},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/DsnViewModal.tsx",lineNumber:40,columnNumber:11},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/DsnViewModal.tsx",lineNumber:33,columnNumber:9},this),onCancel:l,footer:null,destroyOnHidden:!0,width:800,closable:!1,maskClosable:!1,className:"tenants-modal",children:[s.jsxDEV("style",{children:".tenants-modal .ant-modal-header{ border-bottom: 1px solid #e8e8e8; } .tenants-modal .ant-modal-content{ border-radius: 0 !important; }"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/DsnViewModal.tsx",lineNumber:64,columnNumber:7},this),s.jsxDEV("div",{style:{fontFamily:"monospace"},children:r||"—"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/DsnViewModal.tsx",lineNumber:65,columnNumber:7},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/DsnViewModal.tsx",lineNumber:30,columnNumber:5},this)}function h(){const t=e(),{message:a,modal:r}=b.useApp(),[l,m]=o.useState([]),[u,T]=o.useState(!1),[N,P]=o.useState(!1),[f,x]=o.useState(null),[h,v]=o.useState(!1),[C,_]=o.useState(void 0),[V,y]=o.useState(!1),[j,J]=o.useState(""),[M,I]=o.useState({}),[w,U]=o.useState([]),{user:$}=n(),[k,F]=o.useState({open:!1}),L=async()=>{try{T(!0);const e=await t.listTenants(),n=(e.rows||[]).map(e=>({...e,__db__:!!e.Dsn,__db_created_at__:e.DbCreatedAt||e.dbCreatedAt||""}));m(e=>{const t=[...(e||[]).filter(e=>e&&e.__new__),...n],s=[],a=new Set;for(const n of t){const e=n.IdTenant?`id:${String(n.IdTenant)}`:`slug:${String(n.Slug||n.slug||"").toUpperCase()}`;a.has(e)||(a.add(e),s.push(n))}return s});const s=["IdTenant","Nome","Slug","Status","Plano","DataCadastro","DataUpdate","__db__","__db_created_at__","__actions__"],a=`tenants.columns.visible.${$?.usuario||"default"}`,o=localStorage.getItem(a),r={};for(const t of s)r[t]=!0;I(o?JSON.parse(o):{...r,__db__:!0,__db_created_at__:!0,__actions__:!0});const i=`tenants.columns.order.${$?.usuario||"default"}`,l=localStorage.getItem(i);U(l?JSON.parse(l):s)}catch(e){a.error(e?.response?.data?.detail||"Erro ao carregar tenants")}finally{T(!1)}};o.useEffect(()=>{L()},[]);const B={IdTenant:"ID",Nome:"NOME",Slug:"SLUG",Status:"STATUS",Plano:"PLANO",DataCadastro:"DATA E HORA DE CADASTRO",DataUpdate:"DATA UPDATE"},H=new Set(["IdTenant","Status","Plano","DataCadastro","DataUpdate"]),z=[...["IdTenant","Nome","Slug","Status","Plano","DataCadastro","DataUpdate"].map(e=>{const n={title:B[e]||e.toUpperCase(),dataIndex:e,align:H.has(e)?"center":"left",sorter:(n,t)=>{const s=n[e],a=t[e];return null==s?-1:null==a?1:"IdTenant"===e?Number(a)-Number(s):e.includes("Data")?new Date(s).getTime()-new Date(a).getTime():String(s).toUpperCase().localeCompare(String(a).toUpperCase())},sortDirections:["ascend","descend"],render:n=>{if(null==n)return"";if(e.includes("Data")){const e=new Date(n);if(!isNaN(e.getTime()))return e.toLocaleString("pt-BR",{hour12:!1})}return String(n).toUpperCase()},onHeaderCell:()=>({draggable:!0,onDragStart:n=>{n.dataTransfer.setData("text/plain",e)},onDragOver:e=>{e.preventDefault()},onDrop:n=>{const t=n.dataTransfer.getData("text/plain"),s=e;t&&t!==s&&U(e=>{const n=e.filter(e=>e!==t),a=n.indexOf(s);if(-1===a)return e;n.splice(a,0,t);const o=`tenants.columns.order.${$?.usuario||"default"}`;return localStorage.setItem(o,JSON.stringify(n)),n})}})};return"IdTenant"===e&&(n.defaultSortOrder="descend"),n}),...[{title:"DB",dataIndex:"__db__",align:"center",sorter:(e,n)=>e.__db__===n.__db__?0:e.__db__?-1:1,sortDirections:["ascend","descend"],onHeaderCell:()=>({draggable:!0,onDragStart:e=>{e.dataTransfer.setData("text/plain","__db__")},onDragOver:e=>{e.preventDefault()},onDrop:e=>{const n=e.dataTransfer.getData("text/plain"),t="__db__";n&&n!==t&&U(e=>{const s=e.filter(e=>e!==n),a=s.indexOf(t);if(-1===a)return e;s.splice(a,0,n);const o=`tenants.columns.order.${$?.usuario||"default"}`;return localStorage.setItem(o,JSON.stringify(s)),s})}}),onCell:()=>({title:"Estado do DSN do Tenant"}),render:e=>e?s.jsxDEV(O,{color:"green",children:"CRIADO"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Tenants.tsx",lineNumber:147,columnNumber:32},this):s.jsxDEV(O,{children:"NAO CRIADO"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Tenants.tsx",lineNumber:147,columnNumber:66},this)},{title:"DB CRIADO",dataIndex:"__db_created_at__",align:"center",sorter:(e,n)=>{const t=e.__db_created_at__,s=n.__db_created_at__;return t||s?t?s?new Date(t).getTime()-new Date(s).getTime():-1:1:0},sortDirections:["ascend","descend"],onHeaderCell:()=>({draggable:!0,onDragStart:e=>{e.dataTransfer.setData("text/plain","__db_created_at__")},onDragOver:e=>{e.preventDefault()},onDrop:e=>{const n=e.dataTransfer.getData("text/plain"),t="__db_created_at__";n&&n!==t&&U(e=>{const s=e.filter(e=>e!==n),a=s.indexOf(t);if(-1===a)return e;s.splice(a,0,n);const o=`tenants.columns.order.${$?.usuario||"default"}`;return localStorage.setItem(o,JSON.stringify(s)),s})}}),render:e=>e?new Date(e).toLocaleString("pt-BR",{hour12:!1}):"—"},{title:"AÇÕES",dataIndex:"__actions__",align:"center",onHeaderCell:()=>({draggable:!0,onDragStart:e=>{e.dataTransfer.setData("text/plain","__actions__")},onDragOver:e=>{e.preventDefault()},onDrop:e=>{const n=e.dataTransfer.getData("text/plain"),t="__actions__";n&&n!==t&&U(e=>{const s=e.filter(e=>e!==n),a=s.indexOf(t);if(-1===a)return e;s.splice(a,0,n);const o=`tenants.columns.order.${$?.usuario||"default"}`;return localStorage.setItem(o,JSON.stringify(s)),s})}}),render:(e,n)=>"captar"===String(n.Slug??n.slug??"").toLowerCase()?s.jsxDEV(O,{color:"geekblue",children:"TENANT PADRÃO DO SISTEMA"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Tenants.tsx",lineNumber:210,columnNumber:18},this):s.jsxDEV(c,{children:[s.jsxDEV(d,{type:"text",onClick:()=>{x(n),P(!0)},children:"EDITAR"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Tenants.tsx",lineNumber:214,columnNumber:13},this),s.jsxDEV(d,{type:"text",danger:!0,onClick:()=>{F({open:!0,record:n})},children:"DELETAR"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Tenants.tsx",lineNumber:215,columnNumber:13},this),s.jsxDEV(d,{type:"text",onClick:()=>{J(String(n.Dsn||"—")),y(!0)},children:"VER DSN"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Tenants.tsx",lineNumber:218,columnNumber:13},this),n.__db__?s.jsxDEV(d,{danger:!0,onClick:()=>{r.confirm({title:"Deseja realmente apagar o banco e recriá-lo?",okText:"Sobrescrever",okButtonProps:{danger:!0},cancelText:"Cancelar",onOk:async()=>{try{const e=String(n.Slug||"").toLowerCase(),s=await t.recreateTenantDb(e);a.success(`Banco recriado: ${s.dsn}`),await L()}catch(e){a.error(e?.response?.data?.detail||"Erro ao sobrescrever banco")}}})},children:"SOBRESCREVER O BANCO DE DADOS"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Tenants.tsx",lineNumber:220,columnNumber:15},this):s.jsxDEV(d,{type:"primary",onClick:()=>{const e=n.IdTenant,t=String(n.Slug||"").toLowerCase(),s=String(n.Nome||""),a=`captar_t${String(e).padStart(2,"0")}_${t}`;_({nome:s,slug:t,db_name:a,db_host:"postgres",db_port:"5432",db_user:"captar",db_password:"captar"}),v(!0)},children:"CRIAR BANCO DE DADOS"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Tenants.tsx",lineNumber:239,columnNumber:15},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Tenants.tsx",lineNumber:213,columnNumber:11},this)}]],q=(w.length?w:z.map(e=>e.dataIndex)).map(e=>z.find(n=>n.dataIndex===e)).filter(Boolean).filter(e=>M[e.dataIndex]);return s.jsxDEV(S.div,{className:"page-container",initial:{opacity:0,y:6},animate:{opacity:1,y:0},transition:{duration:.3},children:[s.jsxDEV("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:12},children:s.jsxDEV(c,{children:[s.jsxDEV(p,{placement:"bottomRight",trigger:["click"],menu:{items:[]},popupRender:()=>s.jsxDEV("div",{style:{padding:12},children:Object.keys(M).map(e=>s.jsxDEV("div",{style:{marginBottom:6},children:s.jsxDEV(D,{checked:!!M[e],onChange:n=>{const t={...M,[e]:n.target.checked};I(t);const s=`tenants.columns.visible.${$?.usuario||"default"}`;localStorage.setItem(s,JSON.stringify(t))},children:e.toUpperCase()},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Tenants.tsx",lineNumber:269,columnNumber:19},this)},e,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Tenants.tsx",lineNumber:268,columnNumber:17},this))},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Tenants.tsx",lineNumber:266,columnNumber:13},this),children:s.jsxDEV(d,{shape:"circle",style:{background:"#FFD700",borderColor:"#FFD700",color:"#000"},title:"VISUALIZAÇÃO DE COLUNAS"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Tenants.tsx",lineNumber:279,columnNumber:13},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Tenants.tsx",lineNumber:265,columnNumber:11},this),s.jsxDEV(d,{shape:"circle",style:{background:"#FFD700",borderColor:"#FFD700",color:"#000"},onClick:()=>{x(null),P(!0)},title:"NOVO TENANT"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Tenants.tsx",lineNumber:281,columnNumber:11},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Tenants.tsx",lineNumber:264,columnNumber:9},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Tenants.tsx",lineNumber:263,columnNumber:7},this),s.jsxDEV("style",{children:"\n        .tenants-table .ant-table-thead > tr > th{ background:#FFD700; color:#000; font-family: 'Arimo', Arial, sans-serif; }\n        .tenants-table .ant-table-thead > tr > th .ant-table-column-title{ display:flex; justify-content:center; align-items:center; text-align:center; }\n        .tenants-table .ant-table-tbody > tr > td{ font-family: 'Roboto Condensed', Arial, sans-serif; padding:2px 6px; line-height:0.95; height:22px; }\n      "},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Tenants.tsx",lineNumber:284,columnNumber:7},this),s.jsxDEV(A,{rowKey:e=>e.IdTenant||JSON.stringify(e),loading:u,dataSource:l,columns:q,bordered:!0,size:"small",className:"ant-table-striped tenants-table"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Tenants.tsx",lineNumber:289,columnNumber:7},this),s.jsxDEV(R,{open:N,initial:f||void 0,onCancel:()=>P(!1),onSaved:async e=>{P(!1),x(null);const n={__db__:!1,__db_created_at__:"",...e};m(e=>{const t=(e||[]).filter(e=>Number(e.IdTenant)!==Number(n.IdTenant));return[n,...t]}),window.setTimeout(()=>{L()},n.__new__?1200:0)}},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Tenants.tsx",lineNumber:290,columnNumber:7},this),s.jsxDEV(E,{open:h,initial:C,onCancel:()=>v(!1),onSaved:async()=>{v(!1),await L()}},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Tenants.tsx",lineNumber:305,columnNumber:7},this),s.jsxDEV(g,{open:V,dsn:j,onCancel:()=>y(!1)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Tenants.tsx",lineNumber:311,columnNumber:7},this),s.jsxDEV(i,{open:k.open,title:"Apagar Tenant",onCancel:()=>F({open:!1}),footer:null,children:[s.jsxDEV("style",{children:".tenants-delete-modal .ant-modal-header{ border-bottom: 1px solid #e8e8e8; } .tenants-delete-modal .ant-modal-content{ border-radius: 0 !important; }"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Tenants.tsx",lineNumber:318,columnNumber:9},this),s.jsxDEV("div",{style:{marginBottom:16,fontSize:14},children:"Esta ação pode remover o tenant e opcionalmente o seu banco de dados."},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Tenants.tsx",lineNumber:319,columnNumber:9},this),s.jsxDEV(c,{style:{display:"flex",justifyContent:"flex-end",width:"100%"},children:[s.jsxDEV(d,{onClick:()=>F({open:!1}),children:"Cancelar"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Tenants.tsx",lineNumber:323,columnNumber:11},this),s.jsxDEV(d,{danger:!0,style:{borderRadius:20},onClick:async()=>{try{const e=k.record;if(!e)return;await t.deleteTenant(Number(e.IdTenant)),m(n=>n.filter(n=>Number(n.IdTenant)!==Number(e.IdTenant))),a.success("Tenant apagado (banco mantido)"),F({open:!1}),await L()}catch(e){a.error(e?.response?.data?.detail||"Erro ao deletar tenant")}},children:"Deletar somente o tenant (manter banco)"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Tenants.tsx",lineNumber:324,columnNumber:11},this),s.jsxDEV(d,{danger:!0,type:"primary",style:{borderRadius:20},onClick:async()=>{try{const e=k.record;if(!e)return;const n=String(e.Slug||"").toLowerCase();await t.deleteTenantAndDb(n),m(n=>n.filter(n=>Number(n.IdTenant)!==Number(e.IdTenant))),a.success("Tenant e banco apagados"),F({open:!1}),await L()}catch(e){a.error(e?.response?.data?.detail||"Erro ao deletar tenant e banco")}},children:"Deletar tenant e banco de dados"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Tenants.tsx",lineNumber:337,columnNumber:11},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Tenants.tsx",lineNumber:322,columnNumber:9},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Tenants.tsx",lineNumber:312,columnNumber:7},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Tenants.tsx",lineNumber:262,columnNumber:5},this)}export{h as default};
