import{u as e,a,p as t,j as i,L as s}from"./index-DfSuK2jA.js";import{r as o}from"./react-vendor-31_VYUn4.js";import{F as n,s as r,m as l,a0 as m,i as c,C as u,I as d,f as p,S as h,p as N,a1 as A,b as f,c as b,V as g,B as O,W as x,U as E,t as C,a2 as T,G as S,w as R,x as D,a3 as v,A as P,l as j,T as V,u as y,K as _,N as M,a4 as J,a5 as w,a6 as I,a7 as L,a8 as $,X as H,a9 as z,aa as W,$ as k,ab as U,ac as F,ad as B,ae as q,af as G,D as Y,v as X}from"./ui-vendor-CwlfwZAq.js";import{p as K,i as Z,g as Q,m as ee}from"./utils-DLZ5AbYM.js";import"./charts-vendor-CRs37Wg2.js";const ae=l??m;function te({open:l,initial:m,onCancel:j,onSaved:V}){const[y]=n.useForm(),[_,M]=r.useMessage(),[J,w]=o.useState("eleitores"),[I,L]=o.useState([]),[$,H]=o.useState([]),[z,W]=o.useState("bottom"),[k,U]=o.useState("nenhum"),[F,B]=o.useState(""),[q,G]=o.useState(!1),[Y,X]=o.useState([]),[ee,te]=o.useState([]),[ie,se]=o.useState("evolution"),oe=e(),{user:ne}=a(),[re,le]=o.useState(0),[me,ce]=o.useState(0),[ue,de]=o.useState(0),[pe,he]=o.useState(0),[Ne,Ae]=o.useState(0),[fe,be]=o.useState(0),[ge,Oe]=o.useState({registros:0,duplicados_distintos:0,excluidos:0,validos:0}),[xe,Ee]=o.useState([]),Ce=n.useWatch("blocos_por_dia",y),Te=n.useWatch("descricao",y),Se=n.useWatch("meta_template_name",y),Re=n.useWatch("meta_template_lang",y),De=n.useWatch("meta_template_preview_text",y),ve=n.useWatch("meta_p1",y),Pe=n.useWatch("meta_p2",y),je=n.useWatch("meta_p3",y),Ve=n.useWatch("meta_p4",y),ye=n.useWatch("meta_p5",y),_e=o.useMemo(()=>{const e=ne?.login_time;if(!e)return null;const a=K(e);if(Z(a))return a;const t=new Date(e);return isNaN(t.getTime())?null:t},[ne]),[Me,Je]=o.useState(""),we=_e?Q(_e,"dd/MM/yyyy HH:mm",{locale:t}):"",Ie=String(localStorage.getItem("tenantSlug")||"captar"),Le=String(localStorage.getItem("tenantName")||"CAPTAR"),$e=o.useMemo(()=>({nome:"FULANO",whatsapp:"5511999999999"}),[]),He=(e,a)=>{let t=String(e??"");const i=String(a?.nome||""),s=String(a?.whatsapp||"");return t=t.replace(/\(NOME\)/gi,i).replace(/\{NOME\}/gi,i).replace(/\(NAME\)/gi,i).replace(/\{NAME\}/gi,i).replace(/\(WHATSAPP\)/gi,s).replace(/\{WHATSAPP\}/gi,s).replace(/\(PHONE\)/gi,s).replace(/\{PHONE\}/gi,s),t},ze=o.useMemo(()=>{const e=$[0],a=String(e?.url||e?.thumbUrl||"").trim();if(a)return a;const t=e?.originFileObj,i="undefined"!=typeof globalThis?globalThis.URL:void 0;if(t&&i&&"function"==typeof i.createObjectURL)try{return i.createObjectURL(t)}catch{return""}return""},[$]),We=o.useMemo(()=>{if("meta"===ie){const e=String(De||"").trim(),a=String(Se||"").trim(),t=[String(ve||"").trim(),String(Pe||"").trim(),String(je||"").trim(),String(Ve||"").trim(),String(ye||"").trim()];return(e||(a?`TEMPLATE: ${a}`:"")||"Sem template").replace(/\{\{\s*1\s*\}\}/g,He(t[0]||"",$e)).replace(/\{\{\s*2\s*\}\}/g,He(t[1]||"",$e)).replace(/\{\{\s*3\s*\}\}/g,He(t[2]||"",$e)).replace(/\{\{\s*4\s*\}\}/g,He(t[3]||"",$e)).replace(/\{\{\s*5\s*\}\}/g,He(t[4]||"",$e)).trim()}let e=String(Te||"");if(e=He(e,$e),"sim_nao"===k){const a=String(F||"").trim(),t=[e.trim()];a&&t.push(a),t.push("RESPONDA:\n1 - SIM\n2 - NÃO"),e=t.filter(Boolean).join("\n\n")}return e.trim()||"Sem texto"},[ie,Te,k,F,Se,De,ve,Pe,je,Ve,ye,$e]),ke=e=>{const a=String(e||"").trim();if(!a)return"";if(/^data:image\//i.test(a)&&/;base64,/i.test(a)){const e=a.split(/;base64,/i)[1]?.trim()||"";return e.startsWith("/")||e.startsWith("http://")||e.startsWith("https://")||e.startsWith("static/")?e.startsWith("static/")?`/${e}`:e:a}return a.startsWith("data:")||a.startsWith("http://")||a.startsWith("https://")||a.startsWith("/static/")?a:a.startsWith("static/")?`/${a}`:a.startsWith("/")?a:/\.(png|jpg|jpeg|bmp|gif|webp)$/i.test(a)?`/static/campanhas/${a}`:a.includes("/")&&!a.startsWith("/")?`/${a}`:`data:image/png;base64,${a}`},Ue=e=>{const a=String(e||"").trim();if(!a)return null;try{return JSON.parse(a)}catch{const e=a.replace(/("whatsapp"\s*:\s*)(?!")([+]?[\d-]+)/gi,'$1"$2"');return JSON.parse(e)}};o.useEffect(()=>{const e=()=>{if(!_e)return void Je("");const e=Date.now()-_e.getTime(),a=Math.floor(e/36e5),t=Math.floor(e%36e5/6e4),i=Math.floor(e%6e4/1e3),s=String(a).padStart(2,"0"),o=String(t).padStart(2,"0"),n=String(i).padStart(2,"0");Je(`${s}:${o}:${n}`)};e();const a=setInterval(e,1e3);return()=>clearInterval(a)},[_e]),o.useEffect(()=>{if(l)if((async()=>{try{const e=await oe.listEvolutionApis();X(e||[])}catch{X([])}})(),m){y.setFieldsValue({...m,data_inicio:m.data_inicio?ae(m.data_inicio):void 0,data_fim:m.data_fim?ae(m.data_fim):void 0}),G(!!m.recorrencia_ativa),H(m?.imagem?[{uid:"-1",name:"imagem",status:"done",url:ke(m.imagem)}]:[]);const e=m?.conteudo_arquivo||m?.AnexoJSON;let a=null;if(e)try{if(a="string"==typeof e?JSON.parse(e):e,!Array.isArray(a)&&a?.config){W(a.config.text_position||"bottom"),U("SIM_NAO"===a.config.response_mode?"sim_nao":"nenhum"),B(String(a.config.question||""));const e=String(a?.config?.provider||"").trim().toLowerCase();se("twilio"===e?"twilio":"meta"===e?"meta":"evolution");const t=a.config||{},i=String(t.meta_template_name||"").trim(),s=String(t.meta_template_lang||"").trim()||"pt_BR",o=String(t.meta_template_preview_text||"").trim(),n=t.meta_template_params??[],r=Array.isArray(n)?n.map(e=>String(e??"").trim()):[];y.setFieldsValue({meta_template_name:i,meta_template_lang:s,meta_template_preview_text:o,meta_p1:r[0]||"",meta_p2:r[1]||"",meta_p3:r[2]||"",meta_p4:r[3]||"",meta_p5:r[4]||""});const l=t.evolution_api_ids??t.evolution_api_id,m=(Array.isArray(l)?l:null!=l?[l]:[]).map(e=>String(e??"").trim()).filter(e=>!!e);te(m)}}catch{}const t=!(!a||Array.isArray(a)||!0!==a?.usar_eleitores&&"eleitores"!==String(a?.source||"").toLowerCase());w(t?"eleitores":e?"arquivo":"eleitores"),le(m.meta||0),ce(m.enviados||0),de(m.nao_enviados||0),he(m.positivos||0),Ae(m.negativos||0);const i=(m.enviados||0)-((m.positivos||0)+(m.negativos||0));be(void 0!==m.aguardando?m.aguardando:i>0?i:0)}else y.resetFields(),y.setFieldsValue({recorrencia_ativa:!1,total_blocos:5,mensagens_por_bloco:500,blocos_por_dia:1,intervalo_min_seg:5,intervalo_max_seg:120,bloco_atual:0,meta_template_name:"",meta_template_lang:"pt_BR",meta_template_preview_text:"",meta_p1:"{NOME}",meta_p2:"",meta_p3:"",meta_p4:"",meta_p5:""}),w("eleitores"),L([]),H([]),W("bottom"),U("nenhum"),B(""),G(!1),te([]),se("evolution"),le(0),ce(0),de(0),he(0),Ae(0),be(0),Oe({registros:0,duplicados_distintos:0,excluidos:0,validos:0}),Ee([])},[l,m]),o.useEffect(()=>{(async()=>{const e=e=>String(e??"").replace(/\D/g,""),a=a=>{const t=new Map;for(const o of a){if(!o||"object"!=typeof o)continue;const a=Object.keys(o),i=a.find(e=>"whatsapp"===String(e).trim().toLowerCase())||a.find(e=>String(e).trim().toLowerCase().includes("whatsapp"))||a.find(e=>["celular","telefone","phone","mobile","tel"].includes(String(e).trim().toLowerCase())),s=i?o[i]:"",n=e(s);n&&t.set(n,(t.get(n)||0)+1)}let i=0,s=0;for(const e of t.values())e>1&&(i++,s+=e-1);return{duplicados_distintos:i,excluidos:s,validos:t.size}},t=(e,a)=>{if(!e||"object"!=typeof e)return"";const t=Object.keys(e);for(const i of a){const e=t.find(e=>String(e).trim().toLowerCase()===i);if(e)return e}for(const i of a){const e=t.find(e=>String(e).trim().toLowerCase().includes(i));if(e)return e}return""},i=a=>{const i=[],s=new Set;for(const o of a||[]){if(!o||"object"!=typeof o)continue;const a=t(o,["whatsapp","celular","telefone","phone","mobile","tel"]),n=t(o,["nome","name","cliente","full name"]),r=a?o[a]:"",l=e(r);if(l&&(!s.has(l)&&(s.add(l),i.push({nome:n?String(o[n]??"").trim():"",whatsapp:l}),i.length>=8)))break}return i};if("eleitores"===J)try{const e=await oe.getDashboardStats();le(e.totalEleitores||0),Oe({registros:0,duplicados_distintos:0,excluidos:0,validos:0}),Ee([])}catch(s){console.error("Erro ao buscar total de eleitores",s)}else if("arquivo"===J&&I.length>0){const e=I[0].originFileObj;if(e)if(e.name.endsWith(".json"))try{const t=await e.text(),s=Ue(t);if(Array.isArray(s)){const e=a(s);if(Oe({registros:s.length,duplicados_distintos:e.duplicados_distintos,excluidos:e.excluidos,validos:e.validos}),le(e.validos),Ee(i(s)),s.length>0){Object.keys(s[0]).map(e=>e.toLowerCase()).includes("whatsapp")||_.warning('Atenção: O arquivo JSON não contém a chave "whatsapp".')}}else Ee([])}catch{}else if(e.name.endsWith(".csv"))try{const t=(await e.text()).split(/\r?\n/).filter(e=>e.trim().length>0);if(t.length>0){const e=t[0],s=(e=>{const a=[",",";","\t","|"];let t=",",i=-1;for(const s of a){const a=e.split(s).length-1;a>i&&(i=a,t=s)}return t})(e),o=e.split(s).map(e=>String(e??"").trim().replace(/^"|"$/g,"").toLowerCase()),n=o.findIndex(e=>"whatsapp"===e||e.includes("whatsapp")),r=o.findIndex(e=>"nome"===e||e.includes("nome")||"name"===e||e.includes("name"));n<0&&_.warning('Atenção: O arquivo CSV não contém a coluna "whatsapp".');const l=[];for(let a=1;a<t.length;a++){const e=t[a].split(s),i=n>=0?e[n]:"",o=r>=0?e[r]:"";l.push({whatsapp:String(i??"").trim().replace(/^"|"$/g,""),nome:String(o??"").trim().replace(/^"|"$/g,"")})}const m=a(l),c=Math.max(0,t.length-1);Oe({registros:c,duplicados_distintos:m.duplicados_distintos,excluidos:m.excluidos,validos:m.validos}),le(m.validos),Ee(i(l))}else le(0),Oe({registros:0,duplicados_distintos:0,excluidos:0,validos:0}),Ee([])}catch{}else le(0),Oe({registros:0,duplicados_distintos:0,excluidos:0,validos:0}),Ee([])}})()},[J,I,oe]),o.useEffect(()=>{if(!l)return;const e=Number(Ce??y.getFieldValue("blocos_por_dia")??1),a=Math.max(1,Math.min(24,Math.floor(e||1))),t=Math.floor(Number(re??0)),i=Math.max(0,Number.isFinite(t)?t:0),s=Math.max(1,Math.min(a,i||1)),o=Math.max(1,Math.ceil((i||1)/s)),n=Number(y.getFieldValue("total_blocos")??0),r=Number(y.getFieldValue("mensagens_por_bloco")??0);n===s&&r===o||y.setFieldsValue({total_blocos:s,mensagens_por_bloco:o})},[l,re,Ce,y]);const Fe=e=>{const a=e?.target?.value;return"string"==typeof a?a.toUpperCase():a};return i.jsxDEV(i.Fragment,{children:[M,i.jsxDEV(c,{open:l,title:i.jsxDEV("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsxDEV("div",{className:"navbar-logo",style:{display:"flex",alignItems:"center",gap:8},children:[i.jsxDEV("img",{src:s,alt:"CAPTAR",style:{height:70,backgroundColor:"#ffffff",borderRadius:8,padding:6}},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:722,columnNumber:13},this),i.jsxDEV("div",{style:{fontSize:12},children:["TENANT: ",i.jsxDEV("strong",{style:{color:"#333"},children:String(Le||Ie).toUpperCase()},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:724,columnNumber:23},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:723,columnNumber:13},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:721,columnNumber:11},this),i.jsxDEV("div",{style:{display:"flex",alignItems:"center",gap:12},children:[i.jsxDEV("div",{style:{textAlign:"right"},children:[i.jsxDEV("div",{style:{fontWeight:700},children:ne?.usuario?String(ne?.usuario).toUpperCase():String(ne?.nome||"").toUpperCase()||"USUÁRIO"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:729,columnNumber:15},this),i.jsxDEV("div",{style:{fontSize:12},children:`FUNÇÃO: ${String(ne?.funcao||"").toUpperCase()} | PERFIL: ${String(ne?.perfil||"").toUpperCase()}`},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:732,columnNumber:15},this),i.jsxDEV("div",{style:{fontSize:12},children:`LOGIN: ${we||"--"} | TEMPO CONECTADO: ${Me||"--:--:--"}`},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:735,columnNumber:15},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:728,columnNumber:13},this),i.jsxDEV(P,{size:40},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:739,columnNumber:13},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:727,columnNumber:11},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:720,columnNumber:9},this),onCancel:j,footer:null,destroyOnHidden:!0,width:"96vw",style:{maxWidth:1960,top:12},styles:{body:{overflowY:"visible"},header:{paddingTop:8,paddingBottom:8}},closable:!1,maskClosable:!1,className:"campanhas-modal",children:[i.jsxDEV("style",{children:".campanhas-modal .ant-modal-header{ border-bottom: 1px solid #e8e8e8; } .campanhas-modal .ant-modal-content{ border-radius: 0 !important; } .campanhas-modal .ant-form-item{ margin-bottom:6px; } .campanhas-modal .campanhas-meta-image-upload.ant-upload-wrapper{ width:100%; } .campanhas-modal .campanhas-meta-image-upload.ant-upload-wrapper.ant-upload-picture-card-wrapper .ant-upload{ width:100% !important; } .campanhas-modal .campanhas-meta-image-upload.ant-upload-wrapper.ant-upload-picture-card-wrapper .ant-upload.ant-upload-select{ width:100% !important; height:120px !important; } .campanhas-modal .campanhas-meta-image-upload.ant-upload-wrapper.ant-upload-picture-card-wrapper .ant-upload-list{ width:100%; } .campanhas-modal .campanhas-meta-image-upload.ant-upload-wrapper.ant-upload-picture-card-wrapper .ant-upload-list-item-container{ width:100% !important; height:auto !important; } .campanhas-modal .campanhas-meta-image-upload.ant-upload-wrapper.ant-upload-picture-card-wrapper .ant-upload-list-item{ width:100% !important; height:auto !important; } .campanhas-modal .campanhas-meta-image-upload.ant-upload-wrapper.ant-upload-picture-card-wrapper .ant-upload-list-item-thumbnail img{ width:100% !important; height:auto !important; object-fit:contain; } .campanhas-modal .campanhas-meta-image-upload.ant-upload-wrapper.ant-upload-picture-card-wrapper .ant-upload-list-item-image{ width:100% !important; height:auto !important; object-fit:contain; }"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:756,columnNumber:7},this),i.jsxDEV(n,{form:y,layout:"vertical",children:i.jsxDEV("div",{style:{display:"flex",gap:16,alignItems:"flex-start"},children:[i.jsxDEV("div",{style:{flex:1,minWidth:0},children:[i.jsxDEV("div",{style:{display:"grid",gridTemplateColumns:"minmax(0, 0.9fr) minmax(0, 1.45fr)",gap:16,alignItems:"start"},children:[i.jsxDEV(u,{title:"DADOS DA CAMPANHA",size:"small",children:[i.jsxDEV(n.Item,{name:"nome",label:"NOME DA CAMPANHA",rules:[{required:!0,message:"Informe o nome"}],getValueFromEvent:Fe,children:i.jsxDEV(d,{prefix:i.jsxDEV(p,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:764,columnNumber:34},this),placeholder:"Ex: CAMPANHA DE DOAÇÃO"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:764,columnNumber:19},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:763,columnNumber:17},this),i.jsxDEV(h,{style:{display:"flex",marginBottom:8},align:"start",children:[i.jsxDEV(n.Item,{name:"data_inicio",label:"DATA INÍCIO",rules:[{required:!0}],children:i.jsxDEV(N,{style:{width:150},format:"DD/MM/YYYY"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:769,columnNumber:25},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:768,columnNumber:21},this),i.jsxDEV(n.Item,{name:"data_fim",label:"DATA FIM",children:i.jsxDEV(N,{style:{width:150},format:"DD/MM/YYYY"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:772,columnNumber:25},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:771,columnNumber:21},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:767,columnNumber:17},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:762,columnNumber:15},this),i.jsxDEV(u,{title:"DESTINATÁRIOS",size:"small",children:i.jsxDEV("div",{style:{display:"grid",gridTemplateColumns:"minmax(0, 1fr) 420px",gap:12,alignItems:"start"},children:[i.jsxDEV("div",{style:{minWidth:0},children:[i.jsxDEV(n.Item,{label:"SELECIONE A ORIGEM DOS CONTATOS",children:i.jsxDEV(A.Group,{value:J,onChange:e=>w(e.target.value),children:[i.jsxDEV(A.Button,{value:"eleitores",children:[i.jsxDEV(f,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:782,columnNumber:61},this)," BASE DE ELEITORES"]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:782,columnNumber:29},this),i.jsxDEV(A.Button,{value:"arquivo",children:[i.jsxDEV(b,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:783,columnNumber:59},this)," IMPORTAR ARQUIVO"]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:783,columnNumber:29},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:781,columnNumber:25},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:780,columnNumber:21},this),"arquivo"===J&&i.jsxDEV(n.Item,{label:"ARQUIVO DE CONTATOS (JSON, CSV, XLS, PDF)",required:!0,children:[i.jsxDEV(g,{maxCount:1,fileList:I,onChange:({fileList:e})=>L(e),beforeUpload:()=>!1,accept:".json,.csv,.xls,.xlsx,.pdf",children:i.jsxDEV(O,{icon:i.jsxDEV(x,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:796,columnNumber:47},this),children:"Selecionar Arquivo"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:796,columnNumber:33},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:789,columnNumber:29},this),i.jsxDEV("div",{style:{marginTop:8,color:"#666",fontSize:"12px"},children:["JSON: O conteúdo será salvo no banco.",i.jsxDEV("br",{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:799,columnNumber:70},this),"Outros: O arquivo será anexado."]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:798,columnNumber:29},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:788,columnNumber:25},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:779,columnNumber:19},this),"arquivo"===J?i.jsxDEV("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:8},children:[i.jsxDEV("div",{style:{background:"#e6f7ff",border:"1px solid #91d5ff",padding:"14px 12px",borderRadius:8,boxShadow:"0 1px 2px rgba(0,0,0,0.04)",minHeight:86,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center"},children:[i.jsxDEV("div",{style:{fontSize:30,fontWeight:900,color:"#1890ff",lineHeight:1.05},children:ge.registros},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:809,columnNumber:25},this),i.jsxDEV("div",{style:{fontSize:12,fontWeight:800,color:"#096dd9",whiteSpace:"nowrap",lineHeight:1.2},children:"REGISTROS NO ARQUIVO"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:810,columnNumber:25},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:808,columnNumber:23},this),i.jsxDEV("div",{style:{background:"#fffbe6",border:"1px solid #ffe58f",padding:"14px 12px",borderRadius:8,boxShadow:"0 1px 2px rgba(0,0,0,0.04)",minHeight:86,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center"},children:[i.jsxDEV("div",{style:{fontSize:30,fontWeight:900,color:"#faad14",lineHeight:1.05},children:ge.duplicados_distintos},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:813,columnNumber:25},this),i.jsxDEV("div",{style:{fontSize:12,fontWeight:800,color:"#ad6800",whiteSpace:"nowrap",lineHeight:1.2},children:"NÚMEROS REPETIDOS"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:814,columnNumber:25},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:812,columnNumber:23},this),i.jsxDEV("div",{style:{background:"#fff1f0",border:"1px solid #ffa39e",padding:"14px 12px",borderRadius:8,boxShadow:"0 1px 2px rgba(0,0,0,0.04)",minHeight:86,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center"},children:[i.jsxDEV("div",{style:{fontSize:30,fontWeight:900,color:"#cf1322",lineHeight:1.05},children:ge.excluidos},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:817,columnNumber:25},this),i.jsxDEV("div",{style:{fontSize:12,fontWeight:800,color:"#a8071a",whiteSpace:"nowrap",lineHeight:1.2},children:"NÃO VÃO ENTRAR"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:818,columnNumber:25},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:816,columnNumber:23},this),i.jsxDEV("div",{style:{background:"#f6ffed",border:"1px solid #b7eb8f",padding:"14px 12px",borderRadius:8,boxShadow:"0 1px 2px rgba(0,0,0,0.04)",minHeight:86,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center"},children:[i.jsxDEV("div",{style:{fontSize:30,fontWeight:900,color:"#3f8600",lineHeight:1.05},children:ge.validos},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:821,columnNumber:25},this),i.jsxDEV("div",{style:{fontSize:12,fontWeight:800,color:"#237804",whiteSpace:"nowrap",lineHeight:1.2},children:"CONTATOS VÁLIDOS"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:822,columnNumber:25},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:820,columnNumber:23},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:807,columnNumber:21},this):null]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:778,columnNumber:17},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:777,columnNumber:15},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:761,columnNumber:13},this),i.jsxDEV("div",{style:{borderTop:"1px solid #e8e8e8",margin:"16px 0"}},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:830,columnNumber:13},this),i.jsxDEV(u,{title:"CONFIGURAÇÕES DE ENVIO",size:"small",children:i.jsxDEV(E,{activeKey:ie,onChange:e=>se(e||"evolution"),items:[{key:"meta",label:"META OFICIAL API",children:i.jsxDEV("div",{style:{display:"grid",gap:16},children:[i.jsxDEV("div",{style:{display:"grid",gridTemplateColumns:"minmax(0, 1fr) minmax(0, 1fr)",gap:16,alignItems:"start"},children:[i.jsxDEV(u,{title:"TEMPLATE",size:"small",children:[i.jsxDEV(n.Item,{name:"meta_template_name",label:"NOME DO TEMPLATE (APROVADO)",rules:[{required:!0,message:"Informe o nome do template"}],getValueFromEvent:Fe,children:i.jsxDEV(d,{placeholder:"Ex: CAMPANHA_APRESENTACAO_01"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:845,columnNumber:31},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:844,columnNumber:29},this),i.jsxDEV(h,{style:{display:"flex",marginBottom:8},align:"start",wrap:!0,children:[i.jsxDEV(n.Item,{name:"meta_template_lang",label:"IDIOMA",initialValue:"pt_BR",rules:[{required:!0}],children:i.jsxDEV(C,{style:{width:200},options:[{value:"pt_BR",label:"pt_BR"},{value:"en_US",label:"en_US"},{value:"es",label:"es"}]},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:850,columnNumber:33},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:849,columnNumber:31},this),i.jsxDEV(n.Item,{label:"TIPO DE ENVIO",children:i.jsxDEV(A.Group,{value:k,onChange:e=>U(e.target.value),children:[i.jsxDEV(A.Button,{value:"nenhum",children:"TEMPLATE"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:862,columnNumber:35},this),i.jsxDEV(A.Button,{value:"sim_nao",children:"TEMPLATE + SIM/NÃO"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:863,columnNumber:35},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:861,columnNumber:33},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:860,columnNumber:31},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:848,columnNumber:29},this),"sim_nao"===k&&i.jsxDEV(n.Item,{label:"PERGUNTA (SIM/NÃO)",children:i.jsxDEV(d,{value:F,onChange:e=>B(String(e?.target?.value||"").toUpperCase()),placeholder:"Ex: VOCÊ APOIA NOSSO PROJETO?"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:870,columnNumber:33},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:869,columnNumber:31},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:843,columnNumber:27},this),i.jsxDEV("div",{style:{display:"grid",gridTemplateColumns:"minmax(0, 1fr) 240px",gap:16,alignItems:"start"},children:[i.jsxDEV(u,{title:"VARIÁVEIS DO BODY",size:"small",children:i.jsxDEV(h,{style:{display:"flex"},align:"start",wrap:!0,children:[i.jsxDEV(n.Item,{name:"meta_p1",label:"VAR 1",initialValue:"{NOME}",rules:[{whitespace:!0}],children:i.jsxDEV(d,{placeholder:"Ex: {NOME}"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:883,columnNumber:35},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:882,columnNumber:33},this),i.jsxDEV(n.Item,{name:"meta_p2",label:"VAR 2",rules:[{whitespace:!0}],children:i.jsxDEV(d,{placeholder:"Opcional"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:886,columnNumber:35},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:885,columnNumber:33},this),i.jsxDEV(n.Item,{name:"meta_p3",label:"VAR 3",rules:[{whitespace:!0}],children:i.jsxDEV(d,{placeholder:"Opcional"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:889,columnNumber:35},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:888,columnNumber:33},this),i.jsxDEV(n.Item,{name:"meta_p4",label:"VAR 4",rules:[{whitespace:!0}],children:i.jsxDEV(d,{placeholder:"Opcional"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:892,columnNumber:35},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:891,columnNumber:33},this),i.jsxDEV(n.Item,{name:"meta_p5",label:"VAR 5",rules:[{whitespace:!0}],children:i.jsxDEV(d,{placeholder:"Opcional"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:895,columnNumber:35},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:894,columnNumber:33},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:881,columnNumber:31},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:880,columnNumber:29},this),i.jsxDEV(u,{title:"IMAGEM (OPCIONAL)",size:"small",children:i.jsxDEV(g,{className:"campanhas-meta-image-upload",listType:"picture-card",maxCount:1,fileList:$,onChange:({fileList:e})=>H(e),beforeUpload:()=>!1,accept:"image/*",style:{width:"100%"},children:$.length<1&&i.jsxDEV("div",{children:[i.jsxDEV(T,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:911,columnNumber:64},this),i.jsxDEV("div",{style:{marginTop:8},children:"Upload"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:911,columnNumber:87},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:911,columnNumber:59},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:901,columnNumber:31},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:900,columnNumber:29},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:879,columnNumber:27},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:842,columnNumber:25},this),i.jsxDEV(n.Item,{name:"meta_template_preview_text",label:"TEXTO DO TEMPLATE (APENAS PREVIEW)",rules:[{whitespace:!0,message:"Texto inválido"}],extra:i.jsxDEV("div",{style:{fontSize:10,color:"#666"},children:["Use ","{{1}}","..","{{5}}"," para visualizar variáveis."]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:921,columnNumber:34},this),children:i.jsxDEV(d.TextArea,{rows:4,placeholder:"Cole aqui o texto do template aprovado para visualizar."},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:923,columnNumber:27},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:917,columnNumber:25},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:841,columnNumber:23},this)},{key:"evolution",label:"EVOLUTIONAPI",children:i.jsxDEV("div",{children:[i.jsxDEV(n.Item,{label:"TIPO DE ENVIO",children:i.jsxDEV(A.Group,{value:k,onChange:e=>U(e.target.value),children:[i.jsxDEV(A.Button,{value:"nenhum",children:"MENSAGEM"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:935,columnNumber:29},this),i.jsxDEV(A.Button,{value:"sim_nao",children:"PERGUNTA SIM / NÃO"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:936,columnNumber:29},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:934,columnNumber:27},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:933,columnNumber:25},this),"sim_nao"===k&&i.jsxDEV(n.Item,{label:"PERGUNTA (SIM/NÃO)",children:i.jsxDEV(d,{value:F,onChange:e=>B(String(e?.target?.value||"").toUpperCase()),placeholder:"Ex: VOCÊ APOIA NOSSO PROJETO?"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:942,columnNumber:29},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:941,columnNumber:27},this),i.jsxDEV(n.Item,{name:"descricao",label:"DESCRIÇÃO / MENSAGEM",rules:[{whitespace:!0,message:"Mensagem inválida"}],extra:i.jsxDEV("div",{style:{fontSize:10,color:"#666"},children:["Dica: Use ",i.jsxDEV("strong",{children:"(NOME)"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:956,columnNumber:41},this)," ou ",i.jsxDEV("strong",{children:"{NOME}"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:956,columnNumber:68},this)," para substituir pelo nome do contato.",i.jsxDEV("br",{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:956,columnNumber:133},this),'Certifique-se que seu arquivo contém uma coluna chamada "Nome", "Name", "Cliente" ou "Full Name".']},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:955,columnNumber:29},this),children:i.jsxDEV(d.TextArea,{rows:4,placeholder:"Texto da mensagem que será enviada"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:961,columnNumber:27},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:950,columnNumber:25},this),i.jsxDEV(n.Item,{label:"EVOLUTION API (INSTÂNCIAS)",children:i.jsxDEV(C,{mode:"multiple",allowClear:!0,value:ee,placeholder:Y.length?"Selecione uma ou mais instâncias":"Nenhuma instância encontrada",options:(Y||[]).map(e=>({value:String(e.id??"").trim(),label:`${String(e.name||e.nome||e.instance_name||e.id)}${e.number?` - ${String(e.number)}`:""}${e.connectionStatus?` (${String(e.connectionStatus)})`:""}`})),onChange:e=>{const a=Array.isArray(e)?e:[];te(a.map(e=>String(e??"").trim()).filter(e=>!!e))}},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:965,columnNumber:27},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:964,columnNumber:25},this),i.jsxDEV(n.Item,{label:"IMAGEM DA MENSAGEM",children:i.jsxDEV("div",{style:{display:"flex",gap:16,alignItems:"flex-start"},children:[i.jsxDEV(g,{listType:"picture-card",maxCount:1,fileList:$,onChange:({fileList:e})=>H(e),beforeUpload:()=>!1,accept:"image/*",children:$.length<1&&i.jsxDEV("div",{children:[i.jsxDEV(T,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:992,columnNumber:62},this),i.jsxDEV("div",{style:{marginTop:8},children:"Upload"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:992,columnNumber:85},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:992,columnNumber:57},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:984,columnNumber:29},this),$.length>0&&i.jsxDEV(n.Item,{label:"POSIÇÃO DO TEXTO EM RELAÇÃO À IMAGEM",style:{marginBottom:0},children:[i.jsxDEV(A.Group,{value:z,onChange:e=>W(e.target.value),children:[i.jsxDEV(A.Button,{value:"top",children:"TEXTO ANTES (MENSAGEM SEPARADA)"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:998,columnNumber:35},this),i.jsxDEV(A.Button,{value:"bottom",children:"TEXTO DEPOIS (LEGENDA)"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:999,columnNumber:35},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:997,columnNumber:33},this),i.jsxDEV("div",{style:{fontSize:10,color:"#999",marginTop:4},children:"top"===z?"Envia texto primeiro, depois imagem.":"Envia imagem com o texto como legenda."},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1001,columnNumber:33},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:996,columnNumber:31},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:983,columnNumber:27},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:982,columnNumber:25},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:932,columnNumber:23},this)},{key:"twilio",label:"TWILIO",children:i.jsxDEV("div",{children:[i.jsxDEV(n.Item,{label:"TIPO DE ENVIO",children:i.jsxDEV(A.Group,{value:k,onChange:e=>U(e.target.value),children:[i.jsxDEV(A.Button,{value:"nenhum",children:"MENSAGEM"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1018,columnNumber:29},this),i.jsxDEV(A.Button,{value:"sim_nao",children:"PERGUNTA SIM / NÃO"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1019,columnNumber:29},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1017,columnNumber:27},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1016,columnNumber:25},this),"sim_nao"===k&&i.jsxDEV(n.Item,{label:"PERGUNTA (SIM/NÃO)",children:i.jsxDEV(d,{value:F,onChange:e=>B(String(e?.target?.value||"").toUpperCase()),placeholder:"Ex: VOCÊ APOIA NOSSO PROJETO?"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1025,columnNumber:29},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1024,columnNumber:27},this),i.jsxDEV(n.Item,{name:"descricao",label:"DESCRIÇÃO / MENSAGEM",rules:[{whitespace:!0,message:"Mensagem inválida"}],extra:i.jsxDEV("div",{style:{fontSize:10,color:"#666"},children:["Dica: Use ",i.jsxDEV("strong",{children:"(NOME)"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1039,columnNumber:41},this)," ou ",i.jsxDEV("strong",{children:"{NOME}"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1039,columnNumber:68},this)," para substituir pelo nome do contato.",i.jsxDEV("br",{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1039,columnNumber:133},this),'Certifique-se que seu arquivo contém uma coluna chamada "Nome", "Name", "Cliente" ou "Full Name".']},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1038,columnNumber:29},this),children:i.jsxDEV(d.TextArea,{rows:4,placeholder:"Texto da mensagem que será enviada"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1044,columnNumber:27},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1033,columnNumber:25},this),i.jsxDEV(n.Item,{label:"IMAGEM DA MENSAGEM",children:i.jsxDEV("div",{style:{display:"flex",gap:16,alignItems:"flex-start"},children:i.jsxDEV(g,{listType:"picture-card",maxCount:1,fileList:$,onChange:({fileList:e})=>H(e),beforeUpload:()=>!1,accept:"image/*",children:$.length<1&&i.jsxDEV("div",{children:[i.jsxDEV(T,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1057,columnNumber:62},this),i.jsxDEV("div",{style:{marginTop:8},children:"Upload"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1057,columnNumber:85},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1057,columnNumber:57},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1049,columnNumber:29},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1048,columnNumber:27},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1047,columnNumber:25},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1015,columnNumber:23},this)}]},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:833,columnNumber:15},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:832,columnNumber:13},this),"meta"!==ie?i.jsxDEV(u,{title:"RECORRÊNCIA / BLOCOS",size:"small",style:{marginTop:16},children:[i.jsxDEV(n.Item,{name:"recorrencia_ativa",label:"ATIVAR RECORRÊNCIA",initialValue:!1,children:i.jsxDEV(A.Group,{value:q,onChange:e=>{G(!!e.target.value),y.setFieldsValue({recorrencia_ativa:!!e.target.value})},children:[i.jsxDEV(A.Button,{value:!1,children:"NÃO"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1078,columnNumber:21},this),i.jsxDEV(A.Button,{value:!0,children:"SIM"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1079,columnNumber:21},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1071,columnNumber:19},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1070,columnNumber:17},this),i.jsxDEV(h,{style:{display:"flex",marginBottom:8},align:"start",wrap:!0,children:[i.jsxDEV(n.Item,{name:"total_blocos",label:"TOTAL DE BLOCOS",rules:q?[{required:!0}]:void 0,children:i.jsxDEV(S,{min:1,max:999,style:{width:160}},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1085,columnNumber:21},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1084,columnNumber:19},this),i.jsxDEV(n.Item,{name:"mensagens_por_bloco",label:"MENSAGENS POR BLOCO",rules:q?[{required:!0}]:void 0,children:i.jsxDEV(S,{min:1,max:5e3,style:{width:200}},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1088,columnNumber:21},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1087,columnNumber:19},this),i.jsxDEV(n.Item,{name:"blocos_por_dia",label:"BLOCOS POR DIA",rules:q?[{required:!0}]:void 0,children:i.jsxDEV(S,{min:1,max:24,style:{width:160}},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1091,columnNumber:21},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1090,columnNumber:19},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1083,columnNumber:17},this),i.jsxDEV(h,{style:{display:"flex",marginBottom:8},align:"start",wrap:!0,children:[i.jsxDEV(n.Item,{name:"intervalo_min_seg",label:"INTERVALO MÍNIMO (SEG)",rules:[{required:!0}],children:i.jsxDEV(S,{min:1,max:3600,style:{width:200}},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1097,columnNumber:21},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1096,columnNumber:19},this),i.jsxDEV(n.Item,{name:"intervalo_max_seg",label:"INTERVALO MÁXIMO (SEG)",rules:[{required:!0}],children:i.jsxDEV(S,{min:1,max:3600,style:{width:200}},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1100,columnNumber:21},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1099,columnNumber:19},this),i.jsxDEV(n.Item,{name:"bloco_atual",label:"BLOCO ATUAL",children:i.jsxDEV(S,{min:0,max:999,style:{width:160}},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1103,columnNumber:21},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1102,columnNumber:19},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1095,columnNumber:17},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1069,columnNumber:15},this):null,i.jsxDEV(h,{style:{marginTop:16,display:"flex",justifyContent:"flex-end",width:"100%"},children:[i.jsxDEV(O,{onClick:j,icon:i.jsxDEV(R,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1110,columnNumber:48},this),children:"CANCELAR"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1110,columnNumber:15},this),i.jsxDEV(O,{type:"primary",onClick:async()=>{try{const a=await y.validateFields();if("sim_nao"===k&&!String(F||"").trim())return void _.error("Informe a pergunta (SIM/NÃO)");if("meta"!==ie){const e=Number(a.intervalo_min_seg),t=Number(a.intervalo_max_seg);if(!Number.isFinite(e)||!Number.isFinite(t)||e<=0||t<=0)return void _.error("Informe os intervalos mínimo e máximo em segundos");if(e>t)return void _.error("Intervalo mínimo não pode ser maior que o máximo")}const t=e=>new Promise((a,t)=>{const i=new FileReader;i.readAsDataURL(e),i.onload=()=>a(i.result),i.onerror=e=>t(e)}),i={...a,data_inicio:a.data_inicio?a.data_inicio.format("YYYY-MM-DD"):null,data_fim:a.data_fim?a.data_fim.format("YYYY-MM-DD"):null,meta:re,enviados:me,nao_enviados:ue,positivos:pe,negativos:Ne,aguardando:fe};if(delete i.meta_template_name,delete i.meta_template_lang,delete i.meta_template_preview_text,delete i.meta_p1,delete i.meta_p2,delete i.meta_p3,delete i.meta_p4,delete i.meta_p5,"meta"===ie&&(i.recorrencia_ativa=!1,i.total_blocos=5,i.mensagens_por_bloco=500,i.blocos_por_dia=1,i.bloco_atual=0,i.intervalo_min_seg=5,i.intervalo_max_seg=120),$.length>0){const e=$[0].originFileObj;e&&(i.imagem=await t(e))}else m?.imagem&&(i.imagem=null);let s=null;const o={text_position:z,provider:ie};if("sim_nao"===k&&(o.response_mode="SIM_NAO",o.question=String(F||"").trim()),"evolution"===ie&&ee.length&&(o.evolution_api_ids=ee),"meta"===ie){const e=String(a.meta_template_name||"").trim(),t=String(a.meta_template_lang||"").trim()||"pt_BR",i=String(a.meta_template_preview_text||"").trim(),s=[String(a.meta_p1||"").trim(),String(a.meta_p2||"").trim(),String(a.meta_p3||"").trim(),String(a.meta_p4||"").trim(),String(a.meta_p5||"").trim()];let n=s.length;for(;n>0&&!s[n-1];)n--;o.meta_template_name=e,o.meta_template_lang=t,o.meta_template_preview_text=i,o.meta_template_params=s.slice(0,n)}if("arquivo"===J&&I.length>0){const a=I[0].originFileObj;if(a&&(i.AnexoFile=a,i.anexo_json=JSON.stringify({contacts:[],config:o}),a.name.endsWith(".json"))){const t=await a.text();try{const e=Ue(t);if(!e)throw new Error("empty");const a=e=>String(e??"").replace(/\D/g,""),n=e=>{const t=[],i=new Set;for(const s of e){if(!s||"object"!=typeof s)continue;const e=Object.keys(s),o=e.find(e=>"whatsapp"===String(e).trim().toLowerCase())||e.find(e=>String(e).trim().toLowerCase().includes("whatsapp"))||e.find(e=>["celular","telefone","phone","mobile","tel"].includes(String(e).trim().toLowerCase())),n=o?s[o]:"",r=a(n);r&&(i.has(r)||(i.add(r),o&&(s[o]=r),t.push(s)))}return t};s={contacts:Array.isArray(e)?n(e):[],config:o},i.anexo_json=JSON.stringify(s)}catch(e){return void _.error("Arquivo JSON inválido. Garanta que o campo WHATSAPP esteja entre aspas.")}}}else"eleitores"===J&&(i.usar_eleitores=!0,s={source:"eleitores",usar_eleitores:!0,contacts:[],config:o},i.anexo_json=JSON.stringify(s));let n;if(m?.id)await oe.updateCampanha(m.id,i),n=m.id,_.success("Campanha atualizada");else{n=(await oe.createCampanha(i)).id,_.success("Campanha criada")}"arquivo"===J&&i.AnexoFile&&await oe.uploadCampanhaAnexo(n,{file:i.AnexoFile,type:"anexo"}),V()}catch(e){_.error(e?.response?.data?.detail||"Erro ao salvar campanha")}},icon:i.jsxDEV(D,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1111,columnNumber:63},this),children:"SALVAR"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1111,columnNumber:15},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1109,columnNumber:13},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:760,columnNumber:11},this),i.jsxDEV("div",{style:{width:372,flex:"none",position:"sticky",top:8,display:"grid",gap:16},children:[i.jsxDEV(u,{title:"PREVIEW",size:"small",children:i.jsxDEV("div",{style:{width:312,margin:"0 auto"},children:i.jsxDEV("div",{style:{background:"#111",borderRadius:26,padding:10},children:i.jsxDEV("div",{style:{background:"#f5f5f5",borderRadius:20,overflow:"hidden"},children:[i.jsxDEV("div",{style:{background:"#eaeaea",padding:"10px 12px",fontSize:12,fontWeight:700},children:"WhatsApp"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1120,columnNumber:21},this),i.jsxDEV("div",{style:{padding:12,minHeight:420,background:"#f0f2f5"},children:i.jsxDEV("div",{style:{maxWidth:250,background:"#fff",borderRadius:12,padding:10,boxShadow:"0 1px 2px rgba(0,0,0,0.08)"},children:[ze?i.jsxDEV("img",{src:ze,style:{width:"100%",borderRadius:10,marginBottom:8}},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1126,columnNumber:27},this):null,i.jsxDEV("div",{style:{fontSize:13,lineHeight:1.35,whiteSpace:"pre-wrap",color:"#1f1f1f"},children:We},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1128,columnNumber:25},this),i.jsxDEV("div",{style:{fontSize:10,color:"#999",marginTop:6,textAlign:"right"},children:String(Re||"pt_BR").trim()||"pt_BR"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1131,columnNumber:25},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1124,columnNumber:23},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1123,columnNumber:21},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1119,columnNumber:19},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1118,columnNumber:17},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1117,columnNumber:15},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1116,columnNumber:13},this),i.jsxDEV(u,{title:"LISTA",size:"small",children:"arquivo"===J?xe.length>0?i.jsxDEV(v,{size:"small",dataSource:xe,renderItem:(e,a)=>{const t=String(e?.nome||"").trim(),s=String(e?.whatsapp||"").trim();return i.jsxDEV(v.Item,{style:{padding:"6px 0",borderBottom:"2px solid #b7eb8f"},children:i.jsxDEV("div",{style:{display:"flex",justifyContent:"space-between",width:"100%",gap:10},children:[i.jsxDEV("div",{style:{minWidth:0,fontWeight:600,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t||"SEM NOME"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1153,columnNumber:29},this),i.jsxDEV("div",{style:{fontFamily:"monospace",color:"#3f8600",flex:"none"},children:s?`+${s}`:"--"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1156,columnNumber:29},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1152,columnNumber:27},this)},`${s}-${a}`,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1151,columnNumber:25},this)}},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1144,columnNumber:19},this):i.jsxDEV("div",{style:{color:"#999",fontSize:12},children:"Selecione um arquivo (JSON/CSV) para visualizar contatos."},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1165,columnNumber:19},this):i.jsxDEV("div",{style:{color:"#999",fontSize:12},children:"Prévia disponível ao importar arquivo de contatos."},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1168,columnNumber:17},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1141,columnNumber:13},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:1115,columnNumber:11},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:759,columnNumber:9},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:758,columnNumber:7},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:717,columnNumber:5},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/components/CampanhasModal.tsx",lineNumber:715,columnNumber:5},this)}const ie=l??m;function se(){const[t,s]=o.useState([]),[n,r]=o.useState(!1),[l,m]=o.useState(!1),[c,d]=o.useState(null),[p,N]=o.useState([]),[A,b]=o.useState({}),[g,x]=o.useState([]),[E,T]=o.useState([]),[S,R]=o.useState([]),[D,P]=o.useState([]),[K,Z]=o.useState([]),[Q,ae]=o.useState(null),[se,oe]=o.useState(null),ne=e(),{user:re}=a(),{message:le,modal:me}=j.useApp(),ce=e=>{const a=String(e||"").trim();if(!a)return"";if(/^data:image\//i.test(a)&&/;base64,/i.test(a)){const e=a.split(/;base64,/i)[1]?.trim()||"";return e.startsWith("/")||e.startsWith("http://")||e.startsWith("https://")||e.startsWith("static/")?e.startsWith("static/")?`/${e}`:e:a}return a.startsWith("data:")||a.startsWith("http://")||a.startsWith("https://")||a.startsWith("/static/")?a:a.startsWith("static/")?`/${a}`:a.startsWith("/")?a:/\.(png|jpg|jpeg|bmp|gif|webp)$/i.test(a)?`/static/campanhas/${a}`:a.includes("/")&&!a.startsWith("/")?`/${a}`:`data:image/png;base64,${a}`},ue=o.useMemo(()=>1!==E.length?null:t.find(e=>e.id===E[0]),[E,t]),de=o.useMemo(()=>{const e=ue?.conteudo_arquivo;if(!e)return{};try{const a="string"==typeof e?JSON.parse(e):e;if(a&&"object"==typeof a&&!Array.isArray(a)){const e=a.config;if(e&&"object"==typeof e)return e}}catch{}return{}},[ne,ue?.id,ue?.conteudo_arquivo]),pe=o.useMemo(()=>{const e=de||{},a=String(e?.provider||"").trim().toLowerCase();return"twilio"===a?"twilio":"meta"===a?"meta":"evolution"},[de]),he=o.useMemo(()=>{if(!ue?.id)return null;return`campanhas.eventLogs.${String(re?.usuario||"default")}.${Number(ue.id)}`},[ue?.id,re?.usuario]);o.useEffect(()=>{if(he){try{const e=localStorage.getItem(he);if(e){const a=JSON.parse(e);if(Array.isArray(a))return void R(a.map(e=>String(e)))}}catch{}R([`[${ie().format("HH:mm:ss")}] Sistema pronto. Aguardando início do disparo.`])}else R([])},[he]),o.useEffect(()=>{if(he)try{localStorage.setItem(he,JSON.stringify((S||[]).slice(-2e3)))}catch{}},[he,S]);const Ne=o.useCallback(async()=>{try{const e=await ne.listEvolutionInstances();Z(e?.rows||[])}catch{Z([])}},[ne]);o.useEffect(()=>{Ne()},[Ne]),o.useEffect(()=>{(async()=>{try{const e=await ne.getTwilioConfig();oe(e||null)}catch{oe(null)}})()},[ne]);const Ae=o.useMemo(()=>{const e=de||{},a=e.evolution_api_ids??e.evolution_api_id,t=(Array.isArray(a)?a:null!=a?[a]:[]).map(e=>String(e??"").trim()).filter(e=>!!e),i=K||[];if(!t.length)return i;const s=new Set(t),o=i.filter(e=>s.has(String(e?.id??"").trim()));return o.length?o:i},[K,de]);o.useEffect(()=>{if(!ue)return void ae(null);if(!Ae.length)return void ae(null);const e=Q;if("ALL"===e)return;if("string"==typeof e&&Ae.some(a=>String(a?.id??"").trim()===e))return;const a=Ae.find(e=>"CONNECTED"===String(e?.connectionStatus||"").toUpperCase());ae(String((a||Ae[0])?.id??"").trim()||null)},[Ae,ue?.id,Q,ue]),o.useEffect(()=>{if(ue){let a=[];const t=e=>{const a=String(e??"").trim();if(!a)return null;if("1"===a||"2"===a)return Number(a);const t=a.toLowerCase();return/\bsim\b/.test(t)||"s"===t?1:/\bnao\b/.test(t)||/\bnão\b/.test(t)||"n"===t?2:/^\(?\s*1\b/.test(t)?1:/^\(?\s*2\b/.test(t)?2:null},i=e=>{if(!0===e||!1===e)return e;const a=String(e??"").trim().toLowerCase();return a?"true"===a||"1"===a||"sim"===a||"s"===a||"valido"===a||"válido"===a||"false"!==a&&"0"!==a&&"nao"!==a&&"não"!==a&&"n"!==a&&"invalido"!==a&&"inválido"!==a&&null:null},s=(e,a)=>{if(!e)return"";const t=Object.keys(e);for(const i of a){const a=t.find(e=>e.trim().toLowerCase()===i.trim().toLowerCase());if(a){const t=e[a];if(null==t)continue;if("string"==typeof t&&!t.trim())continue;return t}}return""};if(ue.conteudo_arquivo)try{const e=JSON.parse(ue.conteudo_arquivo);if(Array.isArray(e)?a=e:e.contacts&&Array.isArray(e.contacts)&&(a=e.contacts),a.length>0){a=a.map((e,a)=>{const o=s(e,["whatsapp","celular","telefone","phone","mobile","tel"]),n=s(e,["nome","name","cliente","full_name","fullname"])||`Contato ${a+1}`,r=s(e,["resposta","response","respondido","reply"]),l=t(r),m=i(s(e,["is_whatsapp","isWhatsapp","whatsapp_valido","whatsappValido"])),c=s(e,["whatsapp_jid","whatsappJid","jid"]);return{id:a,nome:n,whatsapp:o,status:e.status||"waiting",resposta:l,is_whatsapp:null===m?void 0:m,whatsapp_jid:c?String(c):void 0,original:e}}).filter(e=>e.whatsapp);const e=e=>String(e??"").replace(/\D/g,""),o=new Map;for(const t of a){const a=e(t.whatsapp);a&&o.set(a,(o.get(a)||0)+1)}const n=new Set;let r=0,l=0;for(const a of o.values())a>1&&(l++,r+=a-1);a=a.map(a=>({...a,whatsapp:e(a.whatsapp)})).filter(e=>!!String(e.whatsapp||"").trim()).filter(e=>{const a=String(e.whatsapp);return!!a&&(!n.has(a)&&(n.add(a),!0))}),(l>0||r>0)&&R(e=>[...e,`[${ie().format("HH:mm:ss")}] LISTA: ${l} número(s) repetido(s), ${r} registro(s) não entrarão. Válidos: ${a.length}.`]),0===a.length&&R(e=>[...e,`[${ie().format("HH:mm:ss")}] ERRO: Nenhum contato com 'whatsapp' encontrado.`])}}catch(e){console.error("Erro ao fazer parse do conteudo_arquivo",e),R(e=>[...e,`[${ie().format("HH:mm:ss")}] ERRO: Não foi possível ler o arquivo de contatos.`])}else ue.usar_eleitores&&(R(e=>[...e,`[${ie().format("HH:mm:ss")}] INFO: Esta campanha utiliza a base de Eleitores. Visualização individual não carregada para performance.`]),a=[]);0!==a.length||ue.usar_eleitores||R(e=>[...e,`[${ie().format("HH:mm:ss")}] AVISO: Nenhum contato válido encontrado no arquivo.`]),P(a);let o=!1;return(async()=>{try{if(!a.length)return;const e=e=>String(e??"").replace(/\D/g,""),t=Array.from(new Set(a.map(a=>e(a.whatsapp)).filter(Boolean)));if(!t.length)return;const[i,s]=await Promise.allSettled([ne.whatsappCheckNumbers({numbers:t}),ne.whatsappPresenceCache({numbers:t})]),n=new Map;if("fulfilled"===i.status)for(const a of i.value?.rows||[]){const t=e(a.number);t&&n.set(t,{is_whatsapp:!!a.is_whatsapp,jid:a.jid??null})}const r=new Map;if("fulfilled"===s.status)for(const a of s.value?.rows||[]){const t=e(a.number);if(!t)continue;const i=a.presence;r.set(t,i?String(i):null)}if(o)return;P(a=>a.map(a=>{const t=e(a.whatsapp),i=n.get(t),s=r.get(t),o={...a.original||{}};return i&&(o.is_whatsapp=i.is_whatsapp,o.whatsapp_jid=i.jid??null),{...a,is_whatsapp:i?i.is_whatsapp:a.is_whatsapp,whatsapp_jid:i?i.jid??null:a.whatsapp_jid,presence:void 0!==s?s:a.presence,original:o}}))}catch{}})(),()=>{o=!0}}P([])},[ne,ue?.id,ue?.conteudo_arquivo]);const fe=o.useMemo(()=>{if(!ue)return!1;const e=ue.data_inicio,a=ue.data_fim;if(!e)return!1;const t=ie(),i=ie(e),s=ie(a||"2100-01-01");return t.isAfter(i.startOf("day"))&&t.isBefore(s.endOf("day"))||t.isSame(i,"day")||t.isSame(s,"day")},[ue]),be=o.useMemo(()=>{if(!ue)return!1;return"SIM_NAO"===String((de||{}).response_mode||"").toUpperCase()},[ue,de]),ge=()=>i.jsxDEV("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[i.jsxDEV("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z",fill:"currentColor"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:918,columnNumber:65},this),i.jsxDEV("path",{d:"M20.71 7.04a1 1 0 0 0 0-1.41l-2.34-2.34a1 1 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z",fill:"currentColor"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:918,columnNumber:144},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:918,columnNumber:5},this),Oe=()=>i.jsxDEV("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:i.jsxDEV("path",{d:"M6 7h12M9 7v10m6-10v10M4 7h16l-1 14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2L4 7z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:921,columnNumber:65},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:921,columnNumber:5},this),xe=()=>i.jsxDEV("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:i.jsxDEV("path",{d:"M3 4h6v16H3V4zm12 0h6v16h-6V4z",fill:"currentColor"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:924,columnNumber:65},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:924,columnNumber:5},this),Ee=()=>i.jsxDEV("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:i.jsxDEV("path",{d:"M12 5v14M5 12h14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:928,columnNumber:7},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:927,columnNumber:5},this),Ce=e=>{if(!e)return{label:"-",color:"default"};const a=ie().startOf("day"),t=e.data_inicio?ie(e.data_inicio).startOf("day"):null,i=e.data_fim?ie(e.data_fim).endOf("day"):null;let s=!1;const o=e.status;return!0!==o&&"true"!==o&&"TRUE"!==o&&"1"!==o&&1!==o&&"ATIVO"!==String(o).toUpperCase()||(s=!0),!1!==o&&"false"!==o&&"FALSE"!==o&&"0"!==o&&0!==o&&"INATIVO"!==String(o).toUpperCase()||(s=!1),s?t&&a.isBefore(t)?{label:"AGENDADO",color:"blue"}:i&&a.isAfter(i)?{label:"INATIVO",color:"red"}:{label:"ATIVO",color:"green"}:{label:"INATIVO",color:"red"}},Te=o.useCallback(async e=>{try{r(!0);if(e?.refreshSchema??0===p.length){const e=await ne.getCampanhasSchema(),a=["id","nome","status","meta","enviados","entregues","visualizados","aguardando","data_inicio","data_fim","created_at"],t={};for(const p of e.columns||[])t[p.name]=p;const i=a.filter(e=>t[e]).map(e=>t[e]),s=(e.columns||[]).filter(e=>!a.includes(e.name));N([...i,...s]);const o={};for(const p of a)t[p]&&(o[p]=!0);for(const p of s)o[p.name]=!1;const n=`campanhas.columns.visible.${re?.usuario||"default"}`,r=localStorage.getItem(n),l=(()=>{try{return r?JSON.parse(r):null}catch{return null}})();b(l?{...o,...l}:o);const m=`campanhas.columns.order.${re?.usuario||"default"}`,c=localStorage.getItem(m),u=(()=>{try{return c?JSON.parse(c):null}catch{return null}})(),d=a.filter(e=>t[e]);if(Array.isArray(u)){const e=u.filter(e=>"string"==typeof e&&t[String(e)]),a=new Set(e);for(const t of d)a.has(t)||e.push(t);x(e)}else x(d)}const a=(await ne.getCampanhas()).rows||[];s(a)}catch(a){le.error(a?.response?.data?.detail||"Erro ao carregar campanhas")}finally{r(!1)}},[ne,p.length,le,re]);o.useEffect(()=>{Te({refreshSchema:!0})},[Te]),o.useEffect(()=>{if(!ue||!be)return;const e=globalThis.setInterval(async()=>{"undefined"!=typeof document&&"hidden"===document.visibilityState||await Te({refreshSchema:!1})},15e3);return()=>globalThis.clearInterval(e)},[be,Te,ue?.id]);const Se=p.map(e=>{const a=e.name,s=Array.from(new Set((t||[]).map(e=>e[a]).filter(e=>null!=e))).slice(0,20).map(e=>({text:String(e).toUpperCase(),value:String(e).toUpperCase()})),o=(e.type||"").toLowerCase(),n=new Set(["id","status","meta","enviados","entregues","visualizados","nao_enviados","positivos","negativos","aguardando","data_inicio","data_fim","created_at"]);return{title:{id:"ID",nome:"NOME DA CAMPANHA",descricao:"DESCRIÇÃO",status:"STATUS",data_inicio:"INÍCIO",data_fim:"FIM",meta:"META",enviados:"ENVIADOS",entregues:"ENTREGUES",visualizados:"VISUALIZADOS",nao_enviados:"NÃO ENVIADOS",positivos:"RESPOSTAS POSITIVAS",negativos:"RESPOSTAS NEGATIVAS",aguardando:"AGUARDANDO RESPOSTAS",created_at:"CRIADO EM"}[a]||a.toUpperCase(),dataIndex:a,align:n.has(a)?"center":"left",filters:s,onFilter:(e,t)=>String(t[a]).toUpperCase()===String(e).toUpperCase(),sorter:(e,t)=>{const i=e[a],s=t[a];return null==i?-1:null==s?1:o.includes("int")||o.includes("numeric")||o.includes("decimal")?Number(i)-Number(s):o.includes("date")||o.includes("timestamp")?new Date(i).getTime()-new Date(s).getTime():String(i).toUpperCase().localeCompare(String(s).toUpperCase())},render:(e,t)=>{if(null==e)return"";if(o.includes("date")||o.includes("timestamp")){const a=new Date(e);if(!isNaN(a.getTime()))return a.toLocaleDateString("pt-BR")}if("status"===a){const{label:e,color:a}=Ce(t);return i.jsxDEV(V,{color:a,children:e},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1094,columnNumber:21},this)}return String(e).toUpperCase()},onHeaderCell:()=>({draggable:!0,onDragStart:e=>{e.dataTransfer.setData("text/plain",a)},onDragOver:e=>{e.preventDefault()},onDrop:e=>{const t=e.dataTransfer.getData("text/plain"),i=a;t&&t!==i&&x(e=>{const a=e.filter(e=>e!==t),s=a.indexOf(i);if(-1===s)return e;a.splice(s,0,t);const o=`campanhas.columns.order.${re?.usuario||"default"}`;return localStorage.setItem(o,JSON.stringify(a)),a})}})}}),Re={title:"AÇÕES",dataIndex:"__actions__",align:"center",render:(e,a)=>i.jsxDEV(h,{children:[i.jsxDEV(O,{type:"text",icon:i.jsxDEV(ge,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1126,columnNumber:35},this),title:"EDITAR",onClick:()=>{d(a),m(!0)}},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1126,columnNumber:9},this),i.jsxDEV(O,{type:"text",danger:!0,icon:i.jsxDEV(Oe,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1127,columnNumber:42},this),title:"DELETAR",onClick:async()=>{try{if(!a.id)return void le.info("REGISTRO SEM ID");await ne.deleteCampanha(a.id),le.success("CAMPANHA DELETADA"),await Te()}catch(e){le.error(e?.response?.data?.detail||"ERRO AO DELETAR CAMPANHA")}}},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1127,columnNumber:9},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1125,columnNumber:7},this)},De=(g.length?g:Se.map(e=>e.dataIndex)).map(e=>Se.find(a=>a.dataIndex===e)).filter(Boolean).filter(e=>A[e.dataIndex]).concat([Re]),ve=i.jsxDEV("div",{style:{padding:12},children:p.map(e=>i.jsxDEV("div",{style:{marginBottom:6},children:i.jsxDEV(y,{checked:!!A[e.name],onChange:a=>{const t={...A,[e.name]:a.target.checked};b(t);const i=`campanhas.columns.visible.${re?.usuario||"default"}`;localStorage.setItem(i,JSON.stringify(t))},children:e.name.toUpperCase()},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1152,columnNumber:11},this)},e.name,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1151,columnNumber:9},this))},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1149,columnNumber:5},this);return i.jsxDEV(ee.div,{className:"page-container",initial:{opacity:0,y:6},animate:{opacity:1,y:0},transition:{duration:.3},children:[i.jsxDEV(u,{size:"small",style:{marginBottom:16,background:"#fafafa"},styles:{body:{padding:"12px"}},children:i.jsxDEV(_,{gutter:16,align:"middle",children:[i.jsxDEV(M,{span:16,children:i.jsxDEV(_,{gutter:8,wrap:!1,children:[i.jsxDEV(M,{flex:"1",children:i.jsxDEV(u,{size:"small",style:{textAlign:"center",background:"#f0f5ff",borderColor:"#adc6ff"},children:i.jsxDEV(J,{title:"META",value:ue?.meta||0,valueStyle:{color:"#2f54eb",fontSize:"18px"},prefix:i.jsxDEV(f,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1176,columnNumber:149},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1176,columnNumber:29},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1175,columnNumber:25},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1174,columnNumber:21},this),i.jsxDEV(M,{flex:"1",children:i.jsxDEV(u,{size:"small",style:{textAlign:"center",background:"#fff0f6",borderColor:"#ffadd2"},children:i.jsxDEV(J,{title:"DISPAROS",value:(ue?.enviados||0)+(ue?.nao_enviados||0),valueStyle:{color:"#eb2f96",fontSize:"18px"},prefix:i.jsxDEV(w,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1181,columnNumber:199},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1181,columnNumber:29},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1180,columnNumber:25},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1179,columnNumber:21},this),i.jsxDEV(M,{flex:"1",children:i.jsxDEV(u,{size:"small",style:{textAlign:"center",background:"#f6ffed",borderColor:"#b7eb8f"},children:i.jsxDEV(J,{title:"ENVIADOS",value:ue?.enviados||0,valueStyle:{color:"#3f8600",fontSize:"18px"},prefix:i.jsxDEV(I,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1186,columnNumber:157},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1186,columnNumber:29},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1185,columnNumber:25},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1184,columnNumber:21},this),i.jsxDEV(M,{flex:"1",children:i.jsxDEV(u,{size:"small",style:{textAlign:"center",background:"#fff1f0",borderColor:"#ffa39e"},children:i.jsxDEV(J,{title:"NÃO ENV.",value:ue?.nao_enviados||0,valueStyle:{color:"#cf1322",fontSize:"18px"},prefix:i.jsxDEV(L,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1191,columnNumber:161},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1191,columnNumber:29},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1190,columnNumber:25},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1189,columnNumber:21},this),i.jsxDEV(M,{flex:"1",children:i.jsxDEV(u,{size:"small",style:{textAlign:"center",background:"#e6f7ff",borderColor:"#91d5ff"},children:i.jsxDEV(J,{title:"RESPOSTAS POSITIVAS",value:ue?.positivos||0,valueStyle:{color:"#096dd9",fontSize:"18px"}},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1196,columnNumber:29},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1195,columnNumber:25},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1194,columnNumber:21},this),i.jsxDEV(M,{flex:"1",children:i.jsxDEV(u,{size:"small",style:{textAlign:"center",background:"#fffbe6",borderColor:"#ffe58f"},children:i.jsxDEV(J,{title:"RESPOSTAS NEGATIVAS",value:ue?.negativos||0,valueStyle:{color:"#d48806",fontSize:"18px"}},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1201,columnNumber:29},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1200,columnNumber:25},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1199,columnNumber:21},this),i.jsxDEV(M,{flex:"1",children:i.jsxDEV(u,{size:"small",style:{textAlign:"center",background:"#f9f0ff",borderColor:"#d3adf7"},children:i.jsxDEV(J,{title:"AGUARDANDO RESPOSTAS",value:be&&ue?.aguardando||0,valueStyle:{color:"#722ed1",fontSize:"18px"},prefix:i.jsxDEV($,{spin:be&&(ue?.aguardando||0)>0},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1206,columnNumber:202},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1206,columnNumber:29},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1205,columnNumber:25},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1204,columnNumber:21},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1173,columnNumber:17},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1172,columnNumber:14},this),i.jsxDEV(M,{span:8,style:{display:"flex",alignItems:"center",justifyContent:"space-between",borderLeft:"1px solid #e8e8e8",paddingLeft:16},children:[i.jsxDEV("div",{style:{display:"flex",alignItems:"center",gap:16},children:[ue?.imagem?i.jsxDEV(H,{src:ce(ue.imagem),height:60,width:60,style:{objectFit:"cover",borderRadius:4},alt:"Campanha"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1214,columnNumber:26},this):i.jsxDEV("div",{style:{width:60,height:60,background:"#eee",borderRadius:4,display:"flex",alignItems:"center",justifyContent:"center",color:"#999"},children:i.jsxDEV(z,{style:{fontSize:24}},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1223,columnNumber:30},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1222,columnNumber:26},this),i.jsxDEV("div",{style:{fontSize:12,color:"#666"},children:ue?i.jsxDEV(i.Fragment,{children:[i.jsxDEV("strong",{children:ue.nome},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1229,columnNumber:33},this),i.jsxDEV("br",{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1229,columnNumber:73},this),i.jsxDEV("span",{style:{fontSize:10},children:(()=>{const e=Ce(ue);return i.jsxDEV(V,{color:e.color,style:{margin:0},children:e.label},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1233,columnNumber:48},this)})()},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1230,columnNumber:33},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1228,columnNumber:30},this):i.jsxDEV("span",{children:"Selecione uma campanha"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1237,columnNumber:30},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1226,columnNumber:22},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1212,columnNumber:18},this),i.jsxDEV("div",{style:{display:"flex",gap:8},children:["twilio"===pe?i.jsxDEV(C,{value:"TWILIO",placeholder:"Número Twilio",style:{minWidth:220},disabled:!0,options:[{value:"TWILIO",label:`Twilio - ${String(se?.whatsapp_from||"").trim()||"WhatsApp From não configurado"}`}]},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1243,columnNumber:24},this):"meta"===pe?i.jsxDEV(C,{value:"META",placeholder:"Meta Cloud API",style:{minWidth:220},disabled:!0,options:[{value:"META",label:"Meta Cloud API"}]},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1256,columnNumber:24},this):i.jsxDEV(C,{value:Q??void 0,placeholder:"Instância Evolution",style:{minWidth:220},disabled:!ue||!Ae.length,options:[{value:"ALL",label:"TODAS AS INSTÂNCIAS (ALTERNAR)"},...(Ae||[]).map(e=>{const a=String(e?.connectionStatus||"").toUpperCase(),t=String(e?.name||e?.nome||e?.id),i=String(e?.number||"").trim(),s=`${t}${i?` - ${i}`:""}${a?` (${a})`:""}`;return{value:String(e?.id??"").trim(),label:s}})],onChange:e=>{ae("ALL"===e?"ALL":(e?String(e).trim():null)||null)},allowClear:!0},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1269,columnNumber:24},this),i.jsxDEV(W,{title:"Atualizar dados e respostas da campanha",children:i.jsxDEV(O,{onClick:async()=>{if(ue){le.loading({content:"Atualizando...",key:"refresh"});try{await Te({refreshSchema:!0}),le.success({content:"Atualizado!",key:"refresh"})}catch{le.error({content:"Erro ao atualizar",key:"refresh"})}}},disabled:!ue,icon:i.jsxDEV($,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1295,columnNumber:35},this),children:"ATUALIZAR"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1292,columnNumber:26},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1291,columnNumber:22},this),i.jsxDEV(W,{title:"Resetar todos os contatos e contadores",children:i.jsxDEV(O,{onClick:()=>{ue&&me.confirm({title:"RESETAR CAMPANHA",content:'Deseja realmente resetar esta campanha? Todos os contatos voltarão para o status "Aguardando" e os contadores serão zerados (exceto META).',okText:"SIM, RESETAR",cancelText:"CANCELAR",onOk:async()=>{le.loading({content:"Resetando campanha...",key:"reset"});try{await ne.resetCampanhaDisparos(ue.id);const a=D.map(e=>{const a={...e.original,status:"waiting"};return a&&(delete a.resposta,delete a.response,delete a.respondido_em,delete a.respondidoEm,delete a.enviado_em,delete a.enviadoEm),{...e,status:"waiting",original:a}}),t={enviados:0,nao_enviados:0,positivos:0,negativos:0,aguardando:0};let i=a.map(e=>e.original);if(ue.conteudo_arquivo)try{const e=JSON.parse(ue.conteudo_arquivo);!Array.isArray(e)&&e.contacts&&(i={...e,contacts:i})}catch(e){}await ne.updateCampanha(ue.id,{...t,anexo_json:i,status:"ATIVO"}),P(a),s(e=>e.map(e=>e.id===ue.id?{...e,...t,status:"ATIVO"}:e));try{he&&localStorage.removeItem(he)}catch{}R([`[${ie().format("HH:mm:ss")}] Sistema pronto. Aguardando início do disparo.`,`[${ie().format("HH:mm:ss")}] CAMPANHA RESETADA.`]),le.success({content:"Campanha resetada com sucesso!",key:"reset"}),await Te()}catch(e){console.error(e),le.error({content:"Erro ao resetar campanha",key:"reset"})}}})},disabled:!ue,icon:i.jsxDEV(k,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1304,columnNumber:35},this),danger:!0,children:"RESETAR"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1301,columnNumber:26},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1300,columnNumber:22},this),i.jsxDEV(W,{title:ue?fe?"Iniciar automação":"Fora do período de vigência":"Selecione uma campanha",children:i.jsxDEV(O,{onClick:async()=>{if(ue){le.loading({content:"Iniciando automação...",key:"envio"}),R(e=>[...e,`[${ie().format("HH:mm:ss")}] INICIANDO DISPARO DA CAMPANHA: ${ue.nome}`]);try{const t=(()=>de||{})(),i=String(t?.provider||"").trim().toLowerCase(),o="twilio"===i?"twilio":"meta"===i?"meta":"evolution";R(e=>[...e,`[${ie().format("HH:mm:ss")}] Provedor selecionado: ${"twilio"===o?"Twilio":"meta"===o?"Meta Cloud API":"EvolutionAPI"}.`]);const n=D.filter(e=>"success"!==e.status);R(e=>[...e,`[${ie().format("HH:mm:ss")}] Iniciando envio para ${n.length} contatos.`]);let r=[...D],l=0,m=0,c=0;const u=ue.imagem?ce(ue.imagem):void 0,d="SIM_NAO"===String(t.response_mode||"").toUpperCase(),p=String(t.meta_template_name||"").trim(),h=String(t.meta_template_lang||"").trim()||"pt_BR",N=Array.isArray(t.meta_template_params)?t.meta_template_params:[],A=(()=>{const e=t.evolution_api_ids??t.evolution_api_id;return(Array.isArray(e)?e:null!=e?[e]:[]).map(e=>String(e??"").trim()).filter(e=>!!e)})(),f=Math.max(0,(ue.enviados||0)-((ue.positivos||0)+(ue.negativos||0))),b=d?void 0!==ue.aguardando&&null!==ue.aguardando?Number(ue.aguardando||0):f:0,g=!!ue.recorrencia_ativa,O=Number(ue.total_blocos??5),x=Number(ue.mensagens_por_bloco??500),E=Number(ue.blocos_por_dia??1);let C=Number(ue.bloco_atual??0);const T=Number(ue.intervalo_min_seg??5),S=Number(ue.intervalo_max_seg??120),v=Math.max(1,Math.min(T,S)),j=Math.max(1,Math.max(T,S)),V=g?Math.max(1,Math.floor(x)):Number.POSITIVE_INFINITY;if(g&&Number.isFinite(O)&&C>=O)return R(e=>[...e,`[${ie().format("HH:mm:ss")}] RECORRÊNCIA ENCERRADA: blocos concluídos (${C}/${O}).`]),void le.warning({content:"Recorrência já concluiu todos os blocos.",key:"envio"});g&&R(e=>[...e,`[${ie().format("HH:mm:ss")}] RECORRÊNCIA ATIVA: bloco ${C+1}/${O}, até ${V} mensagens, intervalo ${v}s-${j}s.`]);let y=0,_=0,M=null;const J=(()=>{if("ALL"!==Q)return[];const e=Ae||[],a=e.filter(e=>"CONNECTED"===String(e?.connectionStatus||"").toUpperCase());return(a.length?a:e).filter(e=>!!String(e?.id??"").trim())})(),w=e=>String(e??"").replace(/\D/g,""),I=(e,a)=>{let t=String(e??"");const i=String(a?.nome||""),s=String(a?.whatsapp||""),o=w(s)||s;return t=t.replace(/\(NOME\)/gi,i).replace(/\{NOME\}/gi,i).replace(/\(NAME\)/gi,i).replace(/\{NAME\}/gi,i).replace(/\(WHATSAPP\)/gi,o).replace(/\{WHATSAPP\}/gi,o).replace(/\(PHONE\)/gi,o).replace(/\{PHONE\}/gi,o),t},L=e=>{const a=String(e||"").trim().toLowerCase();return a?"image/jpeg"===a||"image/jpg"===a?".jpg":"image/png"===a?".png":"image/webp"===a?".webp":"image/gif"===a?".gif":"application/pdf"===a?".pdf":"audio/mpeg"===a?".mp3":"audio/wav"===a?".wav":"video/mp4"===a?".mp4":".bin":".bin"},$=(e,a)=>{const t=String(e||"").match(/^data:([^;]+);base64,(.+)$/i);if(!t)return null;const i=t[1],s=t[2],o=globalThis?.atob;if(!o)return null;const n=o(s),r=n.length,l=new Uint8Array(r);for(let u=0;u<r;u++)l[u]=n.charCodeAt(u);const m=L(i),c=a.toLowerCase().endsWith(m)?a:`${a}${m}`;return new File([l],c,{type:i})};let H,z,W;if("twilio"===o&&u)try{const e=String(u||"").trim();if(e.startsWith("data:")){const a=$(e,`campanha_${String(ue.id||"0")}`);if(a){R(e=>[...e,`[${ie().format("HH:mm:ss")}] Enviando mídia da campanha para URL pública (Twilio)...`]);const e=await ne.uploadTwilioMedia(a);e?.url&&(H=[String(e.url)])}}else e&&(H=[e])}catch{H=void 0}if("meta"===o&&u)try{const e=String(u||"").trim();if(e.startsWith("data:")){const a=$(e,`campanha_${String(ue.id||"0")}`);if(a){R(e=>[...e,`[${ie().format("HH:mm:ss")}] Enviando mídia da campanha para a Meta (upload)...`]);const e=await ne.uploadMetaWhatsAppMedia(a);e?.id&&(z=String(e.id))}}else e&&(W=e)}catch{z=void 0,W=void 0}if("evolution"===o)try{const e=Array.from(new Set(r.filter(e=>"boolean"!=typeof e.is_whatsapp).map(e=>w(e.whatsapp)).filter(Boolean)));if(e.length){R(a=>[...a,`[${ie().format("HH:mm:ss")}] Validando números no WhatsApp (${e.length})...`]);const a="string"==typeof Q&&Q&&"ALL"!==Q?Q:void 0,t=await ne.whatsappCheckNumbers({numbers:e,evolution_api_id:a}),i=new Map;for(const e of t?.rows||[]){const a=w(e.number);a&&i.set(a,{is_whatsapp:!!e.is_whatsapp,jid:e.jid??null})}r=r.map(e=>{const a=w(e.whatsapp),t=i.get(a);return t?{...e,is_whatsapp:t.is_whatsapp,whatsapp_jid:t.jid??null,original:{...e.original||{},is_whatsapp:t.is_whatsapp,whatsapp_jid:t.jid??null}}:e}),P([...r])}}catch{}for(let a=0;a<r.length&&!(y>=V);a++){const i=r[a];if("success"===i.status)continue;y++;const n=_;_++,R(e=>[...e,`[${ie().format("HH:mm:ss")}] Enviando mensagem para ${i.nome} (${i.whatsapp})...`]);const f=i.status;let g=!1,O="";if("evolution"===o&&!1===i.is_whatsapp)g=!1,O="Número não possui WhatsApp";else try{let e=String(ue.descricao??"");const a=i.nome||"";e=e.replace(/\(NOME\)/gi,a).replace(/\{NOME\}/gi,a).replace(/\(NAME\)/gi,a).replace(/\{NAME\}/gi,a),0===n&&R(a=>[...a,`[${ie().format("HH:mm:ss")}] DEBUG: Exemplo de mensagem resolvida: "${e}"`]);const s="meta"===o&&!!p;if(d){const a=String(t.question||"").trim(),i=[e.trim()];a&&i.push(a),i.push("RESPONDA:\n1 - SIM\n2 - NÃO"),e=i.filter(Boolean).join("\n\n")}let r=t.text_position||"bottom";if(!s&&!e.trim()&&!u)throw new Error("Mensagem vazia");if("twilio"===o){const a=w(i.whatsapp),t=a?`whatsapp:+${a}`:String(i.whatsapp||"").trim(),s=e.trim()?e:".";await ne.sendTwilio({to:t,body:s,media_urls:H,campanha_id:Number(ue.id),contato_nome:String(i.nome||"")})}else if("meta"===o){const a=w(i.whatsapp),t=a?`+${a}`:String(i.whatsapp||"").trim();if(s){const a=[];z?a.push({type:"header",parameters:[{type:"image",image:{id:z}}]}):W&&a.push({type:"header",parameters:[{type:"image",image:{link:W}}]});const s=(N||[]).map(e=>I(e,i)).filter(e=>String(e??"").trim().length>0);s.length&&a.push({type:"body",parameters:s.map(e=>({type:"text",text:e}))}),await ne.sendMetaWhatsApp({to:t,template_name:p,template_lang:h,template_components:a.length?a:void 0,campanha_id:Number(ue.id),contato_nome:String(i.nome||"")}),d&&e.trim()&&await ne.sendMetaWhatsApp({to:t,body:e,campanha_id:Number(ue.id),contato_nome:String(i.nome||"")})}else await ne.sendMetaWhatsApp({to:t,body:e,media_id:z,media_url:W,media_type:z||W?"image":void 0,text_position:r,campanha_id:Number(ue.id),contato_nome:String(i.nome||"")})}else{const a="ALL"===Q?J.length?String(J[n%J.length]?.id??"").trim():void 0:"string"==typeof Q?Q:A.length?A[n%A.length]:void 0;await ne.sendWhatsAppMessage(String(i.whatsapp),e,u,r,{campanha_id:ue.id,contato_nome:i.nome,evolution_api_id:a??void 0})}g=!0}catch(e){console.error(e),g=!1;const a=e?.response?.status,t=e?.response?.data,i=t?.detail??t?.message??t,s=("string"==typeof i?i:(()=>{try{return JSON.stringify(i)}catch{return String(i??"")}})())||e?.message||"Erro desconhecido";O=a?`HTTP ${a}: ${s}`:s}const x=Date.now();M=x;const E=g?new Date(x).toISOString():void 0,C={...i.original||{}};g&&E&&(C.enviado_em=E),"boolean"==typeof i.is_whatsapp&&(C.is_whatsapp=i.is_whatsapp),void 0!==i.whatsapp_jid&&(C.whatsapp_jid=i.whatsapp_jid),void 0!==i.resposta&&null!==i.resposta&&(C.resposta=i.resposta),i.respondido_em&&(C.respondido_em=i.respondido_em),r[a]={...i,status:g?"success":"error",original:C},g?(l++,"error"===f&&m--,d&&c++):"waiting"===f&&m++,P([...r]),s(e=>e.map(e=>e.id===ue.id?{...e,enviados:(ue.enviados||0)+l,nao_enviados:(ue.nao_enviados||0)+m,aguardando:d?Math.max(0,b+c):0}:e)),R(g?e=>[...e,`[${ie().format("HH:mm:ss")}] [SUCESSO] Mensagem entregue para ${i.whatsapp}`]:e=>[...e,`[${ie().format("HH:mm:ss")}] [ERRO] Falha ao entregar para ${i.whatsapp}: ${O}`]);const T=Number.isFinite(v)&&Number.isFinite(j)&&v>0&&j>0?Math.floor(Math.random()*(j-v+1))+v:1,S=(M??Date.now())+1e3*T,D=Math.max(0,S-Date.now());R(e=>[...e,`[${ie().format("HH:mm:ss")}] INTERVALO: aguardando ${Math.ceil(D/1e3)}s (range ${v}-${j}).`]),await new Promise(e=>globalThis.setTimeout(e,D))}R(e=>[...e,`[${ie().format("HH:mm:ss")}] DISPARO FINALIZADO.`]);try{const e=r.map(e=>{const a={...e.original||{}};return"boolean"==typeof e.is_whatsapp&&(a.is_whatsapp=e.is_whatsapp),void 0!==e.whatsapp_jid&&(a.whatsapp_jid=e.whatsapp_jid),void 0!==e.resposta&&null!==e.resposta&&(a.resposta=e.resposta),e.respondido_em&&(a.respondido_em=e.respondido_em),a.status=e.status,a});let a=e;if(ue.conteudo_arquivo)try{const t=JSON.parse(ue.conteudo_arquivo);!Array.isArray(t)&&t.contacts&&(a={...t,contacts:e})}catch{}const t=g&&y>0,i=t?C+1:C,s=(()=>{if(!g||!t)return;const e=Number.isFinite(E)&&E>0?E:1;if(1===e)return ie().add(1,"day").toISOString();const a=Math.max(1,Math.floor(1440/e));return ie().add(a,"minute").toISOString()})();await ne.updateCampanha(ue.id,{status:"ATIVO",enviados:(ue.enviados||0)+l,nao_enviados:(ue.nao_enviados||0)+m,aguardando:d?Math.max(0,b+c):0,anexo_json:a,...g?{bloco_atual:i,proxima_execucao:s}:{}}),Te({refreshSchema:!1})}catch(a){console.error("Erro ao atualizar status da campanha",a),R(e=>[...e,`[${ie().format("HH:mm:ss")}] ERRO AO SALVAR NO BANCO: ${a}`])}le.success({content:"Automação finalizada!",key:"envio"})}catch(t){R(e=>[...e,`[${ie().format("HH:mm:ss")}] ERRO CRÍTICO: ${t}`]),le.error({content:"Erro ao iniciar automação",key:"envio"})}}},disabled:!fe,icon:i.jsxDEV(U,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1314,columnNumber:35},this),type:"primary",style:{background:fe?"#52c41a":void 0,borderColor:fe?"#52c41a":void 0},children:"ENVIAR"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1311,columnNumber:27},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1310,columnNumber:22},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1241,columnNumber:18},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1211,columnNumber:14},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1171,columnNumber:10},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1170,columnNumber:7},this),i.jsxDEV(_,{gutter:16,style:{marginBottom:16},children:[i.jsxDEV(M,{span:6,children:i.jsxDEV(u,{size:"small",title:"Status dos Contatos",styles:{body:{padding:0,height:400,overflowY:"auto"}},children:[i.jsxDEV(v,{size:"small",dataSource:D,renderItem:e=>i.jsxDEV(v.Item,{style:{padding:"8px 12px"},children:i.jsxDEV(h,{children:["success"===e.status&&i.jsxDEV(F,{style:{color:"#52c41a"}},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1340,columnNumber:63},this),"error"===e.status&&i.jsxDEV(B,{style:{color:"#ff4d4f"}},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1341,columnNumber:61},this),"waiting"===e.status&&i.jsxDEV(w,{style:{color:"#faad14"}},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1342,columnNumber:63},this),i.jsxDEV("div",{children:[i.jsxDEV("div",{style:{fontWeight:500},children:e.nome},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1344,columnNumber:37},this),i.jsxDEV("div",{style:{fontSize:11,color:"#999"},children:e.whatsapp},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1345,columnNumber:37},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1343,columnNumber:33},this),!0===e.is_whatsapp&&i.jsxDEV(V,{color:"green",style:{marginLeft:6},children:"WHATSAPP VÁLIDO"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1347,columnNumber:63},this),!1===e.is_whatsapp&&i.jsxDEV(V,{color:"red",style:{marginLeft:6},children:"WHATSAPP INVÁLIDO"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1348,columnNumber:64},this),(()=>{const a=String(e.presence||"").toLowerCase().trim();return a?"available"===a||"online"===a?i.jsxDEV(V,{color:"green",style:{marginLeft:6},children:"ONLINE"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1352,columnNumber:85},this):"unavailable"===a||"offline"===a?i.jsxDEV(V,{style:{marginLeft:6},children:"OFFLINE"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1353,columnNumber:88},this):"composing"===a||"typing"===a?i.jsxDEV(V,{color:"blue",style:{marginLeft:6},children:"DIGITANDO"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1354,columnNumber:85},this):"recording"===a?i.jsxDEV(V,{color:"purple",style:{marginLeft:6},children:"GRAVANDO"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1355,columnNumber:67},this):i.jsxDEV(V,{style:{marginLeft:6},children:a.toUpperCase()},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1356,columnNumber:44},this):null})(),1===e.resposta&&i.jsxDEV(V,{color:"green",style:{marginLeft:6},children:"SIM"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1358,columnNumber:57},this),2===e.resposta&&i.jsxDEV(V,{color:"red",style:{marginLeft:6},children:"NÃO"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1359,columnNumber:57},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1339,columnNumber:29},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1338,columnNumber:25},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1334,columnNumber:19},this),0===D.length&&i.jsxDEV("div",{style:{padding:16,textAlign:"center",color:"#999"},children:ue?"Nenhum contato na lista":"Selecione uma campanha"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1364,columnNumber:52},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1333,columnNumber:15},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1332,columnNumber:11},this),i.jsxDEV(M,{span:8,children:i.jsxDEV(u,{size:"small",title:"Preview da Mensagem",styles:{body:{padding:0,height:400,background:"#e5ddd5",display:"flex",flexDirection:"column"}},children:i.jsxDEV("div",{style:{flex:1,padding:20,overflowY:"auto",backgroundImage:'url("https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png")',backgroundSize:"contain"},children:ue?i.jsxDEV("div",{style:{background:"#fff",borderRadius:"0 8px 8px 8px",padding:8,maxWidth:"85%",boxShadow:"0 1px 1px rgba(0,0,0,0.1)"},children:[ue.imagem&&i.jsxDEV(H,{src:ce(ue.imagem),style:{width:"100%",borderRadius:8,marginBottom:8},preview:!1},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1375,columnNumber:34},this),i.jsxDEV("div",{style:{fontSize:14,lineHeight:"1.4",color:"#303030",whiteSpace:"pre-wrap"},children:(()=>{const e=de||{};let a=String(ue.descricao||"").trim();if("SIM_NAO"===String(e.response_mode||"").toUpperCase()){const t=String(e.question||"").trim(),i=[a];t&&i.push(t),i.push("RESPONDA:\n1 - SIM\n2 - NÃO"),a=i.filter(Boolean).join("\n\n")}return a||"Sem texto"})()},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1381,columnNumber:34},this),i.jsxDEV("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",marginTop:4,gap:4},children:[i.jsxDEV("span",{style:{fontSize:11,color:"#999"},children:ie().format("HH:mm")},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1396,columnNumber:34},this),i.jsxDEV(F,{style:{fontSize:14,color:"#34b7f1"}},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1397,columnNumber:34},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1395,columnNumber:30},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1373,columnNumber:26},this):i.jsxDEV("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",color:"#999",flexDirection:"column",gap:8},children:[i.jsxDEV(q,{style:{fontSize:32}},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1402,columnNumber:30},this),i.jsxDEV("span",{children:"Selecione uma campanha para visualizar o preview"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1403,columnNumber:30},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1401,columnNumber:26},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1371,columnNumber:18},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1370,columnNumber:15},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1369,columnNumber:11},this),i.jsxDEV(M,{span:10,children:i.jsxDEV(u,{size:"small",title:"Log de Eventos (Caixa Preta)",styles:{body:{padding:12,height:400,background:"#000",color:"#0f0",fontFamily:"monospace",overflowY:"auto"}},children:S.length>0?i.jsxDEV("ul",{style:{listStyle:"none",padding:0,margin:0},children:S.map((e,a)=>i.jsxDEV("li",{style:{marginBottom:4,borderBottom:"1px solid #333",paddingBottom:2},children:[i.jsxDEV(G,{style:{fontSize:10,marginRight:8}},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1417,columnNumber:35},this),e]},a,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1416,columnNumber:31},this))},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1414,columnNumber:23},this):i.jsxDEV("div",{style:{color:"#666"},children:"Aguardando eventos..."},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1423,columnNumber:23},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1412,columnNumber:15},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1411,columnNumber:11},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1330,columnNumber:7},this),i.jsxDEV("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:12},children:i.jsxDEV(h,{children:[i.jsxDEV(Y,{placement:"bottomRight",trigger:["click"],menu:{items:[]},popupRender:()=>ve,children:i.jsxDEV(O,{shape:"circle",icon:i.jsxDEV(xe,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1432,columnNumber:42},this),style:{background:"#FFD700",borderColor:"#FFD700",color:"#000"},title:"VISUALIZAÇÃO DE COLUNAS"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1432,columnNumber:13},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1431,columnNumber:11},this),i.jsxDEV(O,{shape:"circle",icon:i.jsxDEV(Ee,{},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1434,columnNumber:40},this),style:{background:"#FFD700",borderColor:"#FFD700",color:"#000"},onClick:()=>{d(null),m(!0)},title:"NOVA CAMPANHA"},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1434,columnNumber:11},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1430,columnNumber:9},this)},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1429,columnNumber:7},this),i.jsxDEV("style",{children:"\n        .campanhas-table .ant-table-thead > tr > th{ background:#FFD700; color:#000; font-family: 'Arimo', Arial, sans-serif; }\n        .campanhas-table .ant-table-thead > tr > th .ant-table-column-title{ display:flex; justify-content:center; align-items:center; text-align:center; }\n        .campanhas-table .ant-table-tbody > tr > td{ font-family: 'Roboto Condensed', Arial, sans-serif; padding:2px 6px; line-height:0.95; height:22px; }\n      "},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1437,columnNumber:7},this),i.jsxDEV(X,{loading:n,dataSource:t,columns:De,rowKey:"id",bordered:!0,size:"small",className:"ant-table-striped campanhas-table",rowSelection:{type:"radio",selectedRowKeys:E,onChange:e=>T(e)},onRow:e=>({onClick:()=>T([e.id])})},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1442,columnNumber:7},this),i.jsxDEV(te,{open:l,initial:c||void 0,onCancel:()=>m(!1),onSaved:async()=>{m(!1),await Te()}},void 0,!1,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1459,columnNumber:7},this)]},void 0,!0,{fileName:"D:/PROJETOS/CAPTAR/src/pages/Automacao/Campanha.tsx",lineNumber:1167,columnNumber:5},this)}export{se as default};
